(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.AV=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(){var Asset,BufferSource,Decoder,Demuxer,EventEmitter,FileSource,HTTPSource,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events");HTTPSource=require("./sources/node/http");FileSource=require("./sources/node/file");BufferSource=require("./sources/buffer");Demuxer=require("./demuxer");Decoder=require("./decoder");Asset=function(superClass){extend(Asset,superClass);function Asset(source){this.source=source;this._decode=bind(this._decode,this);this.findDecoder=bind(this.findDecoder,this);this.probe=bind(this.probe,this);this.buffered=0;this.duration=null;this.format=null;this.metadata=null;this.active=false;this.demuxer=null;this.decoder=null;this.source.once("data",this.probe);this.source.on("error",function(_this){return function(err){_this.emit("error",err);return _this.stop()}}(this));this.source.on("progress",function(_this){return function(buffered){_this.buffered=buffered;return _this.emit("buffer",_this.buffered)}}(this))}Asset.fromURL=function(url,opts){return new Asset(new HTTPSource(url,opts))};Asset.fromFile=function(file){return new Asset(new FileSource(file))};Asset.fromBuffer=function(buffer){return new Asset(new BufferSource(buffer))};Asset.prototype.start=function(decode){if(this.active){return}if(decode!=null){this.shouldDecode=decode}if(this.shouldDecode==null){this.shouldDecode=true}this.active=true;this.source.start();if(this.decoder&&this.shouldDecode){return this._decode()}};Asset.prototype.stop=function(){if(!this.active){return}this.active=false;return this.source.pause()};Asset.prototype.get=function(event,callback){if(event!=="format"&&event!=="duration"&&event!=="metadata"){return}if(this[event]!=null){return callback(this[event])}else{this.once(event,function(_this){return function(value){_this.stop();return callback(value)}}(this));return this.start()}};Asset.prototype.decodePacket=function(){return this.decoder.decode()};Asset.prototype.decodeToBuffer=function(callback){var chunks,dataHandler,length;length=0;chunks=[];this.on("data",dataHandler=function(chunk){length+=chunk.length;return chunks.push(chunk)});this.once("end",function(){var buf,chunk,j,len,offset;buf=new Float32Array(length);offset=0;for(j=0,len=chunks.length;j<len;j++){chunk=chunks[j];buf.set(chunk,offset);offset+=chunk.length}this.off("data",dataHandler);return callback(buf)});return this.start()};Asset.prototype.probe=function(chunk){var demuxer;if(!this.active){return}demuxer=Demuxer.find(chunk);if(!demuxer){return this.emit("error","A demuxer for this container was not found.")}this.demuxer=new demuxer(this.source,chunk);this.demuxer.on("format",this.findDecoder);this.demuxer.on("duration",function(_this){return function(duration){_this.duration=duration;return _this.emit("duration",_this.duration)}}(this));this.demuxer.on("metadata",function(_this){return function(metadata){_this.metadata=metadata;return _this.emit("metadata",_this.metadata)}}(this));return this.demuxer.on("error",function(_this){return function(err){_this.emit("error",err);return _this.stop()}}(this))};Asset.prototype.findDecoder=function(format){var decoder,div;this.format=format;if(!this.active){return}this.emit("format",this.format);decoder=Decoder.find(this.format.formatID);if(!decoder){return this.emit("error","A decoder for "+this.format.formatID+" was not found.")}this.decoder=new decoder(this.demuxer,this.format);if(this.format.floatingPoint){this.decoder.on("data",function(_this){return function(buffer){return _this.emit("data",buffer)}}(this))}else{div=Math.pow(2,this.format.bitsPerChannel-1);this.decoder.on("data",function(_this){return function(buffer){var buf,i,j,len,sample;buf=new Float32Array(buffer.length);for(i=j=0,len=buffer.length;j<len;i=++j){sample=buffer[i];buf[i]=sample/div}return _this.emit("data",buf)}}(this))}this.decoder.on("error",function(_this){return function(err){_this.emit("error",err);return _this.stop()}}(this));this.decoder.on("end",function(_this){return function(){return _this.emit("end")}}(this));this.emit("decodeStart");if(this.shouldDecode){return this._decode()}};Asset.prototype._decode=function(){while(this.decoder.decode()&&this.active){continue}if(this.active){return this.decoder.once("data",this._decode)}};Asset.prototype.destroy=function(){var ref,ref1,ref2;this.stop();if((ref=this.demuxer)!=null){ref.off()}if((ref1=this.decoder)!=null){ref1.off()}if((ref2=this.source)!=null){ref2.off()}return this.off()};return Asset}(EventEmitter);module.exports=Asset}).call(this)},{"./core/events":8,"./decoder":11,"./demuxer":14,"./sources/buffer":31,"./sources/node/file":29,"./sources/node/http":30}],2:[function(require,module,exports){(function(){var key,ref,val;ref=require("./aurora_base");for(key in ref){val=ref[key];exports[key]=val}require("./demuxers/caf");require("./demuxers/m4a");require("./demuxers/aiff");require("./demuxers/wave");require("./demuxers/au");require("./decoders/lpcm");require("./decoders/xlaw")}).call(this)},{"./aurora_base":3,"./decoders/lpcm":12,"./decoders/xlaw":13,"./demuxers/aiff":15,"./demuxers/au":16,"./demuxers/caf":17,"./demuxers/m4a":18,"./demuxers/wave":19}],3:[function(require,module,exports){(function(){exports.Base=require("./core/base");exports.Buffer=require("./core/buffer");exports.BufferList=require("./core/bufferlist");exports.Stream=require("./core/stream");exports.Bitstream=require("./core/bitstream");exports.EventEmitter=require("./core/events");exports.UnderflowError=require("./core/underflow");exports.HTTPSource=require("./sources/node/http");exports.FileSource=require("./sources/node/file");exports.BufferSource=require("./sources/buffer");exports.Demuxer=require("./demuxer");exports.Decoder=require("./decoder");exports.AudioDevice=require("./device");exports.Asset=require("./asset");exports.Player=require("./player");exports.Filter=require("./filter");exports.VolumeFilter=require("./filters/volume");exports.BalanceFilter=require("./filters/balance")}).call(this)},{"./asset":1,"./core/base":4,"./core/bitstream":5,"./core/buffer":6,"./core/bufferlist":7,"./core/events":8,"./core/stream":9,"./core/underflow":10,"./decoder":11,"./demuxer":14,"./device":20,"./filter":24,"./filters/balance":25,"./filters/volume":26,"./player":27,"./sources/buffer":31,"./sources/node/file":29,"./sources/node/http":30}],4:[function(require,module,exports){(function(){var Base,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};Base=function(){var fnTest;function Base(){}fnTest=/\b_super\b/;Base.extend=function(prop){var Class,_super,fn,key,keys,ref;Class=function(superClass){extend(Class,superClass);function Class(){return Class.__super__.constructor.apply(this,arguments)}return Class}(this);if(typeof prop==="function"){keys=Object.keys(Class.prototype);prop.call(Class,Class);prop={};ref=Class.prototype;for(key in ref){fn=ref[key];if(indexOf.call(keys,key)<0){prop[key]=fn}}}_super=Class.__super__;for(key in prop){fn=prop[key];if(typeof fn==="function"&&fnTest.test(fn)){(function(key,fn){return Class.prototype[key]=function(){var ret,tmp;tmp=this._super;this._super=_super[key];ret=fn.apply(this,arguments);this._super=tmp;return ret}})(key,fn)}else{Class.prototype[key]=fn}}return Class};return Base}();module.exports=Base}).call(this)},{}],5:[function(require,module,exports){(function(){var Bitstream;Bitstream=function(){function Bitstream(stream){this.stream=stream;this.bitPosition=0}Bitstream.prototype.copy=function(){var result;result=new Bitstream(this.stream.copy());result.bitPosition=this.bitPosition;return result};Bitstream.prototype.offset=function(){return 8*this.stream.offset+this.bitPosition};Bitstream.prototype.available=function(bits){return this.stream.available((bits+8-this.bitPosition)/8)};Bitstream.prototype.advance=function(bits){var pos;pos=this.bitPosition+bits;this.stream.advance(pos>>3);return this.bitPosition=pos&7};Bitstream.prototype.rewind=function(bits){var pos;pos=this.bitPosition-bits;this.stream.rewind(Math.abs(pos>>3));return this.bitPosition=pos&7};Bitstream.prototype.seek=function(offset){var curOffset;curOffset=this.offset();if(offset>curOffset){return this.advance(offset-curOffset)}else if(offset<curOffset){return this.rewind(curOffset-offset)}};Bitstream.prototype.align=function(){if(this.bitPosition!==0){this.bitPosition=0;return this.stream.advance(1)}};Bitstream.prototype.read=function(bits,signed){var a,a0,a1,a2,a3,a4,mBits;if(bits===0){return 0}mBits=bits+this.bitPosition;if(mBits<=8){a=(this.stream.peekUInt8()<<this.bitPosition&255)>>>8-bits}else if(mBits<=16){a=(this.stream.peekUInt16()<<this.bitPosition&65535)>>>16-bits}else if(mBits<=24){a=(this.stream.peekUInt24()<<this.bitPosition&16777215)>>>24-bits}else if(mBits<=32){a=this.stream.peekUInt32()<<this.bitPosition>>>32-bits}else if(mBits<=40){a0=this.stream.peekUInt8(0)*4294967296;a1=this.stream.peekUInt8(1)<<24>>>0;a2=this.stream.peekUInt8(2)<<16;a3=this.stream.peekUInt8(3)<<8;a4=this.stream.peekUInt8(4);a=a0+a1+a2+a3+a4;a%=Math.pow(2,40-this.bitPosition);a=Math.floor(a/Math.pow(2,40-this.bitPosition-bits))}else{throw new Error("Too many bits!")}if(signed){if(mBits<32){if(a>>>bits-1){a=((1<<bits>>>0)-a)*-1}}else{if(a/Math.pow(2,bits-1)|0){a=(Math.pow(2,bits)-a)*-1}}}this.advance(bits);return a};Bitstream.prototype.peek=function(bits,signed){var a,a0,a1,a2,a3,a4,mBits;if(bits===0){return 0}mBits=bits+this.bitPosition;if(mBits<=8){a=(this.stream.peekUInt8()<<this.bitPosition&255)>>>8-bits}else if(mBits<=16){a=(this.stream.peekUInt16()<<this.bitPosition&65535)>>>16-bits}else if(mBits<=24){a=(this.stream.peekUInt24()<<this.bitPosition&16777215)>>>24-bits}else if(mBits<=32){a=this.stream.peekUInt32()<<this.bitPosition>>>32-bits}else if(mBits<=40){a0=this.stream.peekUInt8(0)*4294967296;a1=this.stream.peekUInt8(1)<<24>>>0;a2=this.stream.peekUInt8(2)<<16;a3=this.stream.peekUInt8(3)<<8;a4=this.stream.peekUInt8(4);a=a0+a1+a2+a3+a4;a%=Math.pow(2,40-this.bitPosition);a=Math.floor(a/Math.pow(2,40-this.bitPosition-bits))}else{throw new Error("Too many bits!")}if(signed){if(mBits<32){if(a>>>bits-1){a=((1<<bits>>>0)-a)*-1}}else{if(a/Math.pow(2,bits-1)|0){a=(Math.pow(2,bits)-a)*-1}}}return a};Bitstream.prototype.readLSB=function(bits,signed){var a,mBits;if(bits===0){return 0}if(bits>40){throw new Error("Too many bits!")}mBits=bits+this.bitPosition;a=this.stream.peekUInt8(0)>>>this.bitPosition;if(mBits>8){a|=this.stream.peekUInt8(1)<<8-this.bitPosition}if(mBits>16){a|=this.stream.peekUInt8(2)<<16-this.bitPosition}if(mBits>24){a+=this.stream.peekUInt8(3)<<24-this.bitPosition>>>0}if(mBits>32){a+=this.stream.peekUInt8(4)*Math.pow(2,32-this.bitPosition)}if(mBits>=32){a%=Math.pow(2,bits)}else{a&=(1<<bits)-1}if(signed){if(mBits<32){if(a>>>bits-1){a=((1<<bits>>>0)-a)*-1}}else{if(a/Math.pow(2,bits-1)|0){a=(Math.pow(2,bits)-a)*-1}}}this.advance(bits);return a};Bitstream.prototype.peekLSB=function(bits,signed){var a,mBits;if(bits===0){return 0}if(bits>40){throw new Error("Too many bits!")}mBits=bits+this.bitPosition;a=this.stream.peekUInt8(0)>>>this.bitPosition;if(mBits>8){a|=this.stream.peekUInt8(1)<<8-this.bitPosition}if(mBits>16){a|=this.stream.peekUInt8(2)<<16-this.bitPosition}if(mBits>24){a+=this.stream.peekUInt8(3)<<24-this.bitPosition>>>0}if(mBits>32){a+=this.stream.peekUInt8(4)*Math.pow(2,32-this.bitPosition)}if(mBits>=32){a%=Math.pow(2,bits)}else{a&=(1<<bits)-1}if(signed){if(mBits<32){if(a>>>bits-1){a=((1<<bits>>>0)-a)*-1}}else{if(a/Math.pow(2,bits-1)|0){a=(Math.pow(2,bits)-a)*-1}}}return a};return Bitstream}();module.exports=Bitstream}).call(this)},{}],6:[function(require,module,exports){(function(global){(function(){var AVBuffer;AVBuffer=function(){var BlobBuilder,URL;function AVBuffer(input){var ref;if(input instanceof Uint8Array){this.data=input}else if(input instanceof ArrayBuffer||Array.isArray(input)||typeof input==="number"||((ref=global.Buffer)!=null?ref.isBuffer(input):void 0)){this.data=new Uint8Array(input)}else if(input.buffer instanceof ArrayBuffer){this.data=new Uint8Array(input.buffer,input.byteOffset,input.length*input.BYTES_PER_ELEMENT)}else if(input instanceof AVBuffer){this.data=input.data}else{throw new Error("Constructing buffer with unknown type.")}this.length=this.data.length;this.next=null;this.prev=null}AVBuffer.allocate=function(size){return new AVBuffer(size)};AVBuffer.prototype.copy=function(){return new AVBuffer(new Uint8Array(this.data))};AVBuffer.prototype.slice=function(position,length){if(length==null){length=this.length}if(position===0&&length>=this.length){return new AVBuffer(this.data)}else{return new AVBuffer(this.data.subarray(position,position+length))}};BlobBuilder=global.BlobBuilder||global.MozBlobBuilder||global.WebKitBlobBuilder;URL=global.URL||global.webkitURL||global.mozURL;AVBuffer.makeBlob=function(data,type){var bb;if(type==null){type="application/octet-stream"}try{return new Blob([data],{type:type})}catch(error){}if(BlobBuilder!=null){bb=new BlobBuilder;bb.append(data);return bb.getBlob(type)}return null};AVBuffer.makeBlobURL=function(data,type){return URL!=null?URL.createObjectURL(this.makeBlob(data,type)):void 0};AVBuffer.revokeBlobURL=function(url){return URL!=null?URL.revokeObjectURL(url):void 0};AVBuffer.prototype.toBlob=function(){return AVBuffer.makeBlob(this.data.buffer)};AVBuffer.prototype.toBlobURL=function(){return AVBuffer.makeBlobURL(this.data.buffer)};return AVBuffer}();module.exports=AVBuffer}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],7:[function(require,module,exports){(function(){var BufferList;BufferList=function(){function BufferList(){this.first=null;this.last=null;this.numBuffers=0;this.availableBytes=0;this.availableBuffers=0}BufferList.prototype.copy=function(){var result;result=new BufferList;result.first=this.first;result.last=this.last;result.numBuffers=this.numBuffers;result.availableBytes=this.availableBytes;result.availableBuffers=this.availableBuffers;return result};BufferList.prototype.append=function(buffer){var ref;buffer.prev=this.last;if((ref=this.last)!=null){ref.next=buffer}this.last=buffer;if(this.first==null){this.first=buffer}this.availableBytes+=buffer.length;this.availableBuffers++;return this.numBuffers++};BufferList.prototype.advance=function(){if(this.first){this.availableBytes-=this.first.length;this.availableBuffers--;this.first=this.first.next;return this.first!=null}return false};BufferList.prototype.rewind=function(){var ref;if(this.first&&!this.first.prev){return false}this.first=((ref=this.first)!=null?ref.prev:void 0)||this.last;if(this.first){this.availableBytes+=this.first.length;this.availableBuffers++}return this.first!=null};BufferList.prototype.reset=function(){var results;results=[];while(this.rewind()){continue}return results};return BufferList}();module.exports=BufferList}).call(this)},{}],8:[function(require,module,exports){(function(){var Base,EventEmitter,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,slice=[].slice;Base=require("./base");EventEmitter=function(superClass){extend(EventEmitter,superClass);function EventEmitter(){return EventEmitter.__super__.constructor.apply(this,arguments)}EventEmitter.prototype.on=function(event,fn){var base;if(this.events==null){this.events={}}if((base=this.events)[event]==null){base[event]=[]}return this.events[event].push(fn)};EventEmitter.prototype.off=function(event,fn){var events,index,ref;if(this.events==null){return}if((ref=this.events)!=null?ref[event]:void 0){if(fn!=null){index=this.events[event].indexOf(fn);if(~index){return this.events[event].splice(index,1)}}else{return this.events[event]}}else if(event==null){return events={}}};EventEmitter.prototype.once=function(event,fn){var cb;return this.on(event,cb=function(){this.off(event,cb);return fn.apply(this,arguments)})};EventEmitter.prototype.emit=function(){var args,event,fn,i,len,ref,ref1;event=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[];if(!((ref=this.events)!=null?ref[event]:void 0)){return}ref1=this.events[event].slice();for(i=0,len=ref1.length;i<len;i++){fn=ref1[i];fn.apply(this,args)}};return EventEmitter}(Base);module.exports=EventEmitter}).call(this)},{"./base":4}],9:[function(require,module,exports){(function(){var AVBuffer,BufferList,Stream,UnderflowError;BufferList=require("./bufferlist");AVBuffer=require("./buffer");UnderflowError=require("./underflow");Stream=function(){var buf,decodeString,float32,float64,float64Fallback,float80,int16,int32,int8,nativeEndian,uint16,uint32,uint8;buf=new ArrayBuffer(16);uint8=new Uint8Array(buf);int8=new Int8Array(buf);uint16=new Uint16Array(buf);int16=new Int16Array(buf);uint32=new Uint32Array(buf);int32=new Int32Array(buf);float32=new Float32Array(buf);if(typeof Float64Array!=="undefined"&&Float64Array!==null){float64=new Float64Array(buf)}nativeEndian=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function Stream(list1){this.list=list1;this.localOffset=0;this.offset=0}Stream.fromBuffer=function(buffer){var list;list=new BufferList;list.append(buffer);return new Stream(list)};Stream.prototype.copy=function(){var result;result=new Stream(this.list.copy());result.localOffset=this.localOffset;result.offset=this.offset;return result};Stream.prototype.available=function(bytes){return bytes<=this.list.availableBytes-this.localOffset};Stream.prototype.remainingBytes=function(){return this.list.availableBytes-this.localOffset};Stream.prototype.advance=function(bytes){if(!this.available(bytes)){throw new UnderflowError}this.localOffset+=bytes;this.offset+=bytes;while(this.list.first&&this.localOffset>=this.list.first.length){this.localOffset-=this.list.first.length;this.list.advance()}return this};Stream.prototype.rewind=function(bytes){if(bytes>this.offset){throw new UnderflowError}if(!this.list.first){this.list.rewind();this.localOffset=this.list.first.length}this.localOffset-=bytes;this.offset-=bytes;while(this.list.first.prev&&this.localOffset<0){this.list.rewind();this.localOffset+=this.list.first.length}return this};Stream.prototype.seek=function(position){if(position>this.offset){return this.advance(position-this.offset)}else if(position<this.offset){return this.rewind(this.offset-position)}};Stream.prototype.readUInt8=function(){var a;if(!this.available(1)){throw new UnderflowError}a=this.list.first.data[this.localOffset];this.localOffset+=1;this.offset+=1;if(this.localOffset===this.list.first.length){this.localOffset=0;this.list.advance()}return a};Stream.prototype.peekUInt8=function(offset){var buffer;if(offset==null){offset=0}if(!this.available(offset+1)){throw new UnderflowError}offset=this.localOffset+offset;buffer=this.list.first;while(buffer){if(buffer.length>offset){return buffer.data[offset]}offset-=buffer.length;buffer=buffer.next}return 0};Stream.prototype.read=function(bytes,littleEndian){var i,j,k,ref,ref1;if(littleEndian==null){littleEndian=false}if(littleEndian===nativeEndian){for(i=j=0,ref=bytes;j<ref;i=j+=1){uint8[i]=this.readUInt8()}}else{for(i=k=ref1=bytes-1;k>=0;i=k+=-1){uint8[i]=this.readUInt8()}}};Stream.prototype.peek=function(bytes,offset,littleEndian){var i,j,k,ref,ref1;if(littleEndian==null){littleEndian=false}if(littleEndian===nativeEndian){for(i=j=0,ref=bytes;j<ref;i=j+=1){uint8[i]=this.peekUInt8(offset+i)}}else{for(i=k=0,ref1=bytes;k<ref1;i=k+=1){uint8[bytes-i-1]=this.peekUInt8(offset+i)}}};Stream.prototype.readInt8=function(){this.read(1);return int8[0]};Stream.prototype.peekInt8=function(offset){if(offset==null){offset=0}this.peek(1,offset);return int8[0]};Stream.prototype.readUInt16=function(littleEndian){this.read(2,littleEndian);return uint16[0]};Stream.prototype.peekUInt16=function(offset,littleEndian){if(offset==null){offset=0}this.peek(2,offset,littleEndian);return uint16[0]};Stream.prototype.readInt16=function(littleEndian){this.read(2,littleEndian);return int16[0]};Stream.prototype.peekInt16=function(offset,littleEndian){if(offset==null){offset=0}this.peek(2,offset,littleEndian);return int16[0]};Stream.prototype.readUInt24=function(littleEndian){if(littleEndian){return this.readUInt16(true)+(this.readUInt8()<<16)}else{return(this.readUInt16()<<8)+this.readUInt8()}};Stream.prototype.peekUInt24=function(offset,littleEndian){if(offset==null){offset=0}if(littleEndian){return this.peekUInt16(offset,true)+(this.peekUInt8(offset+2)<<16)}else{return(this.peekUInt16(offset)<<8)+this.peekUInt8(offset+2)}};Stream.prototype.readInt24=function(littleEndian){if(littleEndian){return this.readUInt16(true)+(this.readInt8()<<16)}else{return(this.readInt16()<<8)+this.readUInt8()}};Stream.prototype.peekInt24=function(offset,littleEndian){if(offset==null){offset=0}if(littleEndian){return this.peekUInt16(offset,true)+(this.peekInt8(offset+2)<<16)}else{return(this.peekInt16(offset)<<8)+this.peekUInt8(offset+2)}};Stream.prototype.readUInt32=function(littleEndian){this.read(4,littleEndian);return uint32[0]};Stream.prototype.peekUInt32=function(offset,littleEndian){if(offset==null){offset=0}this.peek(4,offset,littleEndian);return uint32[0]};Stream.prototype.readInt32=function(littleEndian){this.read(4,littleEndian);return int32[0]};Stream.prototype.peekInt32=function(offset,littleEndian){if(offset==null){offset=0}this.peek(4,offset,littleEndian);return int32[0]};Stream.prototype.readFloat32=function(littleEndian){this.read(4,littleEndian);return float32[0]};Stream.prototype.peekFloat32=function(offset,littleEndian){if(offset==null){offset=0}this.peek(4,offset,littleEndian);return float32[0]};Stream.prototype.readFloat64=function(littleEndian){this.read(8,littleEndian);if(float64){return float64[0]}else{return float64Fallback()}};float64Fallback=function(){var exp,frac,high,low,out,sign;low=uint32[0],high=uint32[1];if(!high||high===2147483648){return 0}sign=1-(high>>>31)*2;exp=high>>>20&2047;frac=high&1048575;if(exp===2047){if(frac){return 0/0}return sign*Infinity}exp-=1023;out=(frac|1048576)*Math.pow(2,exp-20);out+=low*Math.pow(2,exp-52);return sign*out};Stream.prototype.peekFloat64=function(offset,littleEndian){if(offset==null){offset=0}this.peek(8,offset,littleEndian);if(float64){return float64[0]}else{return float64Fallback()}};Stream.prototype.readFloat80=function(littleEndian){this.read(10,littleEndian);return float80()};float80=function(){var a0,a1,exp,high,low,out,sign;high=uint32[0],low=uint32[1];a0=uint8[9];a1=uint8[8];sign=1-(a0>>>7)*2;exp=(a0&127)<<8|a1;if(exp===0&&low===0&&high===0){return 0}if(exp===32767){if(low===0&&high===0){return sign*Infinity}return 0/0}exp-=16383;out=low*Math.pow(2,exp-31);out+=high*Math.pow(2,exp-63);return sign*out};Stream.prototype.peekFloat80=function(offset,littleEndian){if(offset==null){offset=0}this.peek(10,offset,littleEndian);return float80()};Stream.prototype.readBuffer=function(length){var i,j,ref,result,to;result=AVBuffer.allocate(length);to=result.data;for(i=j=0,ref=length;j<ref;i=j+=1){to[i]=this.readUInt8()}return result};Stream.prototype.peekBuffer=function(offset,length){var i,j,ref,result,to;if(offset==null){offset=0}result=AVBuffer.allocate(length);to=result.data;for(i=j=0,ref=length;j<ref;i=j+=1){to[i]=this.peekUInt8(offset+i)}return result};Stream.prototype.readSingleBuffer=function(length){var result;result=this.list.first.slice(this.localOffset,length);this.advance(result.length);return result};Stream.prototype.peekSingleBuffer=function(offset,length){var result;result=this.list.first.slice(this.localOffset+offset,length);return result};Stream.prototype.readString=function(length,encoding){if(encoding==null){encoding="ascii"}return decodeString.call(this,0,length,encoding,true)};Stream.prototype.peekString=function(offset,length,encoding){if(offset==null){offset=0}if(encoding==null){encoding="ascii"}return decodeString.call(this,offset,length,encoding,false)};decodeString=function(offset,length,encoding,advance){var b1,b2,b3,b4,bom,c,end,littleEndian,nullEnd,pt,result,w1,w2;encoding=encoding.toLowerCase();nullEnd=length===null?0:-1;if(length==null){length=Infinity}end=offset+length;result="";switch(encoding){case"ascii":case"latin1":while(offset<end&&(c=this.peekUInt8(offset++))!==nullEnd){result+=String.fromCharCode(c)}break;case"utf8":case"utf-8":while(offset<end&&(b1=this.peekUInt8(offset++))!==nullEnd){if((b1&128)===0){result+=String.fromCharCode(b1)}else if((b1&224)===192){b2=this.peekUInt8(offset++)&63;result+=String.fromCharCode((b1&31)<<6|b2)}else if((b1&240)===224){b2=this.peekUInt8(offset++)&63;b3=this.peekUInt8(offset++)&63;result+=String.fromCharCode((b1&15)<<12|b2<<6|b3)}else if((b1&248)===240){b2=this.peekUInt8(offset++)&63;b3=this.peekUInt8(offset++)&63;b4=this.peekUInt8(offset++)&63;pt=((b1&15)<<18|b2<<12|b3<<6|b4)-65536;result+=String.fromCharCode(55296+(pt>>10),56320+(pt&1023))}}break;case"utf16-be":case"utf16be":case"utf16le":case"utf16-le":case"utf16bom":case"utf16-bom":switch(encoding){case"utf16be":case"utf16-be":littleEndian=false;break;case"utf16le":case"utf16-le":littleEndian=true;break;case"utf16bom":case"utf16-bom":if(length<2||(bom=this.peekUInt16(offset))===nullEnd){if(advance){this.advance(offset+=2)}return result}littleEndian=bom===65534;offset+=2}while(offset<end&&(w1=this.peekUInt16(offset,littleEndian))!==nullEnd){offset+=2;if(w1<55296||w1>57343){result+=String.fromCharCode(w1)}else{if(w1>56319){throw new Error("Invalid utf16 sequence.")}w2=this.peekUInt16(offset,littleEndian);if(w2<56320||w2>57343){throw new Error("Invalid utf16 sequence.")}result+=String.fromCharCode(w1,w2);offset+=2}}if(w1===nullEnd){offset+=2}break;default:throw new Error("Unknown encoding: "+encoding)}if(advance){this.advance(offset)}return result};return Stream}();module.exports=Stream}).call(this)},{"./buffer":6,"./bufferlist":7,"./underflow":10}],10:[function(require,module,exports){(function(){var UnderflowError,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;UnderflowError=function(superClass){extend(UnderflowError,superClass);function UnderflowError(){UnderflowError.__super__.constructor.apply(this,arguments);this.name="UnderflowError";this.stack=(new Error).stack}return UnderflowError}(Error);module.exports=UnderflowError}).call(this)},{}],11:[function(require,module,exports){(function(){var Bitstream,BufferList,Decoder,EventEmitter,Stream,UnderflowError,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events");BufferList=require("./core/bufferlist");Stream=require("./core/stream");Bitstream=require("./core/bitstream");UnderflowError=require("./core/underflow");Decoder=function(superClass){var codecs;extend(Decoder,superClass);function Decoder(demuxer,format){var list;this.demuxer=demuxer;this.format=format;list=new BufferList;this.stream=new Stream(list);this.bitstream=new Bitstream(this.stream);this.receivedFinalBuffer=false;this.waiting=false;this.demuxer.on("cookie",function(_this){return function(cookie){var error;try{return _this.setCookie(cookie)}catch(error1){error=error1;return _this.emit("error",error)}}}(this));this.demuxer.on("data",function(_this){return function(chunk){list.append(chunk);if(_this.waiting){return _this.decode()}}}(this));this.demuxer.on("end",function(_this){return function(){_this.receivedFinalBuffer=true;if(_this.waiting){return _this.decode()}}}(this));this.init()}Decoder.prototype.init=function(){};Decoder.prototype.setCookie=function(cookie){};Decoder.prototype.readChunk=function(){};Decoder.prototype.decode=function(){var error,offset,packet;this.waiting=!this.receivedFinalBuffer;offset=this.bitstream.offset();try{packet=this.readChunk()}catch(error1){error=error1;if(!(error instanceof UnderflowError)){this.emit("error",error);return false}}if(packet){this.emit("data",packet);if(this.receivedFinalBuffer){this.emit("end")}return true}else if(!this.receivedFinalBuffer){this.bitstream.seek(offset);this.waiting=true}else{this.emit("end")}return false};Decoder.prototype.seek=function(timestamp){var seekPoint;seekPoint=this.demuxer.seek(timestamp);this.stream.seek(seekPoint.offset);return seekPoint.timestamp};codecs={};Decoder.register=function(id,decoder){return codecs[id]=decoder};Decoder.find=function(id){return codecs[id]||null};return Decoder}(EventEmitter);module.exports=Decoder}).call(this)},{"./core/bitstream":5,"./core/bufferlist":7,"./core/events":8,"./core/stream":9,"./core/underflow":10}],12:[function(require,module,exports){(function(){var Decoder,LPCMDecoder,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Decoder=require("../decoder");LPCMDecoder=function(superClass){extend(LPCMDecoder,superClass);function LPCMDecoder(){this.readChunk=bind(this.readChunk,this);return LPCMDecoder.__super__.constructor.apply(this,arguments)}Decoder.register("lpcm",LPCMDecoder);LPCMDecoder.prototype.readChunk=function(){var chunkSize,i,j,k,l,littleEndian,m,n,o,output,ref,ref1,ref2,ref3,ref4,ref5,samples,stream;stream=this.stream;littleEndian=this.format.littleEndian;chunkSize=Math.min(4096,stream.remainingBytes());samples=chunkSize/(this.format.bitsPerChannel/8)|0;if(chunkSize<this.format.bitsPerChannel/8){return null}if(this.format.floatingPoint){switch(this.format.bitsPerChannel){case 32:output=new Float32Array(samples);for(i=j=0,ref=samples;j<ref;i=j+=1){output[i]=stream.readFloat32(littleEndian)}break;case 64:output=new Float64Array(samples);for(i=k=0,ref1=samples;k<ref1;i=k+=1){output[i]=stream.readFloat64(littleEndian)}break;default:throw new Error("Unsupported bit depth.")}}else{switch(this.format.bitsPerChannel){case 8:output=new Int8Array(samples);for(i=l=0,ref2=samples;l<ref2;i=l+=1){output[i]=stream.readInt8()}break;case 16:output=new Int16Array(samples);for(i=m=0,ref3=samples;m<ref3;i=m+=1){output[i]=stream.readInt16(littleEndian)}break;case 24:output=new Int32Array(samples);for(i=n=0,ref4=samples;n<ref4;i=n+=1){output[i]=stream.readInt24(littleEndian)}break;case 32:output=new Int32Array(samples);for(i=o=0,ref5=samples;o<ref5;i=o+=1){output[i]=stream.readInt32(littleEndian)}break;default:throw new Error("Unsupported bit depth.")}}return output};return LPCMDecoder}(Decoder)}).call(this)},{"../decoder":11}],13:[function(require,module,exports){(function(){var Decoder,XLAWDecoder,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Decoder=require("../decoder");XLAWDecoder=function(superClass){var BIAS,QUANT_MASK,SEG_MASK,SEG_SHIFT,SIGN_BIT;extend(XLAWDecoder,superClass);function XLAWDecoder(){this.readChunk=bind(this.readChunk,this);return XLAWDecoder.__super__.constructor.apply(this,arguments)}Decoder.register("ulaw",XLAWDecoder);Decoder.register("alaw",XLAWDecoder);SIGN_BIT=128;QUANT_MASK=15;SEG_SHIFT=4;SEG_MASK=112;BIAS=132;XLAWDecoder.prototype.init=function(){var i,j,k,seg,t,table,val;this.format.bitsPerChannel=16;this.table=table=new Int16Array(256);if(this.format.formatID==="ulaw"){for(i=j=0;j<256;i=++j){val=~i;t=((val&QUANT_MASK)<<3)+BIAS;t<<=(val&SEG_MASK)>>>SEG_SHIFT;table[i]=val&SIGN_BIT?BIAS-t:t-BIAS}}else{for(i=k=0;k<256;i=++k){val=i^85;t=val&QUANT_MASK;seg=(val&SEG_MASK)>>>SEG_SHIFT;if(seg){t=t+t+1+32<<seg+2}else{t=t+t+1<<3}table[i]=val&SIGN_BIT?t:-t}}};XLAWDecoder.prototype.readChunk=function(){var i,j,output,ref,ref1,samples,stream,table;ref=this,stream=ref.stream,table=ref.table;samples=Math.min(4096,this.stream.remainingBytes());if(samples===0){return}output=new Int16Array(samples);for(i=j=0,ref1=samples;j<ref1;i=j+=1){output[i]=table[stream.readUInt8()]}return output};return XLAWDecoder}(Decoder)}).call(this)},{"../decoder":11}],14:[function(require,module,exports){(function(){var BufferList,Demuxer,EventEmitter,Stream,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events");BufferList=require("./core/bufferlist");Stream=require("./core/stream");Demuxer=function(superClass){var formats;extend(Demuxer,superClass);Demuxer.probe=function(buffer){return false};function Demuxer(source,chunk){var list,received;list=new BufferList;list.append(chunk);this.stream=new Stream(list);received=false;source.on("data",function(_this){return function(chunk){var e;received=true;list.append(chunk);try{return _this.readChunk(chunk)}catch(error){e=error;return _this.emit("error",e)}}}(this));source.on("error",function(_this){return function(err){return _this.emit("error",err)}}(this));source.on("end",function(_this){return function(){if(!received){_this.readChunk(chunk)}return _this.emit("end")}}(this));this.seekPoints=[];this.init()}Demuxer.prototype.init=function(){};Demuxer.prototype.readChunk=function(chunk){};Demuxer.prototype.addSeekPoint=function(offset,timestamp){var index;index=this.searchTimestamp(timestamp);return this.seekPoints.splice(index,0,{offset:offset,timestamp:timestamp})};Demuxer.prototype.searchTimestamp=function(timestamp,backward){var high,low,mid,time;low=0;high=this.seekPoints.length;if(high>0&&this.seekPoints[high-1].timestamp<timestamp){return high}while(low<high){mid=low+high>>1;time=this.seekPoints[mid].timestamp;if(time<timestamp){low=mid+1}else if(time>=timestamp){high=mid}}if(high>this.seekPoints.length){high=this.seekPoints.length}return high};Demuxer.prototype.seek=function(timestamp){var index,seekPoint;if(this.format&&this.format.framesPerPacket>0&&this.format.bytesPerPacket>0){seekPoint={timestamp:timestamp,offset:this.format.bytesPerPacket*timestamp/this.format.framesPerPacket};return seekPoint}else{index=this.searchTimestamp(timestamp);return this.seekPoints[index]}};formats=[];Demuxer.register=function(demuxer){return formats.push(demuxer)};Demuxer.find=function(buffer){var e,format,i,len,offset,stream;stream=Stream.fromBuffer(buffer);for(i=0,len=formats.length;i<len;i++){format=formats[i];offset=stream.offset;try{if(format.probe(stream)){return format}}catch(error){e=error}stream.seek(offset)}return null};return Demuxer}(EventEmitter);module.exports=Demuxer}).call(this)},{"./core/bufferlist":7,"./core/events":8,"./core/stream":9}],15:[function(require,module,exports){(function(){var AIFFDemuxer,Demuxer,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Demuxer=require("../demuxer");AIFFDemuxer=function(superClass){extend(AIFFDemuxer,superClass);function AIFFDemuxer(){return AIFFDemuxer.__super__.constructor.apply(this,arguments)}Demuxer.register(AIFFDemuxer);AIFFDemuxer.probe=function(buffer){var ref;return buffer.peekString(0,4)==="FORM"&&((ref=buffer.peekString(8,4))==="AIFF"||ref==="AIFC")};AIFFDemuxer.prototype.readChunk=function(){var buffer,format,offset,ref;if(!this.readStart&&this.stream.available(12)){if(this.stream.readString(4)!=="FORM"){return this.emit("error","Invalid AIFF.")}this.fileSize=this.stream.readUInt32();this.fileType=this.stream.readString(4);this.readStart=true;if((ref=this.fileType)!=="AIFF"&&ref!=="AIFC"){return this.emit("error","Invalid AIFF.")}}while(this.stream.available(1)){if(!this.readHeaders&&this.stream.available(8)){this.type=this.stream.readString(4);this.len=this.stream.readUInt32()}switch(this.type){case"COMM":if(!this.stream.available(this.len)){return}this.format={formatID:"lpcm",channelsPerFrame:this.stream.readUInt16(),sampleCount:this.stream.readUInt32(),bitsPerChannel:this.stream.readUInt16(),sampleRate:this.stream.readFloat80(),framesPerPacket:1,littleEndian:false,floatingPoint:false};this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame;if(this.fileType==="AIFC"){format=this.stream.readString(4);this.format.littleEndian=format==="sowt"&&this.format.bitsPerChannel>8;this.format.floatingPoint=format==="fl32"||format==="fl64";if(format==="twos"||format==="sowt"||format==="fl32"||format==="fl64"||format==="NONE"){format="lpcm"}this.format.formatID=format;this.len-=4}this.stream.advance(this.len-18);this.emit("format",this.format);this.emit("duration",this.format.sampleCount/this.format.sampleRate*1e3|0);break;case"SSND":if(!(this.readSSNDHeader&&this.stream.available(4))){offset=this.stream.readUInt32();this.stream.advance(4);this.stream.advance(offset);this.readSSNDHeader=true}buffer=this.stream.readSingleBuffer(this.len);this.len-=buffer.length;this.readHeaders=this.len>0;this.emit("data",buffer);break;default:if(!this.stream.available(this.len)){return}this.stream.advance(this.len)}if(this.type!=="SSND"){this.readHeaders=false}}};return AIFFDemuxer}(Demuxer)}).call(this)},{"../demuxer":14}],16:[function(require,module,exports){(function(){var AUDemuxer,Demuxer,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Demuxer=require("../demuxer");AUDemuxer=function(superClass){var bps,formats;extend(AUDemuxer,superClass);function AUDemuxer(){return AUDemuxer.__super__.constructor.apply(this,arguments)}Demuxer.register(AUDemuxer);AUDemuxer.probe=function(buffer){return buffer.peekString(0,4)===".snd"};bps=[8,8,16,24,32,32,64];bps[26]=8;formats={1:"ulaw",27:"alaw"};AUDemuxer.prototype.readChunk=function(){var bytes,dataSize,encoding,size;if(!this.readHeader&&this.stream.available(24)){if(this.stream.readString(4)!==".snd"){return this.emit("error","Invalid AU file.")}size=this.stream.readUInt32();dataSize=this.stream.readUInt32();encoding=this.stream.readUInt32();this.format={formatID:formats[encoding]||"lpcm",littleEndian:false,floatingPoint:encoding===6||encoding===7,bitsPerChannel:bps[encoding-1],sampleRate:this.stream.readUInt32(),channelsPerFrame:this.stream.readUInt32(),framesPerPacket:1};if(this.format.bitsPerChannel==null){return this.emit("error","Unsupported encoding in AU file.")}this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame;if(dataSize!==4294967295){bytes=this.format.bitsPerChannel/8;this.emit("duration",dataSize/bytes/this.format.channelsPerFrame/this.format.sampleRate*1e3|0)}this.emit("format",this.format);this.readHeader=true}if(this.readHeader){while(this.stream.available(1)){this.emit("data",this.stream.readSingleBuffer(this.stream.remainingBytes()))}}};return AUDemuxer}(Demuxer)}).call(this)},{"../demuxer":14}],17:[function(require,module,exports){(function(){var CAFDemuxer,Demuxer,M4ADemuxer,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Demuxer=require("../demuxer");M4ADemuxer=require("./m4a");CAFDemuxer=function(superClass){extend(CAFDemuxer,superClass);function CAFDemuxer(){return CAFDemuxer.__super__.constructor.apply(this,arguments)}Demuxer.register(CAFDemuxer);CAFDemuxer.probe=function(buffer){return buffer.peekString(0,4)==="caff"};CAFDemuxer.prototype.readChunk=function(){var buffer,byteOffset,cookie,entries,flags,i,j,k,key,metadata,offset,ref,ref1,sampleOffset,value;if(!this.format&&this.stream.available(64)){if(this.stream.readString(4)!=="caff"){return this.emit("error","Invalid CAF, does not begin with 'caff'")}this.stream.advance(4);if(this.stream.readString(4)!=="desc"){return this.emit("error","Invalid CAF, 'caff' is not followed by 'desc'")}if(!(this.stream.readUInt32()===0&&this.stream.readUInt32()===32)){return this.emit("error","Invalid 'desc' size, should be 32")}this.format={};this.format.sampleRate=this.stream.readFloat64();this.format.formatID=this.stream.readString(4);flags=this.stream.readUInt32();if(this.format.formatID==="lpcm"){this.format.floatingPoint=Boolean(flags&1);this.format.littleEndian=Boolean(flags&2)}this.format.bytesPerPacket=this.stream.readUInt32();this.format.framesPerPacket=this.stream.readUInt32();this.format.channelsPerFrame=this.stream.readUInt32();this.format.bitsPerChannel=this.stream.readUInt32();this.emit("format",this.format)}while(this.stream.available(1)){if(!this.headerCache){this.headerCache={type:this.stream.readString(4),oversize:this.stream.readUInt32()!==0,size:this.stream.readUInt32()};if(this.headerCache.oversize){return this.emit("error","Holy Shit, an oversized file, not supported in JS")}}switch(this.headerCache.type){case"kuki":if(this.stream.available(this.headerCache.size)){if(this.format.formatID==="aac "){offset=this.stream.offset+this.headerCache.size;if(cookie=M4ADemuxer.readEsds(this.stream)){this.emit("cookie",cookie)}this.stream.seek(offset)}else{buffer=this.stream.readBuffer(this.headerCache.size);this.emit("cookie",buffer)}this.headerCache=null}break;case"pakt":if(this.stream.available(this.headerCache.size)){if(this.stream.readUInt32()!==0){return this.emit("error","Sizes greater than 32 bits are not supported.")}this.numPackets=this.stream.readUInt32();if(this.stream.readUInt32()!==0){return this.emit("error","Sizes greater than 32 bits are not supported.")}this.numFrames=this.stream.readUInt32();this.primingFrames=this.stream.readUInt32();this.remainderFrames=this.stream.readUInt32();this.emit("duration",this.numFrames/this.format.sampleRate*1e3|0);this.sentDuration=true;byteOffset=0;sampleOffset=0;for(i=j=0,ref=this.numPackets;j<ref;i=j+=1){this.addSeekPoint(byteOffset,sampleOffset);byteOffset+=this.format.bytesPerPacket||M4ADemuxer.readDescrLen(this.stream);sampleOffset+=this.format.framesPerPacket||M4ADemuxer.readDescrLen(this.stream)}this.headerCache=null}break;case"info":entries=this.stream.readUInt32();metadata={};for(i=k=0,ref1=entries;0<=ref1?k<ref1:k>ref1;i=0<=ref1?++k:--k){key=this.stream.readString(null);value=this.stream.readString(null);metadata[key]=value}this.emit("metadata",metadata);this.headerCache=null;break;case"data":if(!this.sentFirstDataChunk){this.stream.advance(4);this.headerCache.size-=4;if(this.format.bytesPerPacket!==0&&!this.sentDuration){this.numFrames=this.headerCache.size/this.format.bytesPerPacket;this.emit("duration",this.numFrames/this.format.sampleRate*1e3|0)}this.sentFirstDataChunk=true}buffer=this.stream.readSingleBuffer(this.headerCache.size);this.headerCache.size-=buffer.length;this.emit("data",buffer);if(this.headerCache.size<=0){this.headerCache=null}break;default:if(this.stream.available(this.headerCache.size)){this.stream.advance(this.headerCache.size);this.headerCache=null}}}};return CAFDemuxer}(Demuxer)}).call(this)},{"../demuxer":14,"./m4a":18}],18:[function(require,module,exports){(function(){var Demuxer,M4ADemuxer,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};Demuxer=require("../demuxer");M4ADemuxer=function(superClass){var BITS_PER_CHANNEL,TYPES,after,atom,atoms,bool,containers,diskTrack,genres,meta,string;extend(M4ADemuxer,superClass);function M4ADemuxer(){return M4ADemuxer.__super__.constructor.apply(this,arguments)}Demuxer.register(M4ADemuxer);TYPES=["M4A ","M4P ","M4B ","M4V ","isom","mp42","qt  "];M4ADemuxer.probe=function(buffer){var ref;return buffer.peekString(4,4)==="ftyp"&&(ref=buffer.peekString(8,4),indexOf.call(TYPES,ref)>=0)};M4ADemuxer.prototype.init=function(){this.atoms=[];this.offsets=[];this.track=null;return this.tracks=[]};atoms={};containers={};atom=function(name,fn){var c,container,k,len1,ref;c=[];ref=name.split(".").slice(0,-1);for(k=0,len1=ref.length;k<len1;k++){container=ref[k];c.push(container);containers[c.join(".")]=true}if(atoms[name]==null){atoms[name]={}}return atoms[name].fn=fn};after=function(name,fn){if(atoms[name]==null){atoms[name]={}}return atoms[name].after=fn};M4ADemuxer.prototype.readChunk=function(){var handler,path,type;this["break"]=false;while(this.stream.available(1)&&!this["break"]){if(!this.readHeaders){if(!this.stream.available(8)){return}this.len=this.stream.readUInt32()-8;this.type=this.stream.readString(4);if(this.len===0){continue}this.atoms.push(this.type);this.offsets.push(this.stream.offset+this.len);this.readHeaders=true}path=this.atoms.join(".");handler=atoms[path];if(handler!=null?handler.fn:void 0){if(!(this.stream.available(this.len)||path==="mdat")){return}handler.fn.call(this);if(path in containers){this.readHeaders=false}}else if(path in containers){this.readHeaders=false}else{if(!this.stream.available(this.len)){return}this.stream.advance(this.len)}while(this.stream.offset>=this.offsets[this.offsets.length-1]){handler=atoms[this.atoms.join(".")];if(handler!=null?handler.after:void 0){handler.after.call(this)}type=this.atoms.pop();this.offsets.pop();this.readHeaders=false}}};atom("ftyp",function(){var ref;if(ref=this.stream.readString(4),indexOf.call(TYPES,ref)<0){return this.emit("error","Not a valid M4A file.")}return this.stream.advance(this.len-4)});atom("moov.trak",function(){this.track={};return this.tracks.push(this.track)});atom("moov.trak.tkhd",function(){this.stream.advance(4);this.stream.advance(8);this.track.id=this.stream.readUInt32();return this.stream.advance(this.len-16)});atom("moov.trak.mdia.hdlr",function(){this.stream.advance(4);this.stream.advance(4);this.track.type=this.stream.readString(4);this.stream.advance(12);return this.stream.advance(this.len-24)});atom("moov.trak.mdia.mdhd",function(){this.stream.advance(4);this.stream.advance(8);this.track.timeScale=this.stream.readUInt32();this.track.duration=this.stream.readUInt32();return this.stream.advance(4)});BITS_PER_CHANNEL={ulaw:8,alaw:8,in24:24,in32:32,fl32:32,fl64:64};atom("moov.trak.mdia.minf.stbl.stsd",function(){var format,numEntries,ref,ref1,version;this.stream.advance(4);numEntries=this.stream.readUInt32();if(this.track.type!=="soun"){return this.stream.advance(this.len-8)}if(numEntries!==1){return this.emit("error","Only expecting one entry in sample description atom!")}this.stream.advance(4);format=this.track.format={};format.formatID=this.stream.readString(4);this.stream.advance(6);this.stream.advance(2);version=this.stream.readUInt16();this.stream.advance(6);format.channelsPerFrame=this.stream.readUInt16();format.bitsPerChannel=this.stream.readUInt16();this.stream.advance(4);format.sampleRate=this.stream.readUInt16();this.stream.advance(2);if(version===1){format.framesPerPacket=this.stream.readUInt32();this.stream.advance(4);format.bytesPerFrame=this.stream.readUInt32();this.stream.advance(4)}else if(version!==0){this.emit("error","Unknown version in stsd atom")}if(BITS_PER_CHANNEL[format.formatID]!=null){format.bitsPerChannel=BITS_PER_CHANNEL[format.formatID]}format.floatingPoint=(ref=format.formatID)==="fl32"||ref==="fl64";format.littleEndian=format.formatID==="sowt"&&format.bitsPerChannel>8;if((ref1=format.formatID)==="twos"||ref1==="sowt"||ref1==="in24"||ref1==="in32"||ref1==="fl32"||ref1==="fl64"||ref1==="raw "||ref1==="NONE"){return format.formatID="lpcm"}});atom("moov.trak.mdia.minf.stbl.stsd.alac",function(){this.stream.advance(4);return this.track.cookie=this.stream.readBuffer(this.len-4)});atom("moov.trak.mdia.minf.stbl.stsd.esds",function(){var offset;offset=this.stream.offset+this.len;this.track.cookie=M4ADemuxer.readEsds(this.stream);return this.stream.seek(offset)});atom("moov.trak.mdia.minf.stbl.stsd.wave.enda",function(){return this.track.format.littleEndian=!!this.stream.readUInt16()});M4ADemuxer.readDescrLen=function(stream){var c,count,len;len=0;count=4;while(count--){c=stream.readUInt8();len=len<<7|c&127;if(!(c&128)){break}}return len};M4ADemuxer.readEsds=function(stream){var codec_id,flags,len,tag;stream.advance(4);tag=stream.readUInt8();len=M4ADemuxer.readDescrLen(stream);if(tag===3){stream.advance(2);flags=stream.readUInt8();if(flags&128){stream.advance(2)}if(flags&64){stream.advance(stream.readUInt8())}if(flags&32){stream.advance(2)}}else{stream.advance(2)}tag=stream.readUInt8();len=M4ADemuxer.readDescrLen(stream);if(tag===4){codec_id=stream.readUInt8();stream.advance(1);stream.advance(3);stream.advance(4);stream.advance(4);tag=stream.readUInt8();len=M4ADemuxer.readDescrLen(stream);if(tag===5){return stream.readBuffer(len)}}return null};atom("moov.trak.mdia.minf.stbl.stts",function(){var entries,i,k,ref;this.stream.advance(4);entries=this.stream.readUInt32();this.track.stts=[];for(i=k=0,ref=entries;k<ref;i=k+=1){this.track.stts[i]={count:this.stream.readUInt32(),duration:this.stream.readUInt32()}}return this.setupSeekPoints()});atom("moov.trak.mdia.minf.stbl.stsc",function(){var entries,i,k,ref;this.stream.advance(4);entries=this.stream.readUInt32();this.track.stsc=[];for(i=k=0,ref=entries;k<ref;i=k+=1){this.track.stsc[i]={first:this.stream.readUInt32(),count:this.stream.readUInt32(),id:this.stream.readUInt32()}}return this.setupSeekPoints()});atom("moov.trak.mdia.minf.stbl.stsz",function(){var entries,i,k,ref;this.stream.advance(4);this.track.sampleSize=this.stream.readUInt32();entries=this.stream.readUInt32();if(this.track.sampleSize===0&&entries>0){this.track.sampleSizes=[];for(i=k=0,ref=entries;k<ref;i=k+=1){this.track.sampleSizes[i]=this.stream.readUInt32()}}return this.setupSeekPoints()});atom("moov.trak.mdia.minf.stbl.stco",function(){var entries,i,k,ref;this.stream.advance(4);entries=this.stream.readUInt32();this.track.chunkOffsets=[];for(i=k=0,ref=entries;k<ref;i=k+=1){this.track.chunkOffsets[i]=this.stream.readUInt32()}return this.setupSeekPoints()});atom("moov.trak.tref.chap",function(){var entries,i,k,ref;entries=this.len>>2;this.track.chapterTracks=[];for(i=k=0,ref=entries;k<ref;i=k+=1){this.track.chapterTracks[i]=this.stream.readUInt32()}});M4ADemuxer.prototype.setupSeekPoints=function(){var i,j,k,l,len1,offset,position,ref,ref1,results,sampleIndex,size,stscIndex,sttsIndex,sttsSample,timestamp;if(!(this.track.chunkOffsets!=null&&this.track.stsc!=null&&this.track.sampleSize!=null&&this.track.stts!=null)){return}stscIndex=0;sttsIndex=0;sttsIndex=0;sttsSample=0;sampleIndex=0;offset=0;timestamp=0;this.track.seekPoints=[];ref=this.track.chunkOffsets;results=[];for(i=k=0,len1=ref.length;k<len1;i=++k){position=ref[i];for(j=l=0,ref1=this.track.stsc[stscIndex].count;l<ref1;j=l+=1){this.track.seekPoints.push({offset:offset,position:position,timestamp:timestamp});size=this.track.sampleSize||this.track.sampleSizes[sampleIndex++];offset+=size;position+=size;timestamp+=this.track.stts[sttsIndex].duration;if(sttsIndex+1<this.track.stts.length&&++sttsSample===this.track.stts[sttsIndex].count){sttsSample=0;sttsIndex++}}if(stscIndex+1<this.track.stsc.length&&i+1===this.track.stsc[stscIndex+1].first){results.push(stscIndex++)}else{results.push(void 0)}}return results};after("moov",function(){var k,len1,ref,track;if(this.mdatOffset!=null){this.stream.seek(this.mdatOffset-8)}ref=this.tracks;for(k=0,len1=ref.length;k<len1;k++){track=ref[k];if(!(track.type==="soun")){continue}this.track=track;break}if(this.track.type!=="soun"){this.track=null;return this.emit("error","No audio tracks in m4a file.")}this.emit("format",this.track.format);this.emit("duration",this.track.duration/this.track.timeScale*1e3|0);if(this.track.cookie){this.emit("cookie",this.track.cookie)}return this.seekPoints=this.track.seekPoints});atom("mdat",function(){var bytes,chunkSize,k,length,numSamples,offset,ref,sample,size;if(!this.startedData){if(this.mdatOffset==null){this.mdatOffset=this.stream.offset}if(this.tracks.length===0){bytes=Math.min(this.stream.remainingBytes(),this.len);this.stream.advance(bytes);this.len-=bytes;return}this.chunkIndex=0;this.stscIndex=0;this.sampleIndex=0;this.tailOffset=0;this.tailSamples=0;this.startedData=true}if(!this.readChapters){this.readChapters=this.parseChapters();if(this["break"]=!this.readChapters){return}this.stream.seek(this.mdatOffset)}offset=this.track.chunkOffsets[this.chunkIndex]+this.tailOffset;length=0;if(!this.stream.available(offset-this.stream.offset)){this["break"]=true;return}this.stream.seek(offset);while(this.chunkIndex<this.track.chunkOffsets.length){numSamples=this.track.stsc[this.stscIndex].count-this.tailSamples;chunkSize=0;for(sample=k=0,ref=numSamples;k<ref;sample=k+=1){size=this.track.sampleSize||this.track.sampleSizes[this.sampleIndex];if(!this.stream.available(length+size)){break}length+=size;chunkSize+=size;this.sampleIndex++}if(sample<numSamples){this.tailOffset+=chunkSize;this.tailSamples+=sample;break}else{this.chunkIndex++;this.tailOffset=0;this.tailSamples=0;if(this.stscIndex+1<this.track.stsc.length&&this.chunkIndex+1===this.track.stsc[this.stscIndex+1].first){this.stscIndex++}if(offset+length!==this.track.chunkOffsets[this.chunkIndex]){break}}}if(length>0){this.emit("data",this.stream.readBuffer(length));return this["break"]=this.chunkIndex===this.track.chunkOffsets.length}else{return this["break"]=true}});M4ADemuxer.prototype.parseChapters=function(){var bom,id,k,len,len1,nextTimestamp,point,ref,ref1,ref2,ref3,title,track;if(!(((ref=this.track.chapterTracks)!=null?ref.length:void 0)>0)){return true}id=this.track.chapterTracks[0];ref1=this.tracks;for(k=0,len1=ref1.length;k<len1;k++){track=ref1[k];if(track.id===id){break}}if(track.id!==id){this.emit("error","Chapter track does not exist.")}if(this.chapters==null){this.chapters=[]}while(this.chapters.length<track.seekPoints.length){point=track.seekPoints[this.chapters.length];if(!this.stream.available(point.position-this.stream.offset+32)){return false}this.stream.seek(point.position);len=this.stream.readUInt16();title=null;if(!this.stream.available(len)){return false}if(len>2){bom=this.stream.peekUInt16();if(bom===65279||bom===65534){title=this.stream.readString(len,"utf16-bom")}}if(title==null){title=this.stream.readString(len,"utf8")}nextTimestamp=(ref2=(ref3=track.seekPoints[this.chapters.length+1])!=null?ref3.timestamp:void 0)!=null?ref2:track.duration;this.chapters.push({title:title,timestamp:point.timestamp/track.timeScale*1e3|0,duration:(nextTimestamp-point.timestamp)/track.timeScale*1e3|0})}this.emit("chapters",this.chapters);return true};atom("moov.udta.meta",function(){this.metadata={};return this.stream.advance(4)});after("moov.udta.meta",function(){return this.emit("metadata",this.metadata)});meta=function(field,name,fn){return atom("moov.udta.meta.ilst."+field+".data",function(){this.stream.advance(8);this.len-=8;return fn.call(this,name)})};string=function(field){return this.metadata[field]=this.stream.readString(this.len,"utf8")};meta("©alb","album",string);meta("©arg","arranger",string);meta("©art","artist",string);meta("©ART","artist",string);meta("aART","albumArtist",string);meta("catg","category",string);meta("©com","composer",string);meta("©cpy","copyright",string);meta("cprt","copyright",string);meta("©cmt","comments",string);meta("©day","releaseDate",string);meta("desc","description",string);meta("©gen","genre",string);meta("©grp","grouping",string);meta("©isr","ISRC",string);meta("keyw","keywords",string);meta("©lab","recordLabel",string);meta("ldes","longDescription",string);meta("©lyr","lyrics",string);meta("©nam","title",string);meta("©phg","recordingCopyright",string);meta("©prd","producer",string);meta("©prf","performers",string);meta("purd","purchaseDate",string);meta("purl","podcastURL",string);meta("©swf","songwriter",string);meta("©too","encoder",string);meta("©wrt","composer",string);meta("covr","coverArt",function(field){return this.metadata[field]=this.stream.readBuffer(this.len)});genres=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Capella","Euro-House","Dance Hall"];meta("gnre","genre",function(field){return this.metadata[field]=genres[this.stream.readUInt16()-1]});meta("tmpo","tempo",function(field){return this.metadata[field]=this.stream.readUInt16()});meta("rtng","rating",function(field){var rating;rating=this.stream.readUInt8();return this.metadata[field]=rating===2?"Clean":rating!==0?"Explicit":"None"});diskTrack=function(field){this.stream.advance(2);this.metadata[field]=this.stream.readUInt16()+" of "+this.stream.readUInt16();return this.stream.advance(this.len-6)};meta("disk","diskNumber",diskTrack);meta("trkn","trackNumber",diskTrack);bool=function(field){return this.metadata[field]=this.stream.readUInt8()===1};meta("cpil","compilation",bool);meta("pcst","podcast",bool);meta("pgap","gapless",bool);return M4ADemuxer}(Demuxer);module.exports=M4ADemuxer}).call(this)},{"../demuxer":14}],19:[function(require,module,exports){(function(){var Demuxer,WAVEDemuxer,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Demuxer=require("../demuxer");WAVEDemuxer=function(superClass){var formats;extend(WAVEDemuxer,superClass);function WAVEDemuxer(){return WAVEDemuxer.__super__.constructor.apply(this,arguments)}Demuxer.register(WAVEDemuxer);WAVEDemuxer.probe=function(buffer){return buffer.peekString(0,4)==="RIFF"&&buffer.peekString(8,4)==="WAVE"};formats={1:"lpcm",3:"lpcm",6:"alaw",7:"ulaw"};WAVEDemuxer.prototype.readChunk=function(){var buffer,bytes,encoding;if(!this.readStart&&this.stream.available(12)){if(this.stream.readString(4)!=="RIFF"){return this.emit("error","Invalid WAV file.")}this.fileSize=this.stream.readUInt32(true);this.readStart=true;if(this.stream.readString(4)!=="WAVE"){return this.emit("error","Invalid WAV file.")}}while(this.stream.available(1)){if(!this.readHeaders&&this.stream.available(8)){this.type=this.stream.readString(4);this.len=this.stream.readUInt32(true)}switch(this.type){case"fmt ":encoding=this.stream.readUInt16(true);if(!(encoding in formats)){return this.emit("error","Unsupported format in WAV file.")}this.format={formatID:formats[encoding],floatingPoint:encoding===3,littleEndian:formats[encoding]==="lpcm",channelsPerFrame:this.stream.readUInt16(true),sampleRate:this.stream.readUInt32(true),framesPerPacket:1};this.stream.advance(4);this.stream.advance(2);this.format.bitsPerChannel=this.stream.readUInt16(true);this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame;this.emit("format",this.format);this.stream.advance(this.len-16);break;case"data":if(!this.sentDuration){bytes=this.format.bitsPerChannel/8;this.emit("duration",this.len/bytes/this.format.channelsPerFrame/this.format.sampleRate*1e3|0);this.sentDuration=true}buffer=this.stream.readSingleBuffer(this.len);this.len-=buffer.length;this.readHeaders=this.len>0;this.emit("data",buffer);break;default:if(!this.stream.available(this.len)){return}this.stream.advance(this.len)}if(this.type!=="data"){this.readHeaders=false}}};return WAVEDemuxer}(Demuxer)}).call(this)},{"../demuxer":14}],20:[function(require,module,exports){(function(){var AudioDevice,EventEmitter,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events");AudioDevice=function(superClass){var devices;extend(AudioDevice,superClass);function AudioDevice(sampleRate1,channels1){this.sampleRate=sampleRate1;this.channels=channels1;this.updateTime=bind(this.updateTime,this);this.playing=false;this.currentTime=0;this._lastTime=0}AudioDevice.prototype.start=function(){if(this.playing){return}this.playing=true;if(this.device==null){this.device=AudioDevice.create(this.sampleRate,this.channels)}if(!this.device){throw new Error("No supported audio device found.")}this._lastTime=this.device.getDeviceTime();this._timer=setInterval(this.updateTime,200);return this.device.on("refill",this.refill=function(_this){return function(buffer){return _this.emit("refill",buffer)}}(this))};AudioDevice.prototype.stop=function(){if(!this.playing){return}this.playing=false;this.device.off("refill",this.refill);return clearInterval(this._timer)};AudioDevice.prototype.destroy=function(){var ref;this.stop();return(ref=this.device)!=null?ref.destroy():void 0};AudioDevice.prototype.seek=function(currentTime){this.currentTime=currentTime;if(this.playing){this._lastTime=this.device.getDeviceTime()}return this.emit("timeUpdate",this.currentTime)};AudioDevice.prototype.updateTime=function(){var time;time=this.device.getDeviceTime();this.currentTime+=(time-this._lastTime)/this.device.sampleRate*1e3|0;this._lastTime=time;return this.emit("timeUpdate",this.currentTime)};devices=[];AudioDevice.register=function(device){return devices.push(device)};AudioDevice.create=function(sampleRate,channels){var device,i,len;for(i=0,len=devices.length;i<len;i++){device=devices[i];if(device.supported){return new device(sampleRate,channels)}}return null};return AudioDevice}(EventEmitter);module.exports=AudioDevice}).call(this)},{"./core/events":8}],21:[function(require,module,exports){(function(){var AVBuffer,AudioDevice,EventEmitter,MozillaAudioDevice,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;EventEmitter=require("../core/events");AudioDevice=require("../device");AVBuffer=require("../core/buffer");MozillaAudioDevice=function(superClass){var createTimer,destroyTimer;extend(MozillaAudioDevice,superClass);AudioDevice.register(MozillaAudioDevice);MozillaAudioDevice.supported=typeof Audio!=="undefined"&&Audio!==null&&"mozWriteAudio"in new Audio;function MozillaAudioDevice(sampleRate,channels){this.sampleRate=sampleRate;this.channels=channels;this.refill=bind(this.refill,this);this.audio=new Audio;this.audio.mozSetup(this.channels,this.sampleRate);this.writePosition=0;this.prebufferSize=this.sampleRate/2;this.tail=null;this.timer=createTimer(this.refill,100)}MozillaAudioDevice.prototype.refill=function(){var available,buffer,currentPosition,written;if(this.tail){written=this.audio.mozWriteAudio(this.tail);this.writePosition+=written;if(this.writePosition<this.tail.length){this.tail=this.tail.subarray(written)}else{this.tail=null}}currentPosition=this.audio.mozCurrentSampleOffset();available=currentPosition+this.prebufferSize-this.writePosition;if(available>0){buffer=new Float32Array(available);this.emit("refill",buffer);written=this.audio.mozWriteAudio(buffer);if(written<buffer.length){this.tail=buffer.subarray(written)}this.writePosition+=written}};MozillaAudioDevice.prototype.destroy=function(){return destroyTimer(this.timer)};MozillaAudioDevice.prototype.getDeviceTime=function(){return this.audio.mozCurrentSampleOffset()/this.channels};createTimer=function(fn,interval){var url,worker;url=AVBuffer.makeBlobURL("setInterval(function() { postMessage('ping'); }, "+interval+");");if(url==null){return setInterval(fn,interval)}worker=new Worker(url);worker.onmessage=fn;worker.url=url;return worker};destroyTimer=function(timer){if(timer.terminate){timer.terminate();return URL.revokeObjectURL(timer.url)}else{return clearInterval(timer)}};return MozillaAudioDevice}(EventEmitter)}).call(this)},{"../core/buffer":6,"../core/events":8,"../device":20}],22:[function(require,module,exports){function Resampler(fromSampleRate,toSampleRate,channels,inputBufferLength){this.fromSampleRate=+fromSampleRate;this.toSampleRate=+toSampleRate;this.channels=channels|0;this.inputBufferLength=inputBufferLength;this.initialize()}Resampler.prototype.initialize=function(){if(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0){if(this.fromSampleRate==this.toSampleRate){this.resampler=this.bypassResampler;this.ratioWeight=1}else{this.ratioWeight=this.fromSampleRate/this.toSampleRate;if(this.fromSampleRate<this.toSampleRate){this.compileLinearInterpolationFunction();this.lastWeight=1}else{this.compileMultiTapFunction();this.tailExists=false;this.lastWeight=0}var outputBufferSize=Math.ceil(this.inputBufferLength*this.toSampleRate/this.fromSampleRate/this.channels*1.01)*this.channels+this.channels;this.outputBuffer=new Float32Array(outputBufferSize);this.lastOutput=new Float32Array(this.channels)}}else{throw new Error("Invalid settings specified for the resampler.")}};Resampler.prototype.compileLinearInterpolationFunction=function(){var toCompile="var outputOffset = 0;    var bufferLength = buffer.length;    if (bufferLength > 0) {      var weight = this.lastWeight;      var firstWeight = 0;      var secondWeight = 0;      var sourceOffset = 0;      var outputOffset = 0;      var outputBuffer = this.outputBuffer;      for (; weight < 1; weight += "+this.ratioWeight+") {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;";for(var channel=0;channel<this.channels;++channel){toCompile+="outputBuffer[outputOffset++] = (this.lastOutput["+channel+"] * firstWeight) + (buffer["+channel+"] * secondWeight);"}toCompile+="}      weight -= 1;      for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; sourceOffset < bufferLength;) {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;";for(var channel=0;channel<this.channels;++channel){toCompile+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(channel>0?" + "+channel:"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+channel)+"] * secondWeight);"}toCompile+="weight += "+this.ratioWeight+";        sourceOffset = Math.floor(weight) * "+this.channels+";      }";for(var channel=0;channel<this.channels;++channel){toCompile+="this.lastOutput["+channel+"] = buffer[sourceOffset++];"}toCompile+="this.lastWeight = weight % 1;    }    return this.outputBuffer;";this.resampler=Function("buffer",toCompile)};Resampler.prototype.compileMultiTapFunction=function(){var toCompile="var outputOffset = 0;    var bufferLength = buffer.length;    if (bufferLength > 0) {      var weight = 0;";for(var channel=0;channel<this.channels;++channel){toCompile+="var output"+channel+" = 0;"}toCompile+="var actualPosition = 0;      var amountToNext = 0;      var alreadyProcessedTail = !this.tailExists;      this.tailExists = false;      var outputBuffer = this.outputBuffer;      var currentPosition = 0;      do {        if (alreadyProcessedTail) {          weight = "+this.ratioWeight+";";for(channel=0;channel<this.channels;++channel){toCompile+="output"+channel+" = 0;"}toCompile+="}        else {          weight = this.lastWeight;";for(channel=0;channel<this.channels;++channel){toCompile+="output"+channel+" = this.lastOutput["+channel+"];"}toCompile+="alreadyProcessedTail = true;        }        while (weight > 0 && actualPosition < bufferLength) {          amountToNext = 1 + actualPosition - currentPosition;          if (weight >= amountToNext) {";for(channel=0;channel<this.channels;++channel){toCompile+="output"+channel+" += buffer[actualPosition++] * amountToNext;"}toCompile+="currentPosition = actualPosition;            weight -= amountToNext;          }          else {";for(channel=0;channel<this.channels;++channel){toCompile+="output"+channel+" += buffer[actualPosition"+(channel>0?" + "+channel:"")+"] * weight;"}toCompile+="currentPosition += weight;            weight = 0;            break;          }        }        if (weight <= 0) {";for(channel=0;channel<this.channels;++channel){toCompile+="outputBuffer[outputOffset++] = output"+channel+" / "+this.ratioWeight+";"}toCompile+="}        else {          this.lastWeight = weight;";for(channel=0;channel<this.channels;++channel){toCompile+="this.lastOutput["+channel+"] = output"+channel+";"}toCompile+="this.tailExists = true;          break;        }      } while (actualPosition < bufferLength);    }    return this.outputBuffer;";this.resampler=Function("buffer",toCompile)};Resampler.prototype.bypassResampler=function(inputBuffer){return inputBuffer};module.exports=Resampler},{}],23:[function(require,module,exports){(function(global){(function(){var AudioDevice,EventEmitter,Resampler,WebAudioDevice,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;EventEmitter=require("../core/events");AudioDevice=require("../device");Resampler=require("./resampler");WebAudioDevice=function(superClass){var AudioContext,createProcessor,sharedContext;extend(WebAudioDevice,superClass);AudioDevice.register(WebAudioDevice);AudioContext=global.AudioContext||global.webkitAudioContext;WebAudioDevice.supported=AudioContext&&(typeof AudioContext.prototype[createProcessor="createScriptProcessor"]==="function"||typeof AudioContext.prototype[createProcessor="createJavaScriptNode"]==="function");sharedContext=null;function WebAudioDevice(sampleRate,channels1){this.sampleRate=sampleRate;this.channels=channels1;this.refill=bind(this.refill,this);this.context=sharedContext!=null?sharedContext:sharedContext=new AudioContext;this.deviceSampleRate=this.context.sampleRate;this.bufferSize=Math.ceil(4096/(this.deviceSampleRate/this.sampleRate)*this.channels);this.bufferSize+=this.bufferSize%this.channels;if(this.deviceSampleRate!==this.sampleRate){this.resampler=new Resampler(this.sampleRate,this.deviceSampleRate,this.channels,this.bufferSize)}this.node=this.context[createProcessor](4096,this.channels,this.channels);this.node.onaudioprocess=this.refill;this.node.connect(this.context.destination)}WebAudioDevice.prototype.refill=function(event){var channelCount,channels,data,i,j,k,l,n,outputBuffer,ref,ref1,ref2;outputBuffer=event.outputBuffer;channelCount=outputBuffer.numberOfChannels;channels=new Array(channelCount);for(i=j=0,ref=channelCount;j<ref;i=j+=1){channels[i]=outputBuffer.getChannelData(i)}data=new Float32Array(this.bufferSize);this.emit("refill",data);if(this.resampler){data=this.resampler.resampler(data)}for(i=k=0,ref1=outputBuffer.length;k<ref1;i=k+=1){for(n=l=0,ref2=channelCount;l<ref2;n=l+=1){channels[n][i]=data[i*channelCount+n]}}};WebAudioDevice.prototype.destroy=function(){return this.node.disconnect(0)};WebAudioDevice.prototype.getDeviceTime=function(){return this.context.currentTime*this.sampleRate};return WebAudioDevice}(EventEmitter)}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../core/events":8,"../device":20,"./resampler":22}],24:[function(require,module,exports){(function(){var Filter;Filter=function(){function Filter(context,key){if(context&&key){Object.defineProperty(this,"value",{get:function(){return context[key]}})}}Filter.prototype.process=function(buffer){};return Filter}();module.exports=Filter}).call(this)},{}],25:[function(require,module,exports){(function(){var BalanceFilter,Filter,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Filter=require("../filter");BalanceFilter=function(superClass){extend(BalanceFilter,superClass);function BalanceFilter(){return BalanceFilter.__super__.constructor.apply(this,arguments)}BalanceFilter.prototype.process=function(buffer){var i,j,pan,ref;if(this.value===0){return}pan=Math.max(-50,Math.min(50,this.value));for(i=j=0,ref=buffer.length;j<ref;i=j+=2){buffer[i]*=Math.min(1,(50-pan)/50);buffer[i+1]*=Math.min(1,(50+pan)/50)}};return BalanceFilter}(Filter);module.exports=BalanceFilter}).call(this)},{"../filter":24}],26:[function(require,module,exports){(function(){var Filter,VolumeFilter,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;Filter=require("../filter");VolumeFilter=function(superClass){extend(VolumeFilter,superClass);function VolumeFilter(){return VolumeFilter.__super__.constructor.apply(this,arguments)}VolumeFilter.prototype.process=function(buffer){var i,j,ref,vol;if(this.value>=100){return}vol=Math.max(0,Math.min(100,this.value))/100;for(i=j=0,ref=buffer.length;j<ref;i=j+=1){buffer[i]*=vol}};return VolumeFilter}(Filter);module.exports=VolumeFilter}).call(this)},{"../filter":24}],27:[function(require,module,exports){(function(){var Asset,AudioDevice,BalanceFilter,EventEmitter,Player,Queue,VolumeFilter,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events");Asset=require("./asset");VolumeFilter=require("./filters/volume");BalanceFilter=require("./filters/balance");Queue=require("./queue");AudioDevice=require("./device");Player=function(superClass){extend(Player,superClass);function Player(asset){this.asset=asset;this.startPlaying=bind(this.startPlaying,this);this.playing=false;this.buffered=0;this.currentTime=0;this.duration=0;this.volume=100;this.pan=0;this.metadata={};this.filters=[new VolumeFilter(this,"volume"),new BalanceFilter(this,"pan")];this.asset.on("buffer",function(_this){return function(buffered){_this.buffered=buffered;return _this.emit("buffer",_this.buffered)}}(this));this.asset.on("decodeStart",function(_this){return function(){_this.queue=new Queue(_this.asset);return _this.queue.once("ready",_this.startPlaying)}}(this));this.asset.on("format",function(_this){return function(format){_this.format=format;return _this.emit("format",_this.format)}}(this));this.asset.on("metadata",function(_this){return function(metadata){_this.metadata=metadata;return _this.emit("metadata",_this.metadata)}}(this));this.asset.on("duration",function(_this){return function(duration){_this.duration=duration;return _this.emit("duration",_this.duration)}}(this));this.asset.on("error",function(_this){return function(error){return _this.emit("error",error)}}(this))}Player.fromURL=function(url,opts){return new Player(Asset.fromURL(url,opts))};Player.fromFile=function(file){return new Player(Asset.fromFile(file))};Player.fromBuffer=function(buffer){return new Player(Asset.fromBuffer(buffer))};Player.prototype.preload=function(){if(!this.asset){return}this.startedPreloading=true;return this.asset.start(false)};Player.prototype.play=function(){var ref;if(this.playing){return}if(!this.startedPreloading){this.preload()}this.playing=true;return(ref=this.device)!=null?ref.start():void 0};Player.prototype.pause=function(){var ref;if(!this.playing){return}this.playing=false;return(ref=this.device)!=null?ref.stop():void 0};Player.prototype.togglePlayback=function(){if(this.playing){return this.pause()}else{return this.play()}};Player.prototype.stop=function(){var ref;this.pause();this.asset.stop();return(ref=this.device)!=null?ref.destroy():void 0};Player.prototype.seek=function(timestamp){var ref;if((ref=this.device)!=null){ref.stop()}this.queue.once("ready",function(_this){return function(){var ref1,ref2;if((ref1=_this.device)!=null){ref1.seek(_this.currentTime)}if(_this.playing){return(ref2=_this.device)!=null?ref2.start():void 0}}}(this));timestamp=timestamp/1e3*this.format.sampleRate;timestamp=this.asset.decoder.seek(timestamp);this.currentTime=timestamp/this.format.sampleRate*1e3|0;this.queue.reset();return this.currentTime};Player.prototype.startPlaying=function(){var frame,frameOffset;frame=this.queue.read();frameOffset=0;this.device=new AudioDevice(this.format.sampleRate,this.format.channelsPerFrame);this.device.on("timeUpdate",function(_this){return function(currentTime){_this.currentTime=currentTime;return _this.emit("progress",_this.currentTime)}}(this));this.refill=function(_this){return function(buffer){var bufferOffset,filter,i,j,k,len,max,ref,ref1;if(!_this.playing){return}if(!frame){frame=_this.queue.read();frameOffset=0}bufferOffset=0;while(frame&&bufferOffset<buffer.length){max=Math.min(frame.length-frameOffset,buffer.length-bufferOffset);for(i=j=0,ref=max;j<ref;i=j+=1){buffer[bufferOffset++]=frame[frameOffset++]}if(frameOffset===frame.length){frame=_this.queue.read();frameOffset=0}}ref1=_this.filters;for(k=0,len=ref1.length;k<len;k++){filter=ref1[k];filter.process(buffer)}if(!frame){if(_this.queue.ended){_this.currentTime=_this.duration;_this.emit("progress",_this.currentTime);_this.emit("end");_this.stop()}else{_this.device.stop()}}}}(this);this.device.on("refill",this.refill);if(this.playing){this.device.start()}return this.emit("ready")};Player.prototype.destroy=function(){var ref,ref1;this.stop();if((ref=this.device)!=null){ref.off()}if((ref1=this.asset)!=null){ref1.destroy()}return this.off()};return Player}(EventEmitter);module.exports=Player}).call(this)},{"./asset":1,"./core/events":8,"./device":20,"./filters/balance":25,"./filters/volume":26,"./queue":28}],28:[function(require,module,exports){(function(){var EventEmitter,Queue,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events");Queue=function(superClass){extend(Queue,superClass);function Queue(asset){this.asset=asset;this.write=bind(this.write,this);this.readyMark=64;this.finished=false;this.buffering=true;this.ended=false;this.buffers=[];this.asset.on("data",this.write);this.asset.on("end",function(_this){return function(){return _this.ended=true}}(this));this.asset.decodePacket()}Queue.prototype.write=function(buffer){if(buffer){this.buffers.push(buffer)}if(this.buffering){if(this.buffers.length>=this.readyMark||this.ended){this.buffering=false;return this.emit("ready")}else{return this.asset.decodePacket()}}};Queue.prototype.read=function(){if(this.buffers.length===0){return null}this.asset.decodePacket();return this.buffers.shift()};Queue.prototype.reset=function(){this.buffers.length=0;this.buffering=true;return this.asset.decodePacket()};return Queue}(EventEmitter);module.exports=Queue}).call(this)},{"./core/events":8}],29:[function(require,module,exports){var AVBuffer,EventEmitter,FileSource,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};EventEmitter=require("../../core/events");AVBuffer=require("../../core/buffer");FileSource=function(_super){__extends(FileSource,_super);function FileSource(file){this.file=file;if(typeof FileReader==="undefined"||FileReader===null){return this.emit("error","This browser does not have FileReader support.")}this.offset=0;this.length=this.file.size;this.chunkSize=1<<20;this.file[this.slice="slice"]||this.file[this.slice="webkitSlice"]||this.file[this.slice="mozSlice"]}FileSource.prototype.start=function(){if(this.reader){if(!this.active){return this.loop()}}this.reader=new FileReader;this.active=true;this.reader.onload=function(_this){return function(e){var buf;buf=new AVBuffer(new Uint8Array(e.target.result));_this.offset+=buf.length;_this.emit("data",buf);_this.active=false;if(_this.offset<_this.length){return _this.loop()}}}(this);this.reader.onloadend=function(_this){return function(){if(_this.offset===_this.length){_this.emit("end");return _this.reader=null}}}(this);this.reader.onerror=function(_this){return function(e){return _this.emit("error",e)}}(this);this.reader.onprogress=function(_this){return function(e){return _this.emit("progress",(_this.offset+e.loaded)/_this.length*100)}}(this);return this.loop()};FileSource.prototype.loop=function(){var blob,endPos;this.active=true;endPos=Math.min(this.offset+this.chunkSize,this.length);blob=this.file[this.slice](this.offset,endPos);return this.reader.readAsArrayBuffer(blob)};FileSource.prototype.pause=function(){var _ref;this.active=false;try{return(_ref=this.reader)!=null?_ref.abort():void 0}catch(_error){}};FileSource.prototype.reset=function(){this.pause();return this.offset=0};return FileSource}(EventEmitter);module.exports=FileSource},{"../../core/buffer":6,"../../core/events":8}],30:[function(require,module,exports){var AVBuffer,EventEmitter,HTTPSource,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};EventEmitter=require("../../core/events");AVBuffer=require("../../core/buffer");HTTPSource=function(_super){__extends(HTTPSource,_super);function HTTPSource(url,opts){this.url=url;this.opts=opts!=null?opts:{};this.chunkSize=1<<20;this.inflight=false;if(this.opts.length){this.length=this.opts.length}this.reset()}HTTPSource.prototype.start=function(){if(this.length){if(!this.inflight){return this.loop()}}this.inflight=true;this.xhr=new XMLHttpRequest;this.xhr.onload=function(_this){return function(event){_this.length=parseInt(_this.xhr.getResponseHeader("Content-Length"));_this.inflight=false;return _this.loop()}}(this);this.xhr.onerror=function(_this){return function(err){_this.pause();return _this.emit("error",err)}}(this);this.xhr.onabort=function(_this){return function(event){return _this.inflight=false}}(this);this.xhr.open("HEAD",this.url,true);return this.xhr.send(null)};HTTPSource.prototype.loop=function(){var endPos;if(this.inflight||!this.length){return this.emit("error","Something is wrong in HTTPSource.loop")}this.inflight=true;this.xhr=new XMLHttpRequest;this.xhr.onload=function(_this){return function(event){var buf,buffer,i,txt,_i,_ref;if(_this.xhr.response){buf=new Uint8Array(_this.xhr.response)}else{txt=_this.xhr.responseText;buf=new Uint8Array(txt.length);for(i=_i=0,_ref=txt.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i){buf[i]=txt.charCodeAt(i)&255}}buffer=new AVBuffer(buf);_this.offset+=buffer.length;_this.emit("data",buffer);if(_this.offset>=_this.length){_this.emit("end")}_this.inflight=false;if(!(_this.offset>=_this.length)){return _this.loop()}}}(this);this.xhr.onprogress=function(_this){return function(event){return _this.emit("progress",(_this.offset+event.loaded)/_this.length*100)}}(this);this.xhr.onerror=function(_this){return function(err){_this.emit("error",err);return _this.pause()}}(this);this.xhr.onabort=function(_this){return function(event){return _this.inflight=false}}(this);this.xhr.open("GET",this.url,true);this.xhr.responseType="arraybuffer";endPos=Math.min(this.offset+this.chunkSize,this.length-1);this.xhr.setRequestHeader("If-None-Match","webkit-no-cache");this.xhr.setRequestHeader("Range","bytes="+this.offset+"-"+endPos);this.xhr.overrideMimeType("text/plain; charset=x-user-defined");return this.xhr.send(null)};HTTPSource.prototype.pause=function(){var _ref;this.inflight=false;return(_ref=this.xhr)!=null?_ref.abort():void 0};HTTPSource.prototype.reset=function(){this.pause();return this.offset=0};return HTTPSource}(EventEmitter);module.exports=HTTPSource},{"../../core/buffer":6,"../../core/events":8}],31:[function(require,module,exports){(function(global){(function(){var AVBuffer,BufferList,BufferSource,EventEmitter,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;EventEmitter=require("../core/events");BufferList=require("../core/bufferlist");AVBuffer=require("../core/buffer");BufferSource=function(superClass){var clearImmediate,setImmediate;extend(BufferSource,superClass);function BufferSource(input){this.loop=bind(this.loop,this);if(input instanceof BufferList){this.list=input}else{this.list=new BufferList;this.list.append(new AVBuffer(input))}this.paused=true}setImmediate=global.setImmediate||function(fn){return global.setTimeout(fn,0)};clearImmediate=global.clearImmediate||function(timer){return global.clearTimeout(timer)};BufferSource.prototype.start=function(){this.paused=false;return this._timer=setImmediate(this.loop)};BufferSource.prototype.loop=function(){this.emit("progress",(this.list.numBuffers-this.list.availableBuffers+1)/this.list.numBuffers*100|0);this.emit("data",this.list.first);if(this.list.advance()){return setImmediate(this.loop)}else{return this.emit("end")}};BufferSource.prototype.pause=function(){clearImmediate(this._timer);return this.paused=true};BufferSource.prototype.reset=function(){this.pause();return this.list.rewind()};return BufferSource}(EventEmitter);module.exports=BufferSource}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../core/buffer":6,"../core/bufferlist":7,"../core/events":8}],32:[function(require,module,exports){var key,val,_ref;_ref=require("./src/aurora");for(key in _ref){val=_ref[key];exports[key]=val}require("./src/devices/webaudio");require("./src/devices/mozilla")},{"./src/aurora":2,"./src/devices/mozilla":21,"./src/devices/webaudio":23}]},{},[32])(32)});(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){exports.FLACDemuxer=require("./src/demuxer");exports.FLACDecoder=require("./src/decoder");require("./src/ogg")},{"./src/decoder":2,"./src/demuxer":3,"./src/ogg":4}],2:[function(require,module,exports){var AV=window.AV;var FLACDecoder=AV.Decoder.extend(function(){AV.Decoder.register("flac",this);this.prototype.setCookie=function(cookie){this.cookie=cookie;this.decoded=[];for(var i=0;i<this.format.channelsPerFrame;i++){this.decoded[i]=new Int32Array(cookie.maxBlockSize)}this.lpc_total=new Int32Array(2)};const BLOCK_SIZES=new Int16Array([0,192,576<<0,576<<1,576<<2,576<<3,0,0,256<<0,256<<1,256<<2,256<<3,256<<4,256<<5,256<<6,256<<7]);const SAMPLE_RATES=new Int32Array([0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0]);const SAMPLE_SIZES=new Int8Array([0,8,12,0,16,20,24,0]);const MAX_CHANNELS=8,CHMODE_INDEPENDENT=0,CHMODE_LEFT_SIDE=8,CHMODE_RIGHT_SIDE=9,CHMODE_MID_SIDE=10;this.prototype.readChunk=function(){var stream=this.bitstream;if(!stream.available(32))return;if((stream.read(15)&32767)!==32764)throw new Error("Invalid sync code");var isVarSize=stream.read(1),bsCode=stream.read(4),srCode=stream.read(4),chMode=stream.read(4),bpsCode=stream.read(3);stream.advance(1);this.chMode=chMode;var channels;if(chMode<MAX_CHANNELS){channels=chMode+1;this.chMode=CHMODE_INDEPENDENT}else if(chMode<=CHMODE_MID_SIDE){channels=2}else{throw new Error("Invalid channel mode")}if(channels!==this.format.channelsPerFrame)throw new Error("Switching channel layout mid-stream not supported.");if(bpsCode===3||bpsCode===7)throw new Error("Invalid sample size code");this.bps=SAMPLE_SIZES[bpsCode];if(this.bps!==this.format.bitsPerChannel)throw new Error("Switching bits per sample mid-stream not supported.");var ones=0;while(stream.read(1)===1)ones++;var frame_or_sample_num=stream.read(7-ones);for(;ones>1;ones--){stream.advance(2);frame_or_sample_num=frame_or_sample_num<<6|stream.read(6)}if(bsCode===0)throw new Error("Reserved blocksize code");else if(bsCode===6)this.blockSize=stream.read(8)+1;else if(bsCode===7)this.blockSize=stream.read(16)+1;else this.blockSize=BLOCK_SIZES[bsCode];var sampleRate;if(srCode<12)sampleRate=SAMPLE_RATES[srCode];else if(srCode===12)sampleRate=stream.read(8)*1e3;else if(srCode===13)sampleRate=stream.read(16);else if(srCode===14)sampleRate=stream.read(16)*10;else throw new Error("Invalid sample rate code");stream.advance(8);for(var i=0;i<channels;i++)this.decodeSubframe(i);stream.align();stream.advance(16);var is32=this.bps>16,output=new ArrayBuffer(this.blockSize*channels*(is32?4:2)),buf=is32?new Int32Array(output):new Int16Array(output),blockSize=this.blockSize,decoded=this.decoded,j=0;switch(this.chMode){case CHMODE_INDEPENDENT:for(var k=0;k<blockSize;k++){for(var i=0;i<channels;i++){buf[j++]=decoded[i][k]}}break;case CHMODE_LEFT_SIDE:for(var i=0;i<blockSize;i++){var left=decoded[0][i],right=decoded[1][i];buf[j++]=left;buf[j++]=left-right}break;case CHMODE_RIGHT_SIDE:for(var i=0;i<blockSize;i++){var left=decoded[0][i],right=decoded[1][i];buf[j++]=left+right;buf[j++]=right}break;case CHMODE_MID_SIDE:for(var i=0;i<blockSize;i++){var left=decoded[0][i],right=decoded[1][i];left-=right>>1;buf[j++]=left+right;buf[j++]=left}break}return buf};this.prototype.decodeSubframe=function(channel){var wasted=0,stream=this.bitstream,blockSize=this.blockSize,decoded=this.decoded;this.curr_bps=this.bps;if(channel===0){if(this.chMode===CHMODE_RIGHT_SIDE)this.curr_bps++}else{if(this.chMode===CHMODE_LEFT_SIDE||this.chMode===CHMODE_MID_SIDE)this.curr_bps++}if(stream.read(1))throw new Error("Invalid subframe padding");var type=stream.read(6);if(stream.read(1)){wasted=1;while(!stream.read(1))wasted++;this.curr_bps-=wasted}if(this.curr_bps>32)throw new Error("decorrelated bit depth > 32 ("+this.curr_bps+")");if(type===0){var tmp=stream.read(this.curr_bps,true);for(var i=0;i<blockSize;i++)decoded[channel][i]=tmp}else if(type===1){var bps=this.curr_bps;for(var i=0;i<blockSize;i++)decoded[channel][i]=stream.read(bps,true)}else if(type>=8&&type<=12){this.decode_subframe_fixed(channel,type&~8)}else if(type>=32){this.decode_subframe_lpc(channel,(type&~32)+1)}else{throw new Error("Invalid coding type")}if(wasted){for(var i=0;i<blockSize;i++)decoded[channel][i]<<=wasted}};this.prototype.decode_subframe_fixed=function(channel,predictor_order){var decoded=this.decoded[channel],stream=this.bitstream,bps=this.curr_bps;for(var i=0;i<predictor_order;i++)decoded[i]=stream.read(bps,true);this.decode_residuals(channel,predictor_order);var a=0,b=0,c=0,d=0;if(predictor_order>0)a=decoded[predictor_order-1];if(predictor_order>1)b=a-decoded[predictor_order-2];if(predictor_order>2)c=b-decoded[predictor_order-2]+decoded[predictor_order-3];if(predictor_order>3)d=c-decoded[predictor_order-2]+2*decoded[predictor_order-3]-decoded[predictor_order-4];switch(predictor_order){case 0:break;case 1:case 2:case 3:case 4:var abcd=new Int32Array([a,b,c,d]),blockSize=this.blockSize;for(var i=predictor_order;i<blockSize;i++){abcd[predictor_order-1]+=decoded[i];for(var j=predictor_order-2;j>=0;j--){abcd[j]+=abcd[j+1]}decoded[i]=abcd[0]}break;default:throw new Error("Invalid Predictor Order "+predictor_order)}};this.prototype.decode_subframe_lpc=function(channel,predictor_order){var stream=this.bitstream,decoded=this.decoded[channel],bps=this.curr_bps,blockSize=this.blockSize;for(var i=0;i<predictor_order;i++){decoded[i]=stream.read(bps,true)}var coeff_prec=stream.read(4)+1;if(coeff_prec===16)throw new Error("Invalid coefficient precision");var qlevel=stream.read(5,true);if(qlevel<0)throw new Error("Negative qlevel, maybe buggy stream");var coeffs=new Int32Array(32);for(var i=0;i<predictor_order;i++){coeffs[i]=stream.read(coeff_prec,true)}this.decode_residuals(channel,predictor_order);if(this.bps<=16){for(var i=predictor_order;i<blockSize-1;i+=2){var d=decoded[i-predictor_order],s0=0,s1=0,c=0;for(var j=predictor_order-1;j>0;j--){c=coeffs[j];s0+=c*d;d=decoded[i-j];s1+=c*d}c=coeffs[0];s0+=c*d;d=decoded[i]+=s0>>qlevel;s1+=c*d;decoded[i+1]+=s1>>qlevel}if(i<blockSize){var sum=0;for(var j=0;j<predictor_order;j++)sum+=coeffs[j]*decoded[i-j-1];decoded[i]+=sum>>qlevel}}else{var total=this.lpc_total;for(var i=predictor_order;i<blockSize;i++){total[0]=0;total[1]=0;for(j=0;j<predictor_order;j++){multiply_add(total,coeffs[j],decoded[i-j-1])}decoded[i]+=total[0]>>>qlevel|total[1]<<32-qlevel}}};const TWO_PWR_32_DBL=Math.pow(2,32);function multiply_add(total,a,b){var r=a*b;var n=r<0;if(n)r=-r;var r_low=r%TWO_PWR_32_DBL|0;var r_high=r/TWO_PWR_32_DBL|0;if(n){r_low=~r_low+1;r_high=~r_high}var a48=total[1]>>>16;var a32=total[1]&65535;var a16=total[0]>>>16;var a00=total[0]&65535;var b48=r_high>>>16;var b32=r_high&65535;var b16=r_low>>>16;var b00=r_low&65535;var c48=0,c32=0,c16=0,c00=0;c00+=a00+b00;c16+=c00>>>16;c00&=65535;c16+=a16+b16;c32+=c16>>>16;c16&=65535;c32+=a32+b32;c48+=c32>>>16;c32&=65535;c48+=a48+b48;c48&=65535;total[0]=c16<<16|c00;total[1]=c48<<16|c32}const INT_MAX=32767;this.prototype.decode_residuals=function(channel,predictor_order){var stream=this.bitstream,method_type=stream.read(2);if(method_type>1)throw new Error("Illegal residual coding method "+method_type);var rice_order=stream.read(4),samples=this.blockSize>>>rice_order;if(predictor_order>samples)throw new Error("Invalid predictor order "+predictor_order+" > "+samples);var decoded=this.decoded[channel],sample=predictor_order,i=predictor_order;for(var partition=0;partition<1<<rice_order;partition++){var tmp=stream.read(method_type===0?4:5);if(tmp===(method_type===0?15:31)){tmp=stream.read(5);for(;i<samples;i++)decoded[sample++]=stream.read(tmp,true)}else{for(;i<samples;i++)decoded[sample++]=this.golomb(tmp,INT_MAX,0)}i=0}};const MIN_CACHE_BITS=25;this.prototype.golomb=function(k,limit,esc_len){var data=this.bitstream,offset=data.bitPosition,buf=data.peek(32-offset)<<offset,v=0;var log=31-clz(buf|1);if(log-k>=32-MIN_CACHE_BITS&&32-log<limit){buf>>>=log-k;buf+=30-log<<k;data.advance(32+k-log);v=buf}else{for(var i=0;data.read(1)===0;i++)buf=data.peek(32-offset)<<offset;if(i<limit-1){if(k)buf=data.read(k);else buf=0;v=buf+(i<<k)}else if(i===limit-1){buf=data.read(esc_len);v=buf+1}else{v=-1}}return v>>1^-(v&1)};function clz(input){var output=0,curbyte=0;while(true){curbyte=input>>>24;if(curbyte)break;output+=8;curbyte=input>>>16;if(curbyte&255)break;output+=8;curbyte=input>>>8;if(curbyte&255)break;output+=8;curbyte=input;if(curbyte&255)break;output+=8;return output}if(!(curbyte&240))output+=4;else curbyte>>>=4;if(curbyte&8)return output;if(curbyte&4)return output+1;if(curbyte&2)return output+2;if(curbyte&1)return output+3;return output+4}});module.exports=FLACDecoder},{}],3:[function(require,module,exports){var AV=window.AV;var FLACDemuxer=AV.Demuxer.extend(function(){AV.Demuxer.register(this);this.probe=function(buffer){return buffer.peekString(0,4)==="fLaC"};const STREAMINFO=0,PADDING=1,APPLICATION=2,SEEKTABLE=3,VORBIS_COMMENT=4,CUESHEET=5,PICTURE=6,INVALID=127,STREAMINFO_SIZE=34;this.prototype.readChunk=function(){var stream=this.stream;if(!this.readHeader&&stream.available(4)){if(stream.readString(4)!=="fLaC")return this.emit("error","Invalid FLAC file.");this.readHeader=true}while(stream.available(1)&&!this.last){if(!this.readBlockHeaders){var tmp=stream.readUInt8();this.last=(tmp&128)===128,this.type=tmp&127,this.size=stream.readUInt24()}if(!this.foundStreamInfo&&this.type!==STREAMINFO)return this.emit("error","STREAMINFO must be the first block");if(!stream.available(this.size))return;switch(this.type){case STREAMINFO:if(this.foundStreamInfo)return this.emit("error","STREAMINFO can only occur once.");if(this.size!==STREAMINFO_SIZE)return this.emit("error","STREAMINFO size is wrong.");this.foundStreamInfo=true;var bitstream=new AV.Bitstream(stream);var cookie={minBlockSize:bitstream.read(16),maxBlockSize:bitstream.read(16),minFrameSize:bitstream.read(24),maxFrameSize:bitstream.read(24)};this.format={formatID:"flac",sampleRate:bitstream.read(20),channelsPerFrame:bitstream.read(3)+1,bitsPerChannel:bitstream.read(5)+1};this.emit("format",this.format);this.emit("cookie",cookie);var sampleCount=bitstream.read(36);this.emit("duration",sampleCount/this.format.sampleRate*1e3|0);stream.advance(16);this.readBlockHeaders=false;break;case SEEKTABLE:for(var s=0;s<this.size/18;s++){if(stream.peekUInt32(0)==4294967295&&stream.peekUInt32(1)==4294967295){stream.advance(18)}else{if(stream.readUInt32()>0){this.emit("error","Seek points with sample number >UInt32 not supported")}var samplenum=stream.readUInt32();if(stream.readUInt32()>0){this.emit("error","Seek points with stream offset >UInt32 not supported")}var offset=stream.readUInt32();stream.advance(2);this.addSeekPoint(offset,samplenum)}}break;case VORBIS_COMMENT:this.metadata||(this.metadata={});var len=stream.readUInt32(true);this.metadata.vendor=stream.readString(len);var length=stream.readUInt32(true);for(var i=0;i<length;i++){len=stream.readUInt32(true);var str=stream.readString(len,"utf8"),idx=str.indexOf("=");this.metadata[str.slice(0,idx).toLowerCase()]=str.slice(idx+1)}break;case PICTURE:var type=stream.readUInt32();if(type!==3){stream.advance(this.size-4)}else{var mimeLen=stream.readUInt32(),mime=stream.readString(mimeLen),descLen=stream.readUInt32(),description=stream.readString(descLen),width=stream.readUInt32(),height=stream.readUInt32(),depth=stream.readUInt32(),colors=stream.readUInt32(),length=stream.readUInt32(),picture=stream.readBuffer(length);this.metadata||(this.metadata={});this.metadata.coverArt=picture}break;default:stream.advance(this.size);this.readBlockHeaders=false}if(this.last&&this.metadata)this.emit("metadata",this.metadata)}while(stream.available(1)&&this.last){var buffer=stream.readSingleBuffer(stream.remainingBytes());this.emit("data",buffer)}}});module.exports=FLACDemuxer},{}],4:[function(require,module,exports){var AV=window.AV;try{var OggDemuxer=window.AV.OggDemuxer}catch(e){}if(!OggDemuxer)return;OggDemuxer.plugins.push({magic:"FLAC",init:function(){this.list=new AV.BufferList;this.stream=new AV.Stream(this.list)},readHeaders:function(packet){var stream=this.stream;this.list.append(new AV.Buffer(packet));stream.advance(5);if(stream.readUInt8()!=1)throw new Error("Unsupported FLAC version");stream.advance(3);if(stream.peekString(0,4)!="fLaC")throw new Error("Not flac");this.flac=AV.Demuxer.find(stream.peekSingleBuffer(0,stream.remainingBytes()));if(!this.flac)throw new Error("Flac demuxer not found");this.flac.prototype.readChunk.call(this);return true},readPacket:function(packet){this.list.append(new AV.Buffer(packet));this.flac.prototype.readChunk.call(this)}})},{}]},{},[1]);(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){exports.MP3Demuxer=require("./src/demuxer");exports.MP3Decoder=require("./src/decoder")},{"./src/decoder":2,"./src/demuxer":3}],2:[function(require,module,exports){(function(global){var AV=typeof window!=="undefined"?window["AV"]:typeof global!=="undefined"?global["AV"]:null;var MP3FrameHeader=require("./header");var MP3Stream=require("./stream");var MP3Frame=require("./frame");var MP3Synth=require("./synth");var Layer1=require("./layer1");var Layer2=require("./layer2");var Layer3=require("./layer3");var MP3Decoder=AV.Decoder.extend(function(){AV.Decoder.register("mp3",this);this.prototype.init=function(){this.mp3_stream=new MP3Stream(this.bitstream);this.frame=new MP3Frame;this.synth=new MP3Synth;this.seeking=false};this.prototype.readChunk=function(){var stream=this.mp3_stream;var frame=this.frame;var synth=this.synth;if(this.seeking){while(true){try{frame.decode(stream);break}catch(err){if(err instanceof AV.UnderflowError)throw err}}this.seeking=false}else{frame.decode(stream)}synth.frame(frame);var data=synth.pcm.samples,channels=synth.pcm.channels,len=synth.pcm.length,output=new Float32Array(len*channels),j=0;for(var k=0;k<len;k++){for(var i=0;i<channels;i++){output[j++]=data[i][k]}}return output};this.prototype.seek=function(timestamp){var offset;if(this.demuxer.seekPoints.length>0){timestamp=this._super(timestamp);offset=this.stream.offset}else{offset=timestamp*this.format.bitrate/8/this.format.sampleRate}this.mp3_stream.reset(offset);for(var i=0;i<4096;i++){var pos=offset+i;for(var j=0;j<3;j++){this.mp3_stream.reset(pos);try{var header=MP3FrameHeader.decode(this.mp3_stream)}catch(e){break}var size=header.framesize();if(size==null)break;pos+=size}if(j===3)break}if(j!==3)i=0;this.mp3_stream.reset(offset+i);if(this.demuxer.seekPoints.length===0)timestamp=this.stream.offset/(this.format.bitrate/8)*this.format.sampleRate;this.seeking=true;return timestamp}});module.exports=MP3Decoder}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./frame":4,"./header":5,"./layer1":9,"./layer2":10,"./layer3":11,"./stream":12,"./synth":13}],3:[function(require,module,exports){(function(global){var AV=typeof window!=="undefined"?window["AV"]:typeof global!=="undefined"?global["AV"]:null;var ID3v23Stream=require("./id3").ID3v23Stream;var ID3v22Stream=require("./id3").ID3v22Stream;var MP3FrameHeader=require("./header");var MP3Stream=require("./stream");var MP3Demuxer=AV.Demuxer.extend(function(){AV.Demuxer.register(this);this.probe=function(stream){var off=stream.offset;var id3header=MP3Demuxer.getID3v2Header(stream);if(id3header)stream.advance(10+id3header.length);var s=new MP3Stream(new AV.Bitstream(stream));var header=null;try{header=MP3FrameHeader.decode(s)}catch(e){}stream.seek(off);return!!header};this.getID3v2Header=function(stream){if(stream.peekString(0,3)=="ID3"){stream=AV.Stream.fromBuffer(stream.peekBuffer(0,10));stream.advance(3);var major=stream.readUInt8();var minor=stream.readUInt8();var flags=stream.readUInt8();var bytes=stream.readBuffer(4).data;var length=bytes[0]<<21|bytes[1]<<14|bytes[2]<<7|bytes[3];return{version:"2."+major+"."+minor,major:major,minor:minor,flags:flags,length:length}}return null};const XING_OFFSETS=[[32,17],[17,9]];this.prototype.parseDuration=function(header,off){var stream=this.stream;var frames;if(this.metadata){var mllt=this.metadata.MPEGLocationLookupTable;if(mllt){var bitstream=new AV.Bitstream(AV.Stream.fromBuffer(mllt.data));var refSize=mllt.bitsForBytesDeviation+mllt.bitsForMillisecondsDev;var samples=0;var bytes=0;while(bitstream.available(refSize)){this.addSeekPoint(bytes,samples);var bytesDev=bitstream.read(mllt.bitsForBytesDeviation);bitstream.advance(mllt.bitsForMillisecondsDev);bytes+=mllt.bytesBetweenReference+bytesDev;samples+=mllt.framesBetweenReference*header.nbsamples()*32}this.addSeekPoint(bytes,samples)}if(this.metadata.length){this.emit("duration",parseInt(this.metadata.length,10));return true}}var offset=stream.offset;if(!header||header.layer!==3)return false;stream.advance(XING_OFFSETS[header.flags&MP3FrameHeader.FLAGS.LSF_EXT?1:0][header.nchannels()===1?1:0]);var tag=stream.readString(4);if(tag==="Xing"||tag==="Info"){var flags=stream.readUInt32();if(flags&1)frames=stream.readUInt32();if(flags&2)var size=stream.readUInt32();if(flags&4&&frames&&size&&this.seekPoints.length===0){for(var i=0;i<100;i++){var b=stream.readUInt8();var pos=b/256*size|0;var time=i/100*(frames*header.nbsamples()*32)|0;this.addSeekPoint(pos,time)}}if(flags&8)stream.advance(4)}else{stream.seek(off+4+32);tag=stream.readString(4);if(tag=="VBRI"&&stream.readUInt16()===1){stream.advance(4);stream.advance(4);frames=stream.readUInt32();if(this.seekPoints.length===0){var entries=stream.readUInt16();var scale=stream.readUInt16();var bytesPerEntry=stream.readUInt16();var framesPerEntry=stream.readUInt16();var fn="readUInt"+bytesPerEntry*8;var pos=0;for(var i=0;i<entries;i++){this.addSeekPoint(pos,i*framesPerEntry*header.nbsamples()*32|0);pos+=stream[fn]()*scale}}}}if(!frames)return false;this.emit("duration",frames*header.nbsamples()*32/header.samplerate*1e3|0);return true};this.prototype.readChunk=function(){var stream=this.stream;if(!this.sentInfo){var id3header=MP3Demuxer.getID3v2Header(stream);if(id3header&&!this.metadata){stream.advance(10);if(id3header.major>2){var id3=new ID3v23Stream(id3header,stream)}else{var id3=new ID3v22Stream(id3header,stream)}this.metadata=id3.read();this.emit("metadata",this.metadata);stream.seek(10+id3header.length)}var off=stream.offset;var s=new MP3Stream(new AV.Bitstream(stream));var header=MP3FrameHeader.decode(s);if(!header)return this.emit("error","Could not find first frame.");this.emit("format",{formatID:"mp3",sampleRate:header.samplerate,channelsPerFrame:header.nchannels(),bitrate:header.bitrate,floatingPoint:true,layer:header.layer,flags:header.flags});var sentDuration=this.parseDuration(header,off);stream.advance(off-stream.offset);this.dataSize=0;if(!sentDuration){this.on("end",function(){this.emit("duration",this.dataSize*8/header.bitrate*1e3|0)})}this.sentInfo=true}while(stream.available(1)){var buffer=stream.readSingleBuffer(stream.remainingBytes());this.dataSize+=buffer.length;this.emit("data",buffer)}}});module.exports=MP3Demuxer}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./header":5,"./id3":7,"./stream":12}],4:[function(require,module,exports){var MP3FrameHeader=require("./header");var utils=require("./utils");function MP3Frame(){this.header=null;this.options=0;this.sbsample=utils.makeArray([2,36,32]);this.overlap=utils.makeArray([2,32,18]);this.decoders=[]}MP3Frame.layers=[];MP3Frame.prototype.decode=function(stream){if(!this.header||!(this.header.flags&MP3FrameHeader.FLAGS.INCOMPLETE))this.header=MP3FrameHeader.decode(stream);this.header.flags&=~MP3FrameHeader.FLAGS.INCOMPLETE;var decoder=this.decoders[this.header.layer-1];if(!decoder){var Layer=MP3Frame.layers[this.header.layer];if(!Layer)throw new Error("Layer "+this.header.layer+" is not supported.");decoder=this.decoders[this.header.layer-1]=new Layer}decoder.decode(stream,this)};module.exports=MP3Frame},{"./header":5,"./utils":15}],5:[function(require,module,exports){(function(global){var AV=typeof window!=="undefined"?window["AV"]:typeof global!=="undefined"?global["AV"]:null;function MP3FrameHeader(){this.layer=0;this.mode=0;this.mode_extension=0;this.emphasis=0;this.bitrate=0;this.samplerate=0;this.crc_check=0;this.crc_target=0;this.flags=0;this.private_bits=0}const BITRATES=[[0,32e3,64e3,96e3,128e3,16e4,192e3,224e3,256e3,288e3,32e4,352e3,384e3,416e3,448e3],[0,32e3,48e3,56e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4,384e3],[0,32e3,4e4,48e3,56e3,64e3,8e4,96e3,112e3,128e3,16e4,192e3,224e3,256e3,32e4],[0,32e3,48e3,56e3,64e3,8e4,96e3,112e3,128e3,144e3,16e4,176e3,192e3,224e3,256e3],[0,8e3,16e3,24e3,32e3,4e4,48e3,56e3,64e3,8e4,96e3,112e3,128e3,144e3,16e4]];const SAMPLERATES=[44100,48e3,32e3];MP3FrameHeader.FLAGS={NPRIVATE_III:7,INCOMPLETE:8,PROTECTION:16,COPYRIGHT:32,ORIGINAL:64,PADDING:128,I_STEREO:256,MS_STEREO:512,FREEFORMAT:1024,LSF_EXT:4096,MC_EXT:8192,MPEG_2_5_EXT:16384};const PRIVATE={HEADER:256,III:31};MP3FrameHeader.MODE={SINGLE_CHANNEL:0,DUAL_CHANNEL:1,JOINT_STEREO:2,STEREO:3};const EMPHASIS={NONE:0,_50_15_US:1,CCITT_J_17:3,RESERVED:2};MP3FrameHeader.BUFFER_GUARD=8;MP3FrameHeader.BUFFER_MDLEN=511+2048+MP3FrameHeader.BUFFER_GUARD;MP3FrameHeader.prototype.copy=function(){var clone=new MP3FrameHeader;var keys=Object.keys(this);for(var key in keys){clone[key]=this[key]}return clone};MP3FrameHeader.prototype.nchannels=function(){return this.mode===0?1:2};MP3FrameHeader.prototype.nbsamples=function(){return this.layer===1?12:this.layer===3&&this.flags&MP3FrameHeader.FLAGS.LSF_EXT?18:36};MP3FrameHeader.prototype.framesize=function(){if(this.bitrate===0)return null;var padding=this.flags&MP3FrameHeader.FLAGS.PADDING?1:0;switch(this.layer){case 1:var size=this.bitrate*12/this.samplerate|0;return(size+padding)*4;case 2:var size=this.bitrate*144/this.samplerate|0;return size+padding;case 3:default:var lsf=this.flags&MP3FrameHeader.FLAGS.LSF_EXT?1:0;var size=this.bitrate*144/(this.samplerate<<lsf)|0;return size+padding}};MP3FrameHeader.prototype.decode=function(stream){this.flags=0;this.private_bits=0;stream.advance(11);if(stream.read(1)===0)this.flags|=MP3FrameHeader.FLAGS.MPEG_2_5_EXT;if(stream.read(1)===0){this.flags|=MP3FrameHeader.FLAGS.LSF_EXT}else if(this.flags&MP3FrameHeader.FLAGS.MPEG_2_5_EXT){throw new AV.UnderflowError}this.layer=4-stream.read(2);if(this.layer===4)throw new Error("Invalid layer");if(stream.read(1)===0)this.flags|=MP3FrameHeader.FLAGS.PROTECTION;var index=stream.read(4);if(index===15)throw new Error("Invalid bitrate");if(this.flags&MP3FrameHeader.FLAGS.LSF_EXT){this.bitrate=BITRATES[3+(this.layer>>1)][index]}else{this.bitrate=BITRATES[this.layer-1][index]}index=stream.read(2);if(index===3)throw new Error("Invalid sampling frequency");this.samplerate=SAMPLERATES[index];if(this.flags&MP3FrameHeader.FLAGS.LSF_EXT){this.samplerate/=2;if(this.flags&MP3FrameHeader.FLAGS.MPEG_2_5_EXT)this.samplerate/=2}if(stream.read(1))this.flags|=MP3FrameHeader.FLAGS.PADDING;if(stream.read(1))this.private_bits|=PRIVATE.HEADER;this.mode=3-stream.read(2);this.mode_extension=stream.read(2);if(stream.read(1))this.flags|=MP3FrameHeader.FLAGS.COPYRIGHT;if(stream.read(1))this.flags|=MP3FrameHeader.FLAGS.ORIGINAL;this.emphasis=stream.read(2);if(this.flags&MP3FrameHeader.FLAGS.PROTECTION)this.crc_target=stream.read(16)};MP3FrameHeader.decode=function(stream){var ptr=stream.next_frame;var syncing=true;var header=null;while(syncing){syncing=false;if(stream.sync){if(!stream.available(MP3FrameHeader.BUFFER_GUARD)){stream.next_frame=ptr;throw new AV.UnderflowError}else if(!(stream.getU8(ptr)===255&&(stream.getU8(ptr+1)&224)===224)){stream.this_frame=ptr;stream.next_frame=ptr+1;throw new AV.UnderflowError}}else{stream.seek(ptr*8);if(!stream.doSync())throw new AV.UnderflowError;ptr=stream.nextByte()}stream.this_frame=ptr;stream.next_frame=ptr+1;stream.seek(stream.this_frame*8);header=new MP3FrameHeader;header.decode(stream);if(header.bitrate===0){if(stream.freerate===0||!stream.sync||header.layer===3&&stream.freerate>64e4)MP3FrameHeader.free_bitrate(stream,header);header.bitrate=stream.freerate;header.flags|=MP3FrameHeader.FLAGS.FREEFORMAT}var pad_slot=header.flags&MP3FrameHeader.FLAGS.PADDING?1:0;if(header.layer===1){var N=((12*header.bitrate/header.samplerate<<0)+pad_slot)*4}else{var slots_per_frame=header.layer===3&&header.flags&MP3FrameHeader.FLAGS.LSF_EXT?72:144;var N=(slots_per_frame*header.bitrate/header.samplerate<<0)+pad_slot}if(!stream.available(N+MP3FrameHeader.BUFFER_GUARD)){stream.next_frame=stream.this_frame;throw new AV.UnderflowError}stream.next_frame=stream.this_frame+N;if(!stream.sync){ptr=stream.next_frame;if(!(stream.getU8(ptr)===255&&(stream.getU8(ptr+1)&224)===224)){ptr=stream.next_frame=stream.this_frame+1;syncing=true;continue}stream.sync=true}}header.flags|=MP3FrameHeader.FLAGS.INCOMPLETE;return header};MP3FrameHeader.free_bitrate=function(stream,header){var pad_slot=header.flags&MP3FrameHeader.FLAGS.PADDING?1:0,slots_per_frame=header.layer===3&&header.flags&MP3FrameHeader.FLAGS.LSF_EXT?72:144;var start=stream.offset();var rate=0;while(stream.doSync()){var peek_header=header.copy();var peek_stream=stream.copy();if(peek_header.decode(peek_stream)&&peek_header.layer===header.layer&&peek_header.samplerate===header.samplerate){var N=stream.nextByte()-stream.this_frame;if(header.layer===1){rate=header.samplerate*(N-4*pad_slot+4)/48/1e3|0}else{rate=header.samplerate*(N-pad_slot+1)/slots_per_frame/1e3|0}if(rate>=8)break}stream.advance(8)}stream.seek(start);if(rate<8||header.layer===3&&rate>640)throw new AV.UnderflowError;stream.freerate=rate*1e3};module.exports=MP3FrameHeader}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],6:[function(require,module,exports){var PTR=function(offs,bits){return{final:0,ptr:{bits:bits,offset:offs}}};var huffquad_V=function(v,w,x,y,hlen){return{final:1,value:{v:v,w:w,x:x,y:y,hlen:hlen}}};const hufftabA=[PTR(16,2),PTR(20,2),PTR(24,1),PTR(26,1),huffquad_V(0,0,1,0,4),huffquad_V(0,0,0,1,4),huffquad_V(0,1,0,0,4),huffquad_V(1,0,0,0,4),huffquad_V(0,0,0,0,1),huffquad_V(0,0,0,0,1),huffquad_V(0,0,0,0,1),huffquad_V(0,0,0,0,1),huffquad_V(0,0,0,0,1),huffquad_V(0,0,0,0,1),huffquad_V(0,0,0,0,1),huffquad_V(0,0,0,0,1),huffquad_V(1,0,1,1,2),huffquad_V(1,1,1,1,2),huffquad_V(1,1,0,1,2),huffquad_V(1,1,1,0,2),huffquad_V(0,1,1,1,2),huffquad_V(0,1,0,1,2),huffquad_V(1,0,0,1,1),huffquad_V(1,0,0,1,1),huffquad_V(0,1,1,0,1),huffquad_V(0,0,1,1,1),huffquad_V(1,0,1,0,1),huffquad_V(1,1,0,0,1)];const hufftabB=[huffquad_V(1,1,1,1,4),huffquad_V(1,1,1,0,4),huffquad_V(1,1,0,1,4),huffquad_V(1,1,0,0,4),huffquad_V(1,0,1,1,4),huffquad_V(1,0,1,0,4),huffquad_V(1,0,0,1,4),huffquad_V(1,0,0,0,4),huffquad_V(0,1,1,1,4),huffquad_V(0,1,1,0,4),huffquad_V(0,1,0,1,4),huffquad_V(0,1,0,0,4),huffquad_V(0,0,1,1,4),huffquad_V(0,0,1,0,4),huffquad_V(0,0,0,1,4),huffquad_V(0,0,0,0,4)];var V=function(x,y,hlen){return{final:1,value:{x:x,y:y,hlen:hlen}}};const hufftab0=[V(0,0,0)];const hufftab1=[V(1,1,3),V(0,1,3),V(1,0,2),V(1,0,2),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1)];const hufftab2=[PTR(8,3),V(1,1,3),V(0,1,3),V(1,0,3),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(2,2,3),V(0,2,3),V(1,2,2),V(1,2,2),V(2,1,2),V(2,1,2),V(2,0,2),V(2,0,2)];const hufftab3=[PTR(8,3),V(1,0,3),V(1,1,2),V(1,1,2),V(0,1,2),V(0,1,2),V(0,0,2),V(0,0,2),V(2,2,3),V(0,2,3),V(1,2,2),V(1,2,2),V(2,1,2),V(2,1,2),V(2,0,2),V(2,0,2)];const hufftab5=[PTR(8,4),V(1,1,3),V(0,1,3),V(1,0,3),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),PTR(24,1),V(3,2,4),V(3,1,3),V(3,1,3),V(1,3,4),V(0,3,4),V(3,0,4),V(2,2,4),V(1,2,3),V(1,2,3),V(2,1,3),V(2,1,3),V(0,2,3),V(0,2,3),V(2,0,3),V(2,0,3),V(3,3,1),V(2,3,1)];const hufftab6=[PTR(16,3),PTR(24,1),PTR(26,1),V(1,2,4),V(2,1,4),V(2,0,4),V(0,1,3),V(0,1,3),V(1,1,2),V(1,1,2),V(1,1,2),V(1,1,2),V(1,0,3),V(1,0,3),V(0,0,3),V(0,0,3),V(3,3,3),V(0,3,3),V(2,3,2),V(2,3,2),V(3,2,2),V(3,2,2),V(3,0,2),V(3,0,2),V(1,3,1),V(3,1,1),V(2,2,1),V(0,2,1)];const hufftab7=[PTR(16,4),PTR(32,4),PTR(48,2),V(1,1,4),V(0,1,3),V(0,1,3),V(1,0,3),V(1,0,3),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),PTR(52,2),PTR(56,1),PTR(58,1),V(1,5,4),V(5,1,4),PTR(60,1),V(5,0,4),PTR(62,1),V(2,4,4),V(4,2,4),V(1,4,3),V(1,4,3),V(4,1,3),V(4,1,3),V(4,0,3),V(4,0,3),V(0,4,4),V(2,3,4),V(3,2,4),V(0,3,4),V(1,3,3),V(1,3,3),V(3,1,3),V(3,1,3),V(3,0,3),V(3,0,3),V(2,2,3),V(2,2,3),V(1,2,2),V(1,2,2),V(1,2,2),V(1,2,2),V(2,1,1),V(2,1,1),V(0,2,2),V(2,0,2),V(5,5,2),V(4,5,2),V(5,4,2),V(5,3,2),V(3,5,1),V(4,4,1),V(2,5,1),V(5,2,1),V(0,5,1),V(3,4,1),V(4,3,1),V(3,3,1)];const hufftab8=[PTR(16,4),PTR(32,4),V(1,2,4),V(2,1,4),V(1,1,2),V(1,1,2),V(1,1,2),V(1,1,2),V(0,1,3),V(0,1,3),V(1,0,3),V(1,0,3),V(0,0,2),V(0,0,2),V(0,0,2),V(0,0,2),PTR(48,3),PTR(56,2),PTR(60,1),V(1,5,4),V(5,1,4),PTR(62,1),PTR(64,1),V(2,4,4),V(4,2,4),V(1,4,4),V(4,1,3),V(4,1,3),V(0,4,4),V(4,0,4),V(2,3,4),V(3,2,4),V(1,3,4),V(3,1,4),V(0,3,4),V(3,0,4),V(2,2,2),V(2,2,2),V(2,2,2),V(2,2,2),V(0,2,2),V(0,2,2),V(0,2,2),V(0,2,2),V(2,0,2),V(2,0,2),V(2,0,2),V(2,0,2),V(5,5,3),V(5,4,3),V(4,5,2),V(4,5,2),V(5,3,1),V(5,3,1),V(5,3,1),V(5,3,1),V(3,5,2),V(4,4,2),V(2,5,1),V(2,5,1),V(5,2,1),V(0,5,1),V(3,4,1),V(4,3,1),V(5,0,1),V(3,3,1)];const hufftab9=[PTR(16,4),PTR(32,3),PTR(40,2),PTR(44,2),PTR(48,1),V(1,2,4),V(2,1,4),V(2,0,4),V(1,1,3),V(1,1,3),V(0,1,3),V(0,1,3),V(1,0,3),V(1,0,3),V(0,0,3),V(0,0,3),PTR(50,1),V(3,5,4),V(5,3,4),PTR(52,1),V(4,4,4),V(2,5,4),V(5,2,4),V(1,5,4),V(5,1,3),V(5,1,3),V(3,4,3),V(3,4,3),V(4,3,3),V(4,3,3),V(5,0,4),V(0,4,4),V(2,4,3),V(4,2,3),V(3,3,3),V(4,0,3),V(1,4,2),V(1,4,2),V(4,1,2),V(4,1,2),V(2,3,2),V(3,2,2),V(1,3,1),V(1,3,1),V(3,1,1),V(3,1,1),V(0,3,2),V(3,0,2),V(2,2,1),V(0,2,1),V(5,5,1),V(4,5,1),V(5,4,1),V(0,5,1)];const hufftab10=[PTR(16,4),PTR(32,4),PTR(48,2),V(1,1,4),V(0,1,3),V(0,1,3),V(1,0,3),V(1,0,3),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),PTR(52,3),PTR(60,2),PTR(64,3),PTR(72,1),PTR(74,2),PTR(78,2),PTR(82,2),V(1,7,4),V(7,1,4),PTR(86,1),PTR(88,2),PTR(92,2),V(1,6,4),V(6,1,4),V(6,0,4),PTR(96,1),PTR(98,1),PTR(100,1),V(1,4,4),V(4,1,4),V(4,0,4),V(2,3,4),V(3,2,4),V(0,3,4),V(1,3,3),V(1,3,3),V(3,1,3),V(3,1,3),V(3,0,3),V(3,0,3),V(2,2,3),V(2,2,3),V(1,2,2),V(2,1,2),V(0,2,2),V(2,0,2),V(7,7,3),V(6,7,3),V(7,6,3),V(5,7,3),V(7,5,3),V(6,6,3),V(4,7,2),V(4,7,2),V(7,4,2),V(5,6,2),V(6,5,2),V(3,7,2),V(7,3,2),V(7,3,2),V(4,6,2),V(4,6,2),V(5,5,3),V(5,4,3),V(6,3,2),V(6,3,2),V(2,7,1),V(7,2,1),V(6,4,2),V(0,7,2),V(7,0,1),V(7,0,1),V(6,2,1),V(6,2,1),V(4,5,2),V(3,5,2),V(0,6,1),V(0,6,1),V(5,3,2),V(4,4,2),V(3,6,1),V(2,6,1),V(2,5,2),V(5,2,2),V(1,5,1),V(1,5,1),V(5,1,1),V(5,1,1),V(3,4,2),V(4,3,2),V(0,5,1),V(5,0,1),V(2,4,1),V(4,2,1),V(3,3,1),V(0,4,1)];const hufftab11=[PTR(16,4),PTR(32,4),PTR(48,4),PTR(64,3),V(1,2,4),PTR(72,1),V(1,1,3),V(1,1,3),V(0,1,3),V(0,1,3),V(1,0,3),V(1,0,3),V(0,0,2),V(0,0,2),V(0,0,2),V(0,0,2),PTR(74,2),PTR(78,3),PTR(86,2),PTR(90,1),PTR(92,2),V(2,7,4),V(7,2,4),PTR(96,1),V(7,1,3),V(7,1,3),V(1,7,4),V(7,0,4),V(3,6,4),V(6,3,4),V(6,0,4),PTR(98,1),PTR(100,1),V(1,5,4),V(6,2,3),V(6,2,3),V(2,6,4),V(0,6,4),V(1,6,3),V(1,6,3),V(6,1,3),V(6,1,3),V(5,1,4),V(3,4,4),V(5,0,4),PTR(102,1),V(2,4,4),V(4,2,4),V(1,4,4),V(4,1,4),V(0,4,4),V(4,0,4),V(2,3,3),V(2,3,3),V(3,2,3),V(3,2,3),V(1,3,2),V(1,3,2),V(1,3,2),V(1,3,2),V(3,1,2),V(3,1,2),V(3,1,2),V(3,1,2),V(0,3,3),V(3,0,3),V(2,2,2),V(2,2,2),V(2,1,1),V(2,1,1),V(2,1,1),V(2,1,1),V(0,2,1),V(2,0,1),V(7,7,2),V(6,7,2),V(7,6,2),V(7,5,2),V(6,6,2),V(6,6,2),V(4,7,2),V(4,7,2),V(7,4,2),V(7,4,2),V(5,7,3),V(5,5,3),V(5,6,2),V(6,5,2),V(3,7,1),V(3,7,1),V(7,3,1),V(4,6,1),V(4,5,2),V(5,4,2),V(3,5,2),V(5,3,2),V(6,4,1),V(0,7,1),V(4,4,1),V(2,5,1),V(5,2,1),V(0,5,1),V(4,3,1),V(3,3,1)];const hufftab12=[PTR(16,4),PTR(32,4),PTR(48,4),PTR(64,2),PTR(68,3),PTR(76,1),V(1,2,4),V(2,1,4),PTR(78,1),V(0,0,4),V(1,1,3),V(1,1,3),V(0,1,3),V(0,1,3),V(1,0,3),V(1,0,3),PTR(80,2),PTR(84,1),PTR(86,1),PTR(88,1),V(5,6,4),V(3,7,4),PTR(90,1),V(2,7,4),V(7,2,4),V(4,6,4),V(6,4,4),V(1,7,4),V(7,1,4),PTR(92,1),V(3,6,4),V(6,3,4),V(4,5,4),V(5,4,4),V(4,4,4),PTR(94,1),V(2,6,3),V(2,6,3),V(6,2,3),V(6,2,3),V(6,1,3),V(6,1,3),V(1,6,4),V(6,0,4),V(3,5,4),V(5,3,4),V(2,5,4),V(5,2,4),V(1,5,3),V(1,5,3),V(5,1,3),V(5,1,3),V(3,4,3),V(3,4,3),V(4,3,3),V(4,3,3),V(5,0,4),V(0,4,4),V(2,4,3),V(2,4,3),V(4,2,3),V(4,2,3),V(1,4,3),V(1,4,3),V(3,3,2),V(4,1,2),V(2,3,2),V(3,2,2),V(4,0,3),V(0,3,3),V(3,0,2),V(3,0,2),V(1,3,1),V(1,3,1),V(1,3,1),V(1,3,1),V(3,1,1),V(2,2,1),V(0,2,1),V(2,0,1),V(7,7,2),V(6,7,2),V(7,6,1),V(7,6,1),V(5,7,1),V(7,5,1),V(6,6,1),V(4,7,1),V(7,4,1),V(6,5,1),V(7,3,1),V(5,5,1),V(0,7,1),V(7,0,1),V(0,6,1),V(0,5,1)];const hufftab13=[PTR(16,4),PTR(32,4),PTR(48,4),PTR(64,2),V(1,1,4),V(0,1,4),V(1,0,3),V(1,0,3),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),PTR(68,4),PTR(84,4),PTR(100,4),PTR(116,4),PTR(132,4),PTR(148,4),PTR(164,3),PTR(172,3),PTR(180,3),PTR(188,3),PTR(196,3),PTR(204,3),PTR(212,1),PTR(214,2),PTR(218,3),PTR(226,1),PTR(228,2),PTR(232,2),PTR(236,2),PTR(240,2),V(8,1,4),PTR(244,1),PTR(246,1),PTR(248,1),PTR(250,2),PTR(254,1),V(1,5,4),V(5,1,4),PTR(256,1),PTR(258,1),PTR(260,1),V(1,4,4),V(4,1,3),V(4,1,3),V(0,4,4),V(4,0,4),V(2,3,4),V(3,2,4),V(1,3,3),V(1,3,3),V(3,1,3),V(3,1,3),V(0,3,3),V(0,3,3),V(3,0,3),V(3,0,3),V(2,2,3),V(2,2,3),V(1,2,2),V(2,1,2),V(0,2,2),V(2,0,2),PTR(262,4),PTR(278,4),PTR(294,4),PTR(310,3),PTR(318,2),PTR(322,2),PTR(326,3),PTR(334,2),PTR(338,1),PTR(340,2),PTR(344,2),PTR(348,2),PTR(352,2),PTR(356,2),V(1,15,4),V(15,1,4),V(15,0,4),PTR(360,1),PTR(362,1),PTR(364,1),V(14,2,4),PTR(366,1),V(1,14,4),V(14,1,4),PTR(368,1),PTR(370,1),PTR(372,1),PTR(374,1),PTR(376,1),PTR(378,1),V(12,6,4),V(3,13,4),PTR(380,1),V(2,13,4),V(13,2,4),V(1,13,4),V(11,7,4),PTR(382,1),PTR(384,1),V(12,3,4),PTR(386,1),V(4,11,4),V(13,1,3),V(13,1,3),V(0,13,4),V(13,0,4),V(8,10,4),V(10,8,4),V(4,12,4),V(12,4,4),V(6,11,4),V(11,6,4),V(3,12,3),V(3,12,3),V(2,12,3),V(2,12,3),V(12,2,3),V(12,2,3),V(5,11,3),V(5,11,3),V(11,5,4),V(8,9,4),V(1,12,3),V(1,12,3),V(12,1,3),V(12,1,3),V(9,8,4),V(0,12,4),V(12,0,3),V(12,0,3),V(11,4,4),V(6,10,4),V(10,6,4),V(7,9,4),V(3,11,3),V(3,11,3),V(11,3,3),V(11,3,3),V(8,8,4),V(5,10,4),V(2,11,3),V(2,11,3),V(10,5,4),V(6,9,4),V(10,4,3),V(10,4,3),V(7,8,4),V(8,7,4),V(9,4,3),V(9,4,3),V(7,7,4),V(7,6,4),V(11,2,2),V(11,2,2),V(11,2,2),V(11,2,2),V(1,11,2),V(1,11,2),V(11,1,2),V(11,1,2),V(0,11,3),V(11,0,3),V(9,6,3),V(4,10,3),V(3,10,3),V(10,3,3),V(5,9,3),V(9,5,3),V(2,10,2),V(2,10,2),V(10,2,2),V(10,2,2),V(1,10,2),V(1,10,2),V(10,1,2),V(10,1,2),V(0,10,3),V(6,8,3),V(10,0,2),V(10,0,2),V(8,6,3),V(4,9,3),V(9,3,2),V(9,3,2),V(3,9,3),V(5,8,3),V(8,5,3),V(6,7,3),V(2,9,2),V(2,9,2),V(9,2,2),V(9,2,2),V(5,7,3),V(7,5,3),V(3,8,2),V(3,8,2),V(8,3,2),V(8,3,2),V(6,6,3),V(4,7,3),V(7,4,3),V(5,6,3),V(6,5,3),V(7,3,3),V(1,9,1),V(9,1,1),V(0,9,2),V(9,0,2),V(4,8,2),V(8,4,2),V(7,2,2),V(7,2,2),V(4,6,3),V(6,4,3),V(2,8,1),V(2,8,1),V(2,8,1),V(2,8,1),V(8,2,1),V(1,8,1),V(3,7,2),V(2,7,2),V(1,7,1),V(1,7,1),V(7,1,1),V(7,1,1),V(5,5,2),V(0,7,2),V(7,0,2),V(3,6,2),V(6,3,2),V(4,5,2),V(5,4,2),V(2,6,2),V(6,2,2),V(3,5,2),V(0,8,1),V(8,0,1),V(1,6,1),V(6,1,1),V(0,6,1),V(6,0,1),V(5,3,2),V(4,4,2),V(2,5,1),V(2,5,1),V(5,2,1),V(0,5,1),V(3,4,1),V(4,3,1),V(5,0,1),V(2,4,1),V(4,2,1),V(3,3,1),PTR(388,3),V(15,15,4),V(14,15,4),V(13,15,4),V(14,14,4),V(12,15,4),V(13,14,4),V(11,15,4),V(15,11,4),V(12,14,4),V(13,12,4),PTR(396,1),V(14,12,3),V(14,12,3),V(13,13,3),V(13,13,3),V(15,10,4),V(12,13,4),V(11,14,3),V(11,14,3),V(14,11,3),V(14,11,3),V(9,15,3),V(9,15,3),V(15,9,3),V(15,9,3),V(14,10,3),V(14,10,3),V(11,13,3),V(11,13,3),V(13,11,3),V(13,11,3),V(8,15,3),V(8,15,3),V(15,8,3),V(15,8,3),V(12,12,3),V(12,12,3),V(10,14,4),V(9,14,4),V(8,14,3),V(8,14,3),V(7,15,4),V(7,14,4),V(15,7,2),V(15,7,2),V(15,7,2),V(15,7,2),V(13,10,2),V(13,10,2),V(10,13,3),V(11,12,3),V(12,11,3),V(15,6,3),V(6,15,2),V(6,15,2),V(14,8,2),V(5,15,2),V(9,13,2),V(13,9,2),V(15,5,2),V(14,7,2),V(10,12,2),V(11,11,2),V(4,15,2),V(4,15,2),V(15,4,2),V(15,4,2),V(12,10,3),V(14,6,3),V(15,3,2),V(15,3,2),V(3,15,1),V(3,15,1),V(8,13,2),V(13,8,2),V(2,15,1),V(15,2,1),V(6,14,2),V(9,12,2),V(0,15,1),V(0,15,1),V(12,9,2),V(5,14,2),V(10,11,1),V(10,11,1),V(7,13,2),V(13,7,2),V(4,14,1),V(4,14,1),V(12,8,2),V(13,6,2),V(3,14,1),V(3,14,1),V(11,9,1),V(11,9,1),V(9,11,2),V(10,10,2),V(11,10,1),V(14,5,1),V(14,4,1),V(8,12,1),V(6,13,1),V(14,3,1),V(2,14,1),V(0,14,1),V(14,0,1),V(5,13,1),V(13,5,1),V(7,12,1),V(12,7,1),V(4,13,1),V(8,11,1),V(11,8,1),V(13,4,1),V(9,10,1),V(10,9,1),V(6,12,1),V(13,3,1),V(7,11,1),V(5,12,1),V(12,5,1),V(9,9,1),V(7,10,1),V(10,7,1),V(9,7,1),V(15,14,3),V(15,12,3),V(15,13,2),V(15,13,2),V(14,13,1),V(14,13,1),V(14,13,1),V(14,13,1),V(10,15,1),V(14,9,1)];const hufftab15=[PTR(16,4),PTR(32,4),PTR(48,4),PTR(64,4),PTR(80,4),PTR(96,3),PTR(104,3),PTR(112,2),PTR(116,1),PTR(118,1),V(1,1,3),V(1,1,3),V(0,1,4),V(1,0,4),V(0,0,3),V(0,0,3),PTR(120,4),PTR(136,4),PTR(152,4),PTR(168,4),PTR(184,4),PTR(200,3),PTR(208,3),PTR(216,4),PTR(232,3),PTR(240,3),PTR(248,3),PTR(256,3),PTR(264,2),PTR(268,3),PTR(276,3),PTR(284,2),PTR(288,2),PTR(292,2),PTR(296,2),PTR(300,2),PTR(304,2),PTR(308,2),PTR(312,2),PTR(316,2),PTR(320,1),PTR(322,1),PTR(324,1),PTR(326,2),PTR(330,1),PTR(332,1),PTR(334,2),PTR(338,1),PTR(340,1),PTR(342,1),V(9,1,4),PTR(344,1),PTR(346,1),PTR(348,1),PTR(350,1),PTR(352,1),V(2,8,4),V(8,2,4),V(1,8,4),V(8,1,4),PTR(354,1),PTR(356,1),PTR(358,1),PTR(360,1),V(2,7,4),V(7,2,4),V(6,4,4),V(1,7,4),V(5,5,4),V(7,1,4),PTR(362,1),V(3,6,4),V(6,3,4),V(4,5,4),V(5,4,4),V(2,6,4),V(6,2,4),V(1,6,4),PTR(364,1),V(3,5,4),V(6,1,3),V(6,1,3),V(5,3,4),V(4,4,4),V(2,5,3),V(2,5,3),V(5,2,3),V(5,2,3),V(1,5,3),V(1,5,3),V(5,1,3),V(5,1,3),V(0,5,4),V(5,0,4),V(3,4,3),V(3,4,3),V(4,3,3),V(2,4,3),V(4,2,3),V(3,3,3),V(4,1,2),V(4,1,2),V(1,4,3),V(0,4,3),V(2,3,2),V(2,3,2),V(3,2,2),V(3,2,2),V(4,0,3),V(0,3,3),V(1,3,2),V(1,3,2),V(3,1,2),V(3,0,2),V(2,2,1),V(2,2,1),V(1,2,1),V(2,1,1),V(0,2,1),V(2,0,1),PTR(366,1),PTR(368,1),V(14,14,4),PTR(370,1),PTR(372,1),PTR(374,1),V(15,11,4),PTR(376,1),V(13,13,4),V(10,15,4),V(15,10,4),V(11,14,4),V(14,11,4),V(12,13,4),V(13,12,4),V(9,15,4),V(15,9,4),V(14,10,4),V(11,13,4),V(13,11,4),V(8,15,4),V(15,8,4),V(12,12,4),V(9,14,4),V(14,9,4),V(7,15,4),V(15,7,4),V(10,13,4),V(13,10,4),V(11,12,4),V(6,15,4),PTR(378,1),V(12,11,3),V(12,11,3),V(15,6,3),V(15,6,3),V(8,14,4),V(14,8,4),V(5,15,4),V(9,13,4),V(15,5,3),V(15,5,3),V(7,14,3),V(7,14,3),V(14,7,3),V(14,7,3),V(10,12,3),V(10,12,3),V(12,10,3),V(12,10,3),V(11,11,3),V(11,11,3),V(13,9,4),V(8,13,4),V(4,15,3),V(4,15,3),V(15,4,3),V(15,4,3),V(3,15,3),V(3,15,3),V(15,3,3),V(15,3,3),V(13,8,3),V(13,8,3),V(14,6,3),V(14,6,3),V(2,15,3),V(2,15,3),V(15,2,3),V(15,2,3),V(6,14,4),V(15,0,4),V(1,15,3),V(1,15,3),V(15,1,3),V(15,1,3),V(9,12,3),V(9,12,3),V(12,9,3),V(12,9,3),V(5,14,3),V(10,11,3),V(11,10,3),V(14,5,3),V(7,13,3),V(13,7,3),V(4,14,3),V(14,4,3),V(8,12,3),V(12,8,3),V(3,14,3),V(6,13,3),V(13,6,3),V(14,3,3),V(9,11,3),V(11,9,3),V(2,14,3),V(2,14,3),V(10,10,3),V(10,10,3),V(14,2,3),V(14,2,3),V(1,14,3),V(1,14,3),V(14,1,3),V(14,1,3),V(0,14,4),V(14,0,4),V(5,13,3),V(5,13,3),V(13,5,3),V(13,5,3),V(7,12,3),V(12,7,3),V(4,13,3),V(8,11,3),V(13,4,2),V(13,4,2),V(11,8,3),V(9,10,3),V(10,9,3),V(6,12,3),V(12,6,3),V(3,13,3),V(13,3,2),V(13,3,2),V(13,2,2),V(13,2,2),V(2,13,3),V(0,13,3),V(1,13,2),V(1,13,2),V(7,11,2),V(7,11,2),V(11,7,2),V(11,7,2),V(13,1,2),V(13,1,2),V(5,12,3),V(13,0,3),V(12,5,2),V(12,5,2),V(8,10,2),V(8,10,2),V(10,8,2),V(4,12,2),V(12,4,2),V(6,11,2),V(11,6,2),V(11,6,2),V(9,9,3),V(0,12,3),V(3,12,2),V(3,12,2),V(12,3,2),V(12,3,2),V(7,10,2),V(7,10,2),V(10,7,2),V(10,7,2),V(10,6,2),V(10,6,2),V(12,0,3),V(0,11,3),V(12,2,1),V(12,2,1),V(2,12,2),V(5,11,2),V(11,5,2),V(1,12,2),V(8,9,2),V(9,8,2),V(12,1,2),V(4,11,2),V(11,4,2),V(6,10,2),V(3,11,2),V(7,9,2),V(11,3,1),V(11,3,1),V(9,7,2),V(8,8,2),V(2,11,2),V(5,10,2),V(11,2,1),V(11,2,1),V(10,5,2),V(1,11,2),V(11,1,1),V(11,1,1),V(11,0,2),V(6,9,2),V(9,6,2),V(4,10,2),V(10,4,2),V(7,8,2),V(8,7,2),V(3,10,2),V(10,3,1),V(10,3,1),V(5,9,1),V(9,5,1),V(2,10,1),V(10,2,1),V(1,10,1),V(10,1,1),V(0,10,2),V(10,0,2),V(6,8,1),V(6,8,1),V(8,6,1),V(4,9,1),V(9,4,1),V(3,9,1),V(9,3,1),V(9,3,1),V(7,7,2),V(0,9,2),V(5,8,1),V(8,5,1),V(2,9,1),V(6,7,1),V(7,6,1),V(9,2,1),V(1,9,1),V(9,0,1),V(4,8,1),V(8,4,1),V(5,7,1),V(7,5,1),V(3,8,1),V(8,3,1),V(6,6,1),V(4,7,1),V(7,4,1),V(0,8,1),V(8,0,1),V(5,6,1),V(6,5,1),V(3,7,1),V(7,3,1),V(4,6,1),V(0,7,1),V(7,0,1),V(0,6,1),V(6,0,1),V(15,15,1),V(14,15,1),V(15,14,1),V(13,15,1),V(15,13,1),V(12,15,1),V(15,12,1),V(13,14,1),V(14,13,1),V(11,15,1),V(12,14,1),V(14,12,1),V(10,14,1),V(0,15,1)];const hufftab16=[PTR(16,4),PTR(32,4),PTR(48,4),PTR(64,2),V(1,1,4),V(0,1,4),V(1,0,3),V(1,0,3),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),V(0,0,1),PTR(68,3),PTR(76,3),PTR(84,2),V(15,15,4),PTR(88,2),PTR(92,1),PTR(94,4),V(15,2,4),PTR(110,1),V(1,15,4),V(15,1,4),PTR(112,4),PTR(128,4),PTR(144,4),PTR(160,4),PTR(176,4),PTR(192,4),PTR(208,3),PTR(216,3),PTR(224,3),PTR(232,3),PTR(240,3),PTR(248,3),PTR(256,3),PTR(264,2),PTR(268,2),PTR(272,1),PTR(274,2),PTR(278,2),PTR(282,1),V(5,1,4),PTR(284,1),PTR(286,1),PTR(288,1),PTR(290,1),V(1,4,4),V(4,1,4),PTR(292,1),V(2,3,4),V(3,2,4),V(1,3,3),V(1,3,3),V(3,1,3),V(3,1,3),V(0,3,4),V(3,0,4),V(2,2,3),V(2,2,3),V(1,2,2),V(2,1,2),V(0,2,2),V(2,0,2),V(14,15,3),V(15,14,3),V(13,15,3),V(15,13,3),V(12,15,3),V(15,12,3),V(11,15,3),V(15,11,3),V(10,15,2),V(10,15,2),V(15,10,3),V(9,15,3),V(15,9,3),V(15,8,3),V(8,15,2),V(8,15,2),V(7,15,2),V(15,7,2),V(6,15,2),V(15,6,2),V(5,15,2),V(15,5,2),V(4,15,1),V(4,15,1),V(15,4,1),V(15,3,1),V(15,0,1),V(15,0,1),V(15,0,1),V(15,0,1),V(15,0,1),V(15,0,1),V(15,0,1),V(15,0,1),V(3,15,2),V(3,15,2),V(3,15,2),V(3,15,2),PTR(294,4),PTR(310,3),PTR(318,3),PTR(326,3),V(2,15,1),V(0,15,1),PTR(334,2),PTR(338,2),PTR(342,2),PTR(346,1),PTR(348,2),PTR(352,2),PTR(356,1),PTR(358,2),PTR(362,2),PTR(366,2),PTR(370,2),V(14,3,4),PTR(374,1),PTR(376,1),PTR(378,1),PTR(380,1),PTR(382,1),PTR(384,1),PTR(386,1),V(0,13,4),PTR(388,1),PTR(390,1),PTR(392,1),V(3,12,4),PTR(394,1),V(1,12,4),V(12,0,4),PTR(396,1),V(14,2,3),V(14,2,3),V(2,14,4),V(1,14,4),V(13,3,4),V(2,13,4),V(13,2,4),V(13,1,4),V(3,11,4),PTR(398,1),V(1,13,3),V(1,13,3),V(12,4,4),V(6,11,4),V(12,3,4),V(10,7,4),V(2,12,3),V(2,12,3),V(12,2,4),V(11,5,4),V(12,1,4),V(0,12,4),V(4,11,4),V(11,4,4),V(6,10,4),V(10,6,4),V(11,3,3),V(11,3,3),V(5,10,4),V(10,5,4),V(2,11,3),V(2,11,3),V(11,2,3),V(11,2,3),V(1,11,3),V(1,11,3),V(11,1,3),V(11,1,3),V(0,11,4),V(11,0,4),V(6,9,4),V(9,6,4),V(4,10,4),V(10,4,4),V(7,8,4),V(8,7,4),V(10,3,3),V(10,3,3),V(3,10,4),V(5,9,4),V(2,10,3),V(2,10,3),V(9,5,4),V(6,8,4),V(10,1,3),V(10,1,3),V(8,6,4),V(7,7,4),V(9,4,3),V(9,4,3),V(4,9,4),V(5,7,4),V(6,7,3),V(6,7,3),V(10,2,2),V(10,2,2),V(10,2,2),V(10,2,2),V(1,10,2),V(1,10,2),V(0,10,3),V(10,0,3),V(3,9,3),V(9,3,3),V(5,8,3),V(8,5,3),V(2,9,2),V(2,9,2),V(9,2,2),V(9,2,2),V(7,6,3),V(0,9,3),V(1,9,2),V(1,9,2),V(9,1,2),V(9,1,2),V(9,0,3),V(4,8,3),V(8,4,3),V(7,5,3),V(3,8,3),V(8,3,3),V(6,6,3),V(2,8,3),V(8,2,2),V(8,2,2),V(4,7,3),V(7,4,3),V(1,8,2),V(1,8,2),V(8,1,2),V(8,1,2),V(8,0,2),V(8,0,2),V(0,8,3),V(5,6,3),V(3,7,2),V(3,7,2),V(7,3,2),V(7,3,2),V(6,5,3),V(4,6,3),V(2,7,2),V(2,7,2),V(7,2,2),V(7,2,2),V(6,4,3),V(5,5,3),V(0,7,2),V(0,7,2),V(1,7,1),V(1,7,1),V(1,7,1),V(1,7,1),V(7,1,1),V(7,1,1),V(7,0,2),V(3,6,2),V(6,3,2),V(4,5,2),V(5,4,2),V(2,6,2),V(6,2,1),V(1,6,1),V(6,1,1),V(6,1,1),V(0,6,2),V(6,0,2),V(5,3,1),V(5,3,1),V(3,5,2),V(4,4,2),V(2,5,1),V(5,2,1),V(1,5,1),V(0,5,1),V(3,4,1),V(4,3,1),V(5,0,1),V(2,4,1),V(4,2,1),V(3,3,1),V(0,4,1),V(4,0,1),V(12,14,4),PTR(400,1),V(13,14,3),V(13,14,3),V(14,9,3),V(14,9,3),V(14,10,4),V(13,9,4),V(14,14,2),V(14,14,2),V(14,14,2),V(14,14,2),V(14,13,3),V(14,13,3),V(14,11,3),V(14,11,3),V(11,14,2),V(11,14,2),V(12,13,2),V(12,13,2),V(13,12,3),V(13,11,3),V(10,14,2),V(10,14,2),V(12,12,2),V(12,12,2),V(10,13,3),V(13,10,3),V(7,14,3),V(10,12,3),V(12,10,2),V(12,10,2),V(12,9,3),V(7,13,3),V(5,14,2),V(5,14,2),V(11,13,1),V(11,13,1),V(11,13,1),V(11,13,1),V(9,14,1),V(9,14,1),V(11,12,2),V(12,11,2),V(8,14,2),V(14,8,2),V(9,13,2),V(14,7,2),V(11,11,2),V(8,13,2),V(13,8,2),V(6,14,2),V(14,6,1),V(9,12,1),V(10,11,2),V(11,10,2),V(14,5,2),V(13,7,2),V(4,14,1),V(4,14,1),V(14,4,2),V(8,12,2),V(12,8,1),V(3,14,1),V(6,13,1),V(6,13,1),V(13,6,2),V(9,11,2),V(11,9,2),V(10,10,2),V(14,1,1),V(14,1,1),V(13,4,1),V(13,4,1),V(11,8,2),V(10,9,2),V(7,11,1),V(7,11,1),V(11,7,2),V(13,0,2),V(0,14,1),V(14,0,1),V(5,13,1),V(13,5,1),V(7,12,1),V(12,7,1),V(4,13,1),V(8,11,1),V(9,10,1),V(6,12,1),V(12,6,1),V(3,13,1),V(5,12,1),V(12,5,1),V(8,10,1),V(10,8,1),V(9,9,1),V(4,12,1),V(11,6,1),V(7,10,1),V(5,11,1),V(8,9,1),V(9,8,1),V(7,9,1),V(9,7,1),V(8,8,1),V(14,12,1),V(13,13,1)];const hufftab24=[PTR(16,4),PTR(32,4),PTR(48,4),V(15,15,4),PTR(64,4),PTR(80,4),PTR(96,4),PTR(112,4),PTR(128,4),PTR(144,4),PTR(160,3),PTR(168,2),V(1,1,4),V(0,1,4),V(1,0,4),V(0,0,4),V(14,15,4),V(15,14,4),V(13,15,4),V(15,13,4),V(12,15,4),V(15,12,4),V(11,15,4),V(15,11,4),V(15,10,3),V(15,10,3),V(10,15,4),V(9,15,4),V(15,9,3),V(15,9,3),V(15,8,3),V(15,8,3),V(8,15,4),V(7,15,4),V(15,7,3),V(15,7,3),V(6,15,3),V(6,15,3),V(15,6,3),V(15,6,3),V(5,15,3),V(5,15,3),V(15,5,3),V(15,5,3),V(4,15,3),V(4,15,3),V(15,4,3),V(15,4,3),V(3,15,3),V(3,15,3),V(15,3,3),V(15,3,3),V(2,15,3),V(2,15,3),V(15,2,3),V(15,2,3),V(15,1,3),V(15,1,3),V(1,15,4),V(15,0,4),PTR(172,3),PTR(180,3),PTR(188,3),PTR(196,3),PTR(204,4),PTR(220,3),PTR(228,3),PTR(236,3),PTR(244,2),PTR(248,2),PTR(252,2),PTR(256,2),PTR(260,2),PTR(264,2),PTR(268,2),PTR(272,2),PTR(276,2),PTR(280,3),PTR(288,2),PTR(292,2),PTR(296,2),PTR(300,3),PTR(308,2),PTR(312,3),PTR(320,1),PTR(322,2),PTR(326,2),PTR(330,1),PTR(332,2),PTR(336,1),PTR(338,1),PTR(340,1),PTR(342,1),PTR(344,1),PTR(346,1),PTR(348,1),PTR(350,1),PTR(352,1),PTR(354,1),PTR(356,1),PTR(358,1),PTR(360,1),PTR(362,1),PTR(364,1),PTR(366,1),PTR(368,1),PTR(370,2),PTR(374,1),PTR(376,2),V(7,3,4),PTR(380,1),V(7,2,4),V(4,6,4),V(6,4,4),V(5,5,4),V(7,1,4),V(3,6,4),V(6,3,4),V(4,5,4),V(5,4,4),V(2,6,4),V(6,2,4),V(1,6,4),V(6,1,4),PTR(382,1),V(3,5,4),V(5,3,4),V(4,4,4),V(2,5,4),V(5,2,4),V(1,5,4),PTR(384,1),V(5,1,3),V(5,1,3),V(3,4,4),V(4,3,4),V(2,4,3),V(2,4,3),V(4,2,3),V(4,2,3),V(3,3,3),V(3,3,3),V(1,4,3),V(1,4,3),V(4,1,3),V(4,1,3),V(0,4,4),V(4,0,4),V(2,3,3),V(2,3,3),V(3,2,3),V(3,2,3),V(1,3,2),V(1,3,2),V(1,3,2),V(1,3,2),V(3,1,2),V(3,1,2),V(3,1,2),V(3,1,2),V(0,3,3),V(3,0,3),V(2,2,2),V(2,2,2),V(1,2,1),V(1,2,1),V(1,2,1),V(1,2,1),V(2,1,1),V(2,1,1),V(0,2,2),V(2,0,2),V(0,15,1),V(0,15,1),V(0,15,1),V(0,15,1),V(14,14,3),V(13,14,3),V(14,13,3),V(12,14,3),V(14,12,3),V(13,13,3),V(11,14,3),V(14,11,3),V(12,13,3),V(13,12,3),V(10,14,3),V(14,10,3),V(11,13,3),V(13,11,3),V(12,12,3),V(9,14,3),V(14,9,3),V(10,13,3),V(13,10,3),V(11,12,3),V(12,11,3),V(8,14,3),V(14,8,3),V(9,13,3),V(13,9,3),V(7,14,3),V(14,7,3),V(10,12,3),V(12,10,3),V(12,10,3),V(11,11,3),V(11,11,3),V(8,13,3),V(8,13,3),V(13,8,3),V(13,8,3),V(0,14,4),V(14,0,4),V(0,13,3),V(0,13,3),V(14,6,2),V(14,6,2),V(14,6,2),V(14,6,2),V(6,14,3),V(9,12,3),V(12,9,2),V(12,9,2),V(5,14,2),V(5,14,2),V(11,10,2),V(11,10,2),V(14,5,2),V(14,5,2),V(10,11,3),V(7,13,3),V(13,7,2),V(13,7,2),V(14,4,2),V(14,4,2),V(8,12,2),V(8,12,2),V(12,8,2),V(12,8,2),V(4,14,3),V(2,14,3),V(3,14,2),V(3,14,2),V(6,13,2),V(13,6,2),V(14,3,2),V(9,11,2),V(11,9,2),V(10,10,2),V(14,2,2),V(1,14,2),V(14,1,2),V(5,13,2),V(13,5,2),V(7,12,2),V(12,7,2),V(4,13,2),V(8,11,2),V(11,8,2),V(13,4,2),V(9,10,2),V(10,9,2),V(6,12,2),V(12,6,2),V(3,13,2),V(13,3,2),V(2,13,2),V(13,2,2),V(1,13,2),V(7,11,2),V(11,7,2),V(13,1,2),V(5,12,2),V(12,5,2),V(8,10,2),V(10,8,2),V(9,9,2),V(4,12,2),V(12,4,2),V(6,11,2),V(6,11,2),V(11,6,2),V(11,6,2),V(13,0,3),V(0,12,3),V(3,12,2),V(3,12,2),V(12,3,2),V(7,10,2),V(10,7,2),V(2,12,2),V(12,2,2),V(5,11,2),V(11,5,2),V(1,12,2),V(8,9,2),V(9,8,2),V(12,1,2),V(4,11,2),V(12,0,3),V(0,11,3),V(3,11,2),V(3,11,2),V(11,0,3),V(0,10,3),V(1,10,2),V(1,10,2),V(11,4,1),V(11,4,1),V(6,10,2),V(10,6,2),V(7,9,2),V(7,9,2),V(9,7,2),V(9,7,2),V(10,0,3),V(0,9,3),V(9,0,2),V(9,0,2),V(11,3,1),V(8,8,1),V(2,11,2),V(5,10,2),V(11,2,1),V(11,2,1),V(10,5,2),V(1,11,2),V(11,1,2),V(6,9,2),V(9,6,1),V(10,4,1),V(4,10,2),V(7,8,2),V(8,7,1),V(8,7,1),V(3,10,1),V(10,3,1),V(5,9,1),V(9,5,1),V(2,10,1),V(10,2,1),V(10,1,1),V(6,8,1),V(8,6,1),V(7,7,1),V(4,9,1),V(9,4,1),V(3,9,1),V(9,3,1),V(5,8,1),V(8,5,1),V(2,9,1),V(6,7,1),V(7,6,1),V(9,2,1),V(1,9,1),V(9,1,1),V(4,8,1),V(8,4,1),V(5,7,1),V(7,5,1),V(3,8,1),V(8,3,1),V(6,6,1),V(2,8,1),V(8,2,1),V(1,8,1),V(4,7,1),V(7,4,1),V(8,1,1),V(8,1,1),V(0,8,2),V(8,0,2),V(5,6,1),V(6,5,1),V(1,7,1),V(1,7,1),V(0,7,2),V(7,0,2),V(3,7,1),V(2,7,1),V(0,6,1),V(6,0,1),V(0,5,1),V(5,0,1)];function MP3Hufftable(table,linbits,startbits){this.table=table;this.linbits=linbits;this.startbits=startbits}exports.huff_quad_table=[hufftabA,hufftabB];exports.huff_pair_table=[new MP3Hufftable(hufftab0,0,0),new MP3Hufftable(hufftab1,0,3),new MP3Hufftable(hufftab2,0,3),new MP3Hufftable(hufftab3,0,3),null,new MP3Hufftable(hufftab5,0,3),new MP3Hufftable(hufftab6,0,4),new MP3Hufftable(hufftab7,0,4),new MP3Hufftable(hufftab8,0,4),new MP3Hufftable(hufftab9,0,4),new MP3Hufftable(hufftab10,0,4),new MP3Hufftable(hufftab11,0,4),new MP3Hufftable(hufftab12,0,4),new MP3Hufftable(hufftab13,0,4),null,new MP3Hufftable(hufftab15,0,4),new MP3Hufftable(hufftab16,1,4),new MP3Hufftable(hufftab16,2,4),new MP3Hufftable(hufftab16,3,4),new MP3Hufftable(hufftab16,4,4),new MP3Hufftable(hufftab16,6,4),new MP3Hufftable(hufftab16,8,4),new MP3Hufftable(hufftab16,10,4),new MP3Hufftable(hufftab16,13,4),new MP3Hufftable(hufftab24,4,4),new MP3Hufftable(hufftab24,5,4),new MP3Hufftable(hufftab24,6,4),new MP3Hufftable(hufftab24,7,4),new MP3Hufftable(hufftab24,8,4),new MP3Hufftable(hufftab24,9,4),new MP3Hufftable(hufftab24,11,4),new MP3Hufftable(hufftab24,13,4)]},{}],7:[function(require,module,exports){(function(global){var AV=typeof window!=="undefined"?window["AV"]:typeof global!=="undefined"?global["AV"]:null;const ENCODINGS=["latin1","utf16-bom","utf16-be","utf8"];var ID3Stream=AV.Base.extend({constructor:function(header,stream){this.header=header;this.stream=stream;this.offset=0},read:function(){if(!this.data){this.data={};var frame;while(frame=this.readFrame()){if(frame.key in this.data){if(!Array.isArray(this.data[frame.key]))this.data[frame.key]=[this.data[frame.key]];this.data[frame.key].push(frame.value)}else{this.data[frame.key]=frame.value}}}return this.data},readFrame:function(){if(this.offset>=this.header.length)return null;var header=this.readHeader();var decoder=header.identifier;if(header.identifier.charCodeAt(0)===0){this.offset+=this.header.length+1;return null}if(!this.frameTypes[decoder]){for(var key in this.map){if(this.map[key].indexOf(decoder)!==-1){decoder=key;break}}}if(this.frameTypes[decoder]){var frame=this.decodeFrame(header,this.frameTypes[decoder]),keys=Object.keys(frame);if(keys.length===1)frame=frame[keys[0]];var result={value:frame}}else{var result={value:this.stream.readBuffer(Math.min(header.length,this.header.length-this.offset))}}result.key=this.names[header.identifier]?this.names[header.identifier]:header.identifier;if(result.key==="coverArt")result.value=result.value.data;this.offset+=10+header.length;return result},decodeFrame:function(header,fields){var stream=this.stream,start=stream.offset;var encoding=0,ret={};var len=Object.keys(fields).length,i=0;for(var key in fields){var type=fields[key];var rest=header.length-(stream.offset-start);i++;switch(key){case"encoding":encoding=stream.readUInt8();continue;case"language":ret.language=stream.readString(3);continue}switch(type){case"latin1":ret[key]=stream.readString(i===len?rest:null,"latin1");break;case"string":ret[key]=stream.readString(i===len?rest:null,ENCODINGS[encoding]);break;case"binary":ret[key]=stream.readBuffer(rest);break;case"int16":ret[key]=stream.readInt16();break;case"int8":ret[key]=stream.readInt8();break;case"int24":ret[key]=stream.readInt24();break;case"int32":ret[key]=stream.readInt32();break;case"int32+":ret[key]=stream.readInt32();if(rest>4)throw new Error("Seriously dude? Stop playing this song and get a life!");break;case"date":var val=stream.readString(8);ret[key]=new Date(val.slice(0,4),val.slice(4,6)-1,val.slice(6,8));break;case"frame_id":ret[key]=stream.readString(4);break;default:throw new Error("Unknown key type "+type)}}var rest=header.length-(stream.offset-start);if(rest>0)stream.advance(rest);return ret}});exports.ID3v23Stream=ID3Stream.extend({readHeader:function(){var identifier=this.stream.readString(4);var length=0;if(this.header.major===4){for(var i=0;i<4;i++)length=(length<<7)+(this.stream.readUInt8()&127)}else{length=this.stream.readUInt32()}return{identifier:identifier,length:length,flags:this.stream.readUInt16()}},map:{text:["TIT1","TIT2","TIT3","TALB","TOAL","TRCK","TPOS","TSST","TSRC","TPE1","TPE2","TPE3","TPE4","TOPE","TEXT","TOLY","TCOM","TMCL","TIPL","TENC","TBPM","TLEN","TKEY","TLAN","TCON","TFLT","TMED","TMOO","TCOP","TPRO","TPUB","TOWN","TRSN","TRSO","TOFN","TDLY","TDEN","TDOR","TDRC","TDRL","TDTG","TSSE","TSOA","TSOP","TSOT","TDAT","TIME","TORY","TRDA","TSIZ","TYER","TCMP","TSO2","TSOC"],url:["WCOM","WCOP","WOAF","WOAR","WOAS","WORS","WPAY","WPUB"]},frameTypes:{text:{encoding:1,value:"string"},url:{value:"latin1"},TXXX:{encoding:1,description:"string",value:"string"},WXXX:{encoding:1,description:"string",value:"latin1"},USLT:{encoding:1,language:1,description:"string",value:"string"},COMM:{encoding:1,language:1,description:"string",value:"string"},APIC:{encoding:1,mime:"latin1",type:"int8",description:"string",data:"binary"},UFID:{owner:"latin1",identifier:"binary"},MCDI:{value:"binary"},PRIV:{owner:"latin1",value:"binary"},GEOB:{encoding:1,mime:"latin1",filename:"string",description:"string",data:"binary"},PCNT:{value:"int32+"},POPM:{email:"latin1",rating:"int8",counter:"int32+"},AENC:{owner:"latin1",previewStart:"int16",previewLength:"int16",encryptionInfo:"binary"},ETCO:{format:"int8",data:"binary"},MLLT:{framesBetweenReference:"int16",bytesBetweenReference:"int24",millisecondsBetweenReference:"int24",bitsForBytesDeviation:"int8",bitsForMillisecondsDev:"int8",data:"binary"},SYTC:{format:"int8",tempoData:"binary"},SYLT:{encoding:1,language:1,format:"int8",contentType:"int8",description:"string",data:"binary"},RVA2:{identification:"latin1",data:"binary"},EQU2:{interpolationMethod:"int8",identification:"latin1",data:"binary"},RVRB:{left:"int16",right:"int16",bouncesLeft:"int8",bouncesRight:"int8",feedbackLL:"int8",feedbackLR:"int8",feedbackRR:"int8",feedbackRL:"int8",premixLR:"int8",premixRL:"int8"},RBUF:{size:"int24",flag:"int8",offset:"int32"},LINK:{identifier:"frame_id",url:"latin1",data:"binary"},POSS:{format:"int8",position:"binary"},USER:{encoding:1,language:1,value:"string"},OWNE:{encoding:1,price:"latin1",purchaseDate:"date",seller:"string"},COMR:{encoding:1,price:"latin1",validUntil:"date",contactURL:"latin1",receivedAs:"int8",seller:"string",description:"string",logoMime:"latin1",logo:"binary"},ENCR:{owner:"latin1",methodSymbol:"int8",data:"binary"},GRID:{owner:"latin1",groupSymbol:"int8",data:"binary"},SIGN:{groupSymbol:"int8",signature:"binary"},SEEK:{value:"int32"},ASPI:{dataStart:"int32",dataLength:"int32",numPoints:"int16",bitsPerPoint:"int8",data:"binary"},IPLS:{encoding:1,value:"string"},RVAD:{adjustment:"int8",bits:"int8",data:"binary"},EQUA:{adjustmentBits:"int8",data:"binary"}},names:{TIT1:"grouping",TIT2:"title",TIT3:"subtitle",TALB:"album",TOAL:"originalAlbumTitle",TRCK:"trackNumber",TPOS:"diskNumber",TSST:"setSubtitle",TSRC:"ISRC",TPE1:"artist",TPE2:"albumArtist",TPE3:"conductor",TPE4:"modifiedBy",TOPE:"originalArtist",TEXT:"lyricist",TOLY:"originalLyricist",TCOM:"composer",TMCL:"musicianCreditsList",TIPL:"involvedPeopleList",TENC:"encodedBy",TBPM:"tempo",TLEN:"length",TKEY:"initialKey",TLAN:"language",TCON:"genre",TFLT:"fileType",TMED:"mediaType",TMOO:"mood",TCOP:"copyright",TPRO:"producedNotice",TPUB:"publisher",TOWN:"fileOwner",TRSN:"internetRadioStationName",TRSO:"internetRadioStationOwner",TOFN:"originalFilename",TDLY:"playlistDelay",TDEN:"encodingTime",TDOR:"originalReleaseTime",TDRC:"recordingTime",TDRL:"releaseTime",TDTG:"taggingTime",TSSE:"encodedWith",TSOA:"albumSortOrder",TSOP:"performerSortOrder",TSOT:"titleSortOrder",TXXX:"userText",USLT:"lyrics",APIC:"coverArt",UFID:"uniqueIdentifier",MCDI:"CDIdentifier",COMM:"comments",WCOM:"commercialInformation",WCOP:"copyrightInformation",WOAF:"officialAudioFileWebpage",WOAR:"officialArtistWebpage",WOAS:"officialAudioSourceWebpage",WORS:"officialInternetRadioStationHomepage",WPAY:"payment",WPUB:"officialPublisherWebpage",WXXX:"url",PRIV:"private",GEOB:"generalEncapsulatedObject",PCNT:"playCount",POPM:"rating",AENC:"audioEncryption",ETCO:"eventTimingCodes",MLLT:"MPEGLocationLookupTable",SYTC:"synchronisedTempoCodes",SYLT:"synchronisedLyrics",RVA2:"volumeAdjustment",EQU2:"equalization",RVRB:"reverb",RBUF:"recommendedBufferSize",LINK:"link",POSS:"positionSynchronisation",USER:"termsOfUse",OWNE:"ownership",COMR:"commercial",ENCR:"encryption",GRID:"groupIdentifier",SIGN:"signature",SEEK:"seek",ASPI:"audioSeekPointIndex",TDAT:"date",TIME:"time",TORY:"originalReleaseYear",TRDA:"recordingDates",TSIZ:"size",TYER:"year",IPLS:"involvedPeopleList",RVAD:"volumeAdjustment",EQUA:"equalization",TCMP:"compilation",TSO2:"albumArtistSortOrder",TSOC:"composerSortOrder"}});exports.ID3v22Stream=exports.ID3v23Stream.extend({readHeader:function(){var id=this.stream.readString(3);if(this.frameReplacements[id]&&!this.frameTypes[id])this.frameTypes[id]=this.frameReplacements[id];return{identifier:this.replacements[id]||id,length:this.stream.readUInt24()}},replacements:{UFI:"UFID",TT1:"TIT1",TT2:"TIT2",TT3:"TIT3",TP1:"TPE1",TP2:"TPE2",TP3:"TPE3",TP4:"TPE4",TCM:"TCOM",TXT:"TEXT",TLA:"TLAN",TCO:"TCON",TAL:"TALB",TPA:"TPOS",TRK:"TRCK",TRC:"TSRC",TYE:"TYER",TDA:"TDAT",TIM:"TIME",TRD:"TRDA",TMT:"TMED",TFT:"TFLT",TBP:"TBPM",TCR:"TCOP",TPB:"TPUB",TEN:"TENC",TSS:"TSSE",TOF:"TOFN",TLE:"TLEN",TSI:"TSIZ",TDY:"TDLY",TKE:"TKEY",TOT:"TOAL",TOA:"TOPE",TOL:"TOLY",TOR:"TORY",TXX:"TXXX",WAF:"WOAF",WAR:"WOAR",WAS:"WOAS",WCM:"WCOM",WCP:"WCOP",WPB:"WPUB",WXX:"WXXX",IPL:"IPLS",MCI:"MCDI",ETC:"ETCO",MLL:"MLLT",STC:"SYTC",ULT:"USLT",SLT:"SYLT",COM:"COMM",RVA:"RVAD",EQU:"EQUA",REV:"RVRB",GEO:"GEOB",CNT:"PCNT",POP:"POPM",BUF:"RBUF",CRA:"AENC",LNK:"LINK",TST:"TSOT",TSP:"TSOP",TSA:"TSOA",TCP:"TCMP",TS2:"TSO2",TSC:"TSOC"},frameReplacements:{PIC:{encoding:1,format:"int24",type:"int8",description:"string",data:"binary"},CRM:{owner:"latin1",description:"latin1",data:"binary"}}})}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],8:[function(require,module,exports){function IMDCT(){this.tmp_imdct36=new Float64Array(18);this.tmp_dctIV=new Float64Array(18);this.tmp_sdctII=new Float64Array(9)}IMDCT.prototype.imdct36=function(x,y){var tmp=this.tmp_imdct36;this.dctIV(x,tmp);for(var i=0;i<9;++i){y[i]=tmp[9+i]}for(var i=9;i<27;++i){y[i]=-tmp[36-(9+i)-1]}for(var i=27;i<36;++i){y[i]=-tmp[i-27]}};var dctIV_scale=[];for(i=0;i<18;i++){dctIV_scale[i]=2*Math.cos(Math.PI*(2*i+1)/(4*18))}IMDCT.prototype.dctIV=function(y,X){var tmp=this.tmp_dctIV;for(var i=0;i<18;++i){tmp[i]=y[i]*dctIV_scale[i]}this.sdctII(tmp,X);X[0]/=2;for(var i=1;i<18;++i){X[i]=X[i]/2-X[i-1]}};var sdctII_scale=[];for(var i=0;i<9;++i){sdctII_scale[i]=2*Math.cos(Math.PI*(2*i+1)/(2*18))}IMDCT.prototype.sdctII=function(x,X){var tmp=this.tmp_sdctII;for(var i=0;i<9;++i){tmp[i]=x[i]+x[18-i-1]}fastsdct(tmp,X,0);for(var i=0;i<9;++i){tmp[i]=(x[i]-x[18-i-1])*sdctII_scale[i]}fastsdct(tmp,X,1);for(var i=3;i<18;i+=2){X[i]-=X[i-2]}};var c0=2*Math.cos(1*Math.PI/18);var c1=2*Math.cos(3*Math.PI/18);var c2=2*Math.cos(4*Math.PI/18);var c3=2*Math.cos(5*Math.PI/18);var c4=2*Math.cos(7*Math.PI/18);var c5=2*Math.cos(8*Math.PI/18);var c6=2*Math.cos(16*Math.PI/18);function fastsdct(x,y,offset){var a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11,a12;var a13,a14,a15,a16,a17,a18,a19,a20,a21,a22,a23,a24,a25;var m0,m1,m2,m3,m4,m5,m6,m7;a0=x[3]+x[5];a1=x[3]-x[5];a2=x[6]+x[2];a3=x[6]-x[2];a4=x[1]+x[7];a5=x[1]-x[7];a6=x[8]+x[0];a7=x[8]-x[0];a8=a0+a2;a9=a0-a2;a10=a0-a6;a11=a2-a6;a12=a8+a6;a13=a1-a3;a14=a13+a7;a15=a3+a7;a16=a1-a7;a17=a1+a3;m0=a17*-c3;m1=a16*-c0;m2=a15*-c4;m3=a14*-c1;m4=a5*-c1;m5=a11*-c6;m6=a10*-c5;m7=a9*-c2;a18=x[4]+a4;a19=2*x[4]-a4;a20=a19+m5;a21=a19-m5;a22=a19+m6;a23=m4+m2;a24=m4-m2;a25=m4+m1;y[offset+0]=a18+a12;y[offset+2]=m0-a25;y[offset+4]=m7-a20;y[offset+6]=m3;y[offset+8]=a21-m6;y[offset+10]=a24-m1;y[offset+12]=a12-2*a18;y[offset+14]=a23+m0;y[offset+16]=a22+m7}IMDCT.S=[[.608761429,-.923879533,-.130526192,.991444861,-.382683432,-.79335334],[-.79335334,.382683432,.991444861,.130526192,-.923879533,-.608761429],[.382683432,-.923879533,.923879533,-.382683432,-.382683432,.923879533],[-.923879533,-.382683432,.382683432,.923879533,.923879533,.382683432],[.130526192,-.382683432,.608761429,-.79335334,.923879533,-.991444861],[-.991444861,-.923879533,-.79335334,-.608761429,-.382683432,-.130526192]];module.exports=IMDCT},{}],9:[function(require,module,exports){var tables=require("./tables");var MP3FrameHeader=require("./header");var MP3Frame=require("./frame");var utils=require("./utils");function Layer1(){this.allocation=utils.makeArray([2,32],Uint8Array);this.scalefactor=utils.makeArray([2,32],Uint8Array)}MP3Frame.layers[1]=Layer1;const LINEAR_TABLE=new Float32Array([1.33333333333333,1.14285714285714,1.06666666666667,1.03225806451613,1.01587301587302,1.00787401574803,1.00392156862745,1.00195694716243,1.00097751710655,1.00048851978505,1.0002442002442,1.00012208521548,1.00006103888177,1.00003051850948]);Layer1.prototype.decode=function(stream,frame){var header=frame.header;var nch=header.nchannels();var bound=32;if(header.mode===MP3FrameHeader.MODE.JOINT_STEREO){header.flags|=MP3FrameHeader.FLAGS.I_STEREO;bound=4+header.mode_extension*4}if(header.flags&MP3FrameHeader.FLAGS.PROTECTION){}var allocation=this.allocation;for(var sb=0;sb<bound;sb++){for(var ch=0;ch<nch;ch++){var nb=stream.read(4);if(nb===15)throw new Error("forbidden bit allocation value");allocation[ch][sb]=nb?nb+1:0}}for(var sb=bound;sb<32;sb++){var nb=stream.read(4);if(nb===15)throw new Error("forbidden bit allocation value");allocation[0][sb]=allocation[1][sb]=nb?nb+1:0}var scalefactor=this.scalefactor;for(var sb=0;sb<32;sb++){for(var ch=0;ch<nch;ch++){if(allocation[ch][sb]){scalefactor[ch][sb]=stream.read(6)}}}for(var s=0;s<12;s++){for(var sb=0;sb<bound;sb++){for(var ch=0;ch<nch;ch++){var nb=allocation[ch][sb];frame.sbsample[ch][s][sb]=nb?this.sample(stream,nb)*tables.SF_TABLE[scalefactor[ch][sb]]:0}}for(var sb=bound;sb<32;sb++){var nb=allocation[0][sb];if(nb){var sample=this.sample(stream,nb);for(var ch=0;ch<nch;ch++){frame.sbsample[ch][s][sb]=sample*tables.SF_TABLE[scalefactor[ch][sb]]}}else{for(var ch=0;ch<nch;ch++){frame.sbsample[ch][s][sb]=0}}}}};Layer1.prototype.sample=function(stream,nb){var sample=stream.read(nb);sample^=1<<nb-1;sample|=-(sample&1<<nb-1);sample/=1<<nb-1;sample+=1>>nb-1;return sample*LINEAR_TABLE[nb-2]};module.exports=Layer1},{"./frame":4,"./header":5,"./tables":14,"./utils":15}],10:[function(require,module,exports){var tables=require("./tables");var MP3FrameHeader=require("./header");var MP3Frame=require("./frame");var utils=require("./utils");function Layer2(){this.samples=new Float64Array(3);this.allocation=utils.makeArray([2,32],Uint8Array);this.scfsi=utils.makeArray([2,32],Uint8Array);this.scalefactor=utils.makeArray([2,32,3],Uint8Array)}MP3Frame.layers[2]=Layer2;const SBQUANT=[{sblimit:27,offsets:[7,7,7,6,6,6,6,6,6,6,6,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0]},{sblimit:30,offsets:[7,7,7,6,6,6,6,6,6,6,6,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0]},{sblimit:8,offsets:[5,5,2,2,2,2,2,2]},{sblimit:12,offsets:[5,5,2,2,2,2,2,2,2,2,2,2]},{sblimit:30,offsets:[4,4,4,4,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}];const BITALLOC=[{nbal:2,offset:0},{nbal:2,offset:3},{nbal:3,offset:3},{nbal:3,offset:1},{nbal:4,offset:2},{nbal:4,offset:3},{nbal:4,offset:4},{nbal:4,offset:5}];const OFFSETS=[[0,1,16],[0,1,2,3,4,5,16],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14],[0,1,3,4,5,6,7,8,9,10,11,12,13,14,15],[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16],[0,2,4,5,6,7,8,9,10,11,12,13,14,15,16]];const QC_TABLE=[{nlevels:3,group:2,bits:5,C:1.33333333333,D:.5},{nlevels:5,group:3,bits:7,C:1.6,D:.5},{nlevels:7,group:0,bits:3,C:1.14285714286,D:.25},{nlevels:9,group:4,bits:10,C:1.77777777777,D:.5},{nlevels:15,group:0,bits:4,C:1.06666666666,D:.125},{nlevels:31,group:0,bits:5,C:1.03225806452,D:.0625},{nlevels:63,group:0,bits:6,C:1.01587301587,D:.03125},{nlevels:127,group:0,bits:7,C:1.00787401575,D:.015625},{nlevels:255,group:0,bits:8,C:1.00392156863,D:.0078125},{nlevels:511,group:0,bits:9,C:1.00195694716,D:.00390625},{nlevels:1023,group:0,bits:10,C:1.00097751711,D:.001953125},{nlevels:2047,group:0,bits:11,C:1.00048851979,D:.0009765625},{nlevels:4095,group:0,bits:12,C:1.00024420024,D:.00048828125},{nlevels:8191,group:0,bits:13,C:1.00012208522,D:.00024414063},{nlevels:16383,group:0,bits:14,C:1.00006103888,D:.00012207031},{nlevels:32767,group:0,bits:15,C:1.00003051851,D:6103516e-11},{nlevels:65535,group:0,bits:16,C:1.00001525902,D:3051758e-11}];Layer2.prototype.decode=function(stream,frame){var header=frame.header;var nch=header.nchannels();var index;if(header.flags&MP3FrameHeader.FLAGS.LSF_EXT){index=4}else if(header.flags&MP3FrameHeader.FLAGS.FREEFORMAT){index=header.samplerate===48e3?0:1}else{var bitrate_per_channel=header.bitrate;if(nch===2){bitrate_per_channel/=2}else{if(bitrate_per_channel>192e3)throw new Error("bad bitrate/mode combination")}if(bitrate_per_channel<=48e3)index=header.samplerate===32e3?3:2;else if(bitrate_per_channel<=8e4)index=0;else index=header.samplerate===48e3?0:1}var sblimit=SBQUANT[index].sblimit;var offsets=SBQUANT[index].offsets;var bound=32;if(header.mode===MP3FrameHeader.MODE.JOINT_STEREO){header.flags|=MP3FrameHeader.FLAGS.I_STEREO;bound=4+header.mode_extension*4}if(bound>sblimit)bound=sblimit;var allocation=this.allocation;for(var sb=0;sb<bound;sb++){var nbal=BITALLOC[offsets[sb]].nbal;for(var ch=0;ch<nch;ch++)allocation[ch][sb]=stream.read(nbal)}for(var sb=bound;sb<sblimit;sb++){var nbal=BITALLOC[offsets[sb]].nbal;allocation[0][sb]=allocation[1][sb]=stream.read(nbal)}var scfsi=this.scfsi;for(var sb=0;sb<sblimit;sb++){for(var ch=0;ch<nch;ch++){if(allocation[ch][sb])scfsi[ch][sb]=stream.read(2)}}if(header.flags&MP3FrameHeader.FLAGS.PROTECTION){}var scalefactor=this.scalefactor;for(var sb=0;sb<sblimit;sb++){for(var ch=0;ch<nch;ch++){if(allocation[ch][sb]){scalefactor[ch][sb][0]=stream.read(6);switch(scfsi[ch][sb]){case 2:scalefactor[ch][sb][2]=scalefactor[ch][sb][1]=scalefactor[ch][sb][0];break;case 0:scalefactor[ch][sb][1]=stream.read(6);case 1:case 3:scalefactor[ch][sb][2]=stream.read(6)}if(scfsi[ch][sb]&1)scalefactor[ch][sb][1]=scalefactor[ch][sb][scfsi[ch][sb]-1]}}}for(var gr=0;gr<12;gr++){for(var sb=0;sb<bound;sb++){for(var ch=0;ch<nch;ch++){if(index=allocation[ch][sb]){index=OFFSETS[BITALLOC[offsets[sb]].offset][index-1];this.decodeSamples(stream,QC_TABLE[index]);var scale=tables.SF_TABLE[scalefactor[ch][sb][gr>>2]];for(var s=0;s<3;s++){frame.sbsample[ch][3*gr+s][sb]=this.samples[s]*scale}}else{for(var s=0;s<3;s++){frame.sbsample[ch][3*gr+s][sb]=0}}}}for(var sb=bound;sb<sblimit;sb++){if(index=allocation[0][sb]){index=OFFSETS[BITALLOC[offsets[sb]].offset][index-1];this.decodeSamples(stream,QC_TABLE[index]);for(var ch=0;ch<nch;ch++){var scale=tables.SF_TABLE[scalefactor[ch][sb][gr>>2]];for(var s=0;s<3;s++){frame.sbsample[ch][3*gr+s][sb]=this.samples[s]*scale}}}else{for(var ch=0;ch<nch;ch++){for(var s=0;s<3;s++){frame.sbsample[ch][3*gr+s][sb]=0}}}}for(var ch=0;ch<nch;ch++){for(var s=0;s<3;s++){for(var sb=sblimit;sb<32;sb++){frame.sbsample[ch][3*gr+s][sb]=0}}}}};Layer2.prototype.decodeSamples=function(stream,quantclass){var sample=this.samples;var nb=quantclass.group;if(nb){var c=stream.read(quantclass.bits);var nlevels=quantclass.nlevels;for(var s=0;s<3;s++){sample[s]=c%nlevels;c=c/nlevels|0}}else{nb=quantclass.bits;for(var s=0;s<3;s++){sample[s]=stream.read(nb)}}for(var s=0;s<3;s++){var requantized=sample[s]^1<<nb-1;requantized|=-(requantized&1<<nb-1);requantized/=1<<nb-1;sample[s]=(requantized+quantclass.D)*quantclass.C}};module.exports=Layer2},{"./frame":4,"./header":5,"./tables":14,"./utils":15}],11:[function(require,module,exports){(function(global){var AV=typeof window!=="undefined"?window["AV"]:typeof global!=="undefined"?global["AV"]:null;var tables=require("./tables");var MP3FrameHeader=require("./header");var MP3Frame=require("./frame");var huffman=require("./huffman");var IMDCT=require("./imdct");var utils=require("./utils");function MP3SideInfo(){this.main_data_begin=null;this.private_bits=null;this.gr=[new MP3Granule,new MP3Granule];this.scfsi=new Uint8Array(2)}function MP3Granule(){this.ch=[new MP3Channel,new MP3Channel]}function MP3Channel(){this.part2_3_length=null;this.big_values=null;this.global_gain=null;this.scalefac_compress=null;this.flags=null;this.block_type=null;this.table_select=new Uint8Array(3);this.subblock_gain=new Uint8Array(3);this.region0_count=null;this.region1_count=null;this.scalefac=new Uint8Array(39)}function Layer3(){this.imdct=new IMDCT;this.si=new MP3SideInfo;this.xr=[new Float64Array(576),new Float64Array(576)];this._exponents=new Int32Array(39);this.reqcache=new Float64Array(16);this.modes=new Int16Array(39);this.output=new Float64Array(36);this.tmp=utils.makeArray([32,3,6]);this.tmp2=new Float64Array(32*3*6)}MP3Frame.layers[3]=Layer3;Layer3.prototype.decode=function(stream,frame){var header=frame.header;var next_md_begin=0;var md_len=0;var nch=header.nchannels();var si_len=header.flags&MP3FrameHeader.FLAGS.LSF_EXT?nch===1?9:17:nch===1?17:32;if(stream.next_frame-stream.nextByte()<si_len){stream.md_len=0;throw new Error("Bad frame length")}if(header.flags&MP3FrameHeader.FLAGS.PROTECTION){}var sideInfo=this.sideInfo(stream,nch,header.flags&MP3FrameHeader.FLAGS.LSF_EXT);var si=sideInfo.si;var data_bitlen=sideInfo.data_bitlen;var priv_bitlen=sideInfo.priv_bitlen;header.flags|=priv_bitlen;header.private_bits|=si.private_bits;var peek=stream.copy();peek.seek(stream.next_frame*8);var nextHeader=peek.read(16);if((nextHeader&65510)===65506){if((nextHeader&1)===0)peek.advance(16);peek.advance(16);next_md_begin=peek.read(nextHeader&8?9:8)}var frame_space=stream.next_frame-stream.nextByte();if(next_md_begin>si.main_data_begin+frame_space)next_md_begin=0;var md_len=si.main_data_begin+frame_space-next_md_begin;var frame_used=0;var ptr;if(si.main_data_begin===0){ptr=stream.stream;stream.md_len=0;frame_used=md_len}else{if(si.main_data_begin>stream.md_len){throw new Error("bad main_data_begin pointer")}else{var old_md_len=stream.md_len;if(md_len>si.main_data_begin){if(stream.md_len+md_len-si.main_data_begin>MP3FrameHeader.BUFFER_MDLEN){throw new Error("Assertion failed: (stream.md_len + md_len - si.main_data_begin <= MAD_MP3FrameHeader.BUFFER_MDLEN)")}frame_used=md_len-si.main_data_begin;this.memcpy(stream.main_data,stream.md_len,stream.stream.stream,stream.nextByte(),frame_used);stream.md_len+=frame_used}ptr=new AV.Bitstream(AV.Stream.fromBuffer(new AV.Buffer(stream.main_data)));ptr.advance((old_md_len-si.main_data_begin)*8)}}var frame_free=frame_space-frame_used;this.decodeMainData(ptr,frame,si,nch);if(frame_free>=next_md_begin){this.memcpy(stream.main_data,0,stream.stream.stream,stream.next_frame-next_md_begin,next_md_begin);stream.md_len=next_md_begin}else{if(md_len<si.main_data_begin){var extra=si.main_data_begin-md_len;if(extra+frame_free>next_md_begin)extra=next_md_begin-frame_free;if(extra<stream.md_len){this.memcpy(stream.main_data,0,stream.main_data,stream.md_len-extra,extra);stream.md_len=extra}}else{stream.md_len=0}this.memcpy(stream.main_data,stream.md_len,stream.stream.stream,stream.next_frame-frame_free,frame_free);stream.md_len+=frame_free}};Layer3.prototype.memcpy=function(dst,dstOffset,pSrc,srcOffset,length){var subarr;if(pSrc.subarray)subarr=pSrc.subarray(srcOffset,srcOffset+length);else subarr=pSrc.peekBuffer(srcOffset-pSrc.offset,length).data;dst.set(subarr,dstOffset);return dst};Layer3.prototype.sideInfo=function(stream,nch,lsf){var si=this.si;var data_bitlen=0;var priv_bitlen=lsf?nch===1?1:2:nch===1?5:3;si.main_data_begin=stream.read(lsf?8:9);si.private_bits=stream.read(priv_bitlen);var ngr=1;if(!lsf){ngr=2;for(var ch=0;ch<nch;++ch)si.scfsi[ch]=stream.read(4)}for(var gr=0;gr<ngr;gr++){var granule=si.gr[gr];for(var ch=0;ch<nch;ch++){var channel=granule.ch[ch];channel.part2_3_length=stream.read(12);channel.big_values=stream.read(9);channel.global_gain=stream.read(8);channel.scalefac_compress=stream.read(lsf?9:4);data_bitlen+=channel.part2_3_length;if(channel.big_values>288)throw new Error("bad big_values count");channel.flags=0;if(stream.read(1)){channel.block_type=stream.read(2);if(channel.block_type===0)throw new Error("reserved block_type");if(!lsf&&channel.block_type===2&&si.scfsi[ch])throw new Error("bad scalefactor selection info");channel.region0_count=7;channel.region1_count=36;if(stream.read(1))channel.flags|=tables.MIXED_BLOCK_FLAG;else if(channel.block_type===2)channel.region0_count=8;for(var i=0;i<2;i++)channel.table_select[i]=stream.read(5);for(var i=0;i<3;i++)channel.subblock_gain[i]=stream.read(3)}else{channel.block_type=0;for(var i=0;i<3;i++)channel.table_select[i]=stream.read(5);channel.region0_count=stream.read(4);channel.region1_count=stream.read(3)}channel.flags|=stream.read(lsf?2:3)}}return{si:si,data_bitlen:data_bitlen,priv_bitlen:priv_bitlen}};Layer3.prototype.decodeMainData=function(stream,frame,si,nch){var header=frame.header;var sfreq=header.samplerate;if(header.flags&MP3FrameHeader.FLAGS.MPEG_2_5_EXT)sfreq*=2;var sfreqi=(sfreq>>7&15)+(sfreq>>15&1)-8;if(header.flags&MP3FrameHeader.FLAGS.MPEG_2_5_EXT)sfreqi+=3;var ngr=header.flags&MP3FrameHeader.FLAGS.LSF_EXT?1:2;var xr=this.xr;for(var gr=0;gr<ngr;++gr){var granule=si.gr[gr];var sfbwidth=[];var l=0;for(var ch=0;ch<nch;++ch){var channel=granule.ch[ch];var part2_length;sfbwidth[ch]=tables.SFBWIDTH_TABLE[sfreqi].l;if(channel.block_type===2){sfbwidth[ch]=channel.flags&tables.MIXED_BLOCK_FLAG?tables.SFBWIDTH_TABLE[sfreqi].m:tables.SFBWIDTH_TABLE[sfreqi].s}if(header.flags&MP3FrameHeader.FLAGS.LSF_EXT){part2_length=this.scalefactors_lsf(stream,channel,ch===0?0:si.gr[1].ch[1],header.mode_extension)}else{part2_length=this.scalefactors(stream,channel,si.gr[0].ch[ch],gr===0?0:si.scfsi[ch])}this.huffmanDecode(stream,xr[ch],channel,sfbwidth[ch],part2_length)}if(header.mode===MP3FrameHeader.MODE.JOINT_STEREO&&header.mode_extension!==0)this.stereo(xr,si.gr,gr,header,sfbwidth[0]);for(var ch=0;ch<nch;ch++){var channel=granule.ch[ch];var sample=frame.sbsample[ch].slice(18*gr);var sb,l=0,i,sblimit;var output=this.output;if(channel.block_type===2){this.reorder(xr[ch],channel,sfbwidth[ch]);if(channel.flags&tables.MIXED_BLOCK_FLAG)this.aliasreduce(xr[ch],36)}else{this.aliasreduce(xr[ch],576)}if(channel.block_type!==2||channel.flags&tables.MIXED_BLOCK_FLAG){var block_type=channel.block_type;if(channel.flags&tables.MIXED_BLOCK_FLAG)block_type=0;for(var sb=0;sb<2;++sb,l+=18){this.imdct_l(xr[ch].subarray(l,l+18),output,block_type);this.overlap(output,frame.overlap[ch][sb],sample,sb)}}else{for(var sb=0;sb<2;++sb,l+=18){this.imdct_s(xr[ch].subarray(l,l+18),output);this.overlap(output,frame.overlap[ch][sb],sample,sb)}}this.freqinver(sample,1);var i=576;while(i>36&&xr[ch][i-1]===0){--i}sblimit=32-((576-i)/18<<0);if(channel.block_type!==2){for(var sb=2;sb<sblimit;++sb,l+=18){this.imdct_l(xr[ch].subarray(l,l+18),output,channel.block_type);this.overlap(output,frame.overlap[ch][sb],sample,sb);if(sb&1)this.freqinver(sample,sb)}}else{for(var sb=2;sb<sblimit;++sb,l+=18){this.imdct_s(xr[ch].subarray(l,l+18),output);this.overlap(output,frame.overlap[ch][sb],sample,sb);if(sb&1)this.freqinver(sample,sb)}}for(var sb=sblimit;sb<32;++sb){this.overlap_z(frame.overlap[ch][sb],sample,sb);if(sb&1)this.freqinver(sample,sb)}}}};Layer3.prototype.scalefactors=function(stream,channel,gr0ch,scfsi){var start=stream.offset();var slen1=tables.SFLEN_TABLE[channel.scalefac_compress].slen1;var slen2=tables.SFLEN_TABLE[channel.scalefac_compress].slen2;var sfbi;if(channel.block_type===2){sfbi=0;var nsfb=channel.flags&tables.MIXED_BLOCK_FLAG?8+3*3:6*3;while(nsfb--)channel.scalefac[sfbi++]=stream.read(slen1);nsfb=6*3;while(nsfb--)channel.scalefac[sfbi++]=stream.read(slen2);nsfb=1*3;while(nsfb--)channel.scalefac[sfbi++]=0}else{if(scfsi&8){for(var sfbi=0;sfbi<6;++sfbi)channel.scalefac[sfbi]=gr0ch.scalefac[sfbi]}else{for(var sfbi=0;sfbi<6;++sfbi)channel.scalefac[sfbi]=stream.read(slen1)}if(scfsi&4){for(var sfbi=6;sfbi<11;++sfbi)channel.scalefac[sfbi]=gr0ch.scalefac[sfbi]}else{for(var sfbi=6;sfbi<11;++sfbi)channel.scalefac[sfbi]=stream.read(slen1)}if(scfsi&2){for(var sfbi=11;sfbi<16;++sfbi)channel.scalefac[sfbi]=gr0ch.scalefac[sfbi]}else{for(var sfbi=11;sfbi<16;++sfbi)channel.scalefac[sfbi]=stream.read(slen2)}if(scfsi&1){for(var sfbi=16;sfbi<21;++sfbi)channel.scalefac[sfbi]=gr0ch.scalefac[sfbi]}else{for(var sfbi=16;sfbi<21;++sfbi)channel.scalefac[sfbi]=stream.read(slen2)}channel.scalefac[21]=0}return stream.offset()-start};Layer3.prototype.scalefactors_lsf=function(stream,channel,gr1ch,mode_extension){var start=stream.offset();var scalefac_compress=channel.scalefac_compress;var index=channel.block_type===2?channel.flags&tables.MIXED_BLOCK_FLAG?2:1:0;var slen=new Int32Array(4);var nsfb;if(!(mode_extension&tables.I_STEREO&&gr1ch)){if(scalefac_compress<400){slen[0]=(scalefac_compress>>>4)/5;slen[1]=(scalefac_compress>>>4)%5;slen[2]=scalefac_compress%16>>>2;slen[3]=scalefac_compress%4;nsfb=tables.NSFB_TABLE[0][index]}else if(scalefac_compress<500){scalefac_compress-=400;slen[0]=(scalefac_compress>>>2)/5;slen[1]=(scalefac_compress>>>2)%5;slen[2]=scalefac_compress%4;slen[3]=0;nsfb=tables.NSFB_TABLE[1][index]}else{scalefac_compress-=500;slen[0]=scalefac_compress/3;slen[1]=scalefac_compress%3;slen[2]=0;slen[3]=0;channel.flags|=tables.PREFLAG;nsfb=tables.NSFB_TABLE[2][index]}var n=0;for(var part=0;part<4;part++){for(var i=0;i<nsfb[part];i++){channel.scalefac[n++]=stream.read(slen[part])}}while(n<39){channel.scalefac[n++]=0}}else{scalefac_compress>>>=1;if(scalefac_compress<180){slen[0]=scalefac_compress/36;slen[1]=scalefac_compress%36/6;slen[2]=scalefac_compress%36%6;slen[3]=0;nsfb=tables.NSFB_TABLE[3][index]}else if(scalefac_compress<244){scalefac_compress-=180;slen[0]=scalefac_compress%64>>>4;slen[1]=scalefac_compress%16>>>2;slen[2]=scalefac_compress%4;slen[3]=0;nsfb=tables.NSFB_TABLE[4][index]}else{scalefac_compress-=244;slen[0]=scalefac_compress/3;slen[1]=scalefac_compress%3;slen[2]=0;slen[3]=0;nsfb=tables.NSFB_TABLE[5][index]}var n=0;for(var part=0;part<4;++part){var max=(1<<slen[part])-1;for(var i=0;i<nsfb[part];++i){var is_pos=stream.read(slen[part]);channel.scalefac[n]=is_pos;gr1ch.scalefac[n++]=is_pos===max?1:0}}while(n<39){channel.scalefac[n]=0;gr1ch.scalefac[n++]=0}}return stream.offset()-start};Layer3.prototype.huffmanDecode=function(stream,xr,channel,sfbwidth,part2_length){var exponents=this._exponents;var sfbwidthptr=0;var bits_left=channel.part2_3_length-part2_length;if(bits_left<0)throw new Error("bad audio data length");this.exponents(channel,sfbwidth,exponents);var peek=stream.copy();stream.advance(bits_left);var cachesz=8-peek.bitPosition;cachesz+=32-1-24+(24-cachesz)&~7;var bitcache=peek.read(cachesz);bits_left-=cachesz;var xrptr=0;var region=0;var reqcache=this.reqcache;var sfbound=xrptr+sfbwidth[sfbwidthptr++];var rcount=channel.region0_count+1;var entry=huffman.huff_pair_table[channel.table_select[region]];var table=entry.table;var linbits=entry.linbits;var startbits=entry.startbits;if(typeof table==="undefined")throw new Error("bad Huffman table select");var expptr=0;var exp=exponents[expptr++];var reqhits=0;var big_values=channel.big_values;while(big_values--&&cachesz+bits_left>0){if(xrptr===sfbound){sfbound+=sfbwidth[sfbwidthptr++];if(--rcount===0){if(region===0)rcount=channel.region1_count+1;else rcount=0;entry=huffman.huff_pair_table[channel.table_select[++region]];table=entry.table;linbits=entry.linbits;startbits=entry.startbits;if(typeof table==="undefined")throw new Error("bad Huffman table select")}if(exp!==exponents[expptr]){exp=exponents[expptr];reqhits=0}++expptr}if(cachesz<21){var bits=32-1-21+(21-cachesz)&~7;bitcache=bitcache<<bits|peek.read(bits);cachesz+=bits;bits_left-=bits}var clumpsz=startbits;var pair=table[bitcache>>cachesz-clumpsz&(1<<clumpsz)-1];while(!pair.final){cachesz-=clumpsz;clumpsz=pair.ptr.bits;pair=table[pair.ptr.offset+(bitcache>>cachesz-clumpsz&(1<<clumpsz)-1)]}cachesz-=pair.value.hlen;if(linbits){var value=pair.value.x;var x_final=false;switch(value){case 0:xr[xrptr]=0;break;case 15:if(cachesz<linbits+2){bitcache=bitcache<<16|peek.read(16);cachesz+=16;bits_left-=16}value+=bitcache>>cachesz-linbits&(1<<linbits)-1;cachesz-=linbits;requantized=this.requantize(value,exp);x_final=true;break;default:if(reqhits&1<<value){requantized=reqcache[value]}else{reqhits|=1<<value;requantized=reqcache[value]=this.requantize(value,exp)}x_final=true}if(x_final){xr[xrptr]=bitcache&1<<cachesz---1?-requantized:requantized}value=pair.value.y;var y_final=false;switch(value){case 0:xr[xrptr+1]=0;break;case 15:if(cachesz<linbits+1){bitcache=bitcache<<16|peek.read(16);cachesz+=16;bits_left-=16}value+=bitcache>>cachesz-linbits&(1<<linbits)-1;cachesz-=linbits;requantized=this.requantize(value,exp);y_final=true;break;default:if(reqhits&1<<value){requantized=reqcache[value]}else{reqhits|=1<<value;reqcache[value]=this.requantize(value,exp);requantized=reqcache[value]}y_final=true}if(y_final){xr[xrptr+1]=bitcache&1<<cachesz---1?-requantized:requantized}}else{var value=pair.value.x;if(value===0){xr[xrptr]=0}else{if(reqhits&1<<value)requantized=reqcache[value];else{reqhits|=1<<value;requantized=reqcache[value]=this.requantize(value,exp)}xr[xrptr]=bitcache&1<<cachesz---1?-requantized:requantized}value=pair.value.y;if(value===0){xr[xrptr+1]=0}else{if(reqhits&1<<value)requantized=reqcache[value];else{reqhits|=1<<value;requantized=reqcache[value]=this.requantize(value,exp)}xr[xrptr+1]=bitcache&1<<cachesz---1?-requantized:requantized}}xrptr+=2}if(cachesz+bits_left<0)throw new Error("Huffman data overrun");var table=huffman.huff_quad_table[channel.flags&tables.COUNT1TABLE_SELECT];var requantized=this.requantize(1,exp);while(cachesz+bits_left>0&&xrptr<=572){if(cachesz<10){bitcache=bitcache<<16|peek.read(16);cachesz+=16;bits_left-=16}var quad=table[bitcache>>cachesz-4&(1<<4)-1];if(!quad.final){cachesz-=4;quad=table[quad.ptr.offset+(bitcache>>cachesz-quad.ptr.bits&(1<<quad.ptr.bits)-1)]}cachesz-=quad.value.hlen;if(xrptr===sfbound){sfbound+=sfbwidth[sfbwidthptr++];if(exp!==exponents[expptr]){exp=exponents[expptr];requantized=this.requantize(1,exp)}++expptr}xr[xrptr]=quad.value.v?bitcache&1<<cachesz---1?-requantized:requantized:0;xr[xrptr+1]=quad.value.w?bitcache&1<<cachesz---1?-requantized:requantized:0;xrptr+=2;if(xrptr===sfbound){sfbound+=sfbwidth[sfbwidthptr++];if(exp!==exponents[expptr]){exp=exponents[expptr];requantized=this.requantize(1,exp)}++expptr}xr[xrptr]=quad.value.x?bitcache&1<<cachesz---1?-requantized:requantized:0;xr[xrptr+1]=quad.value.y?bitcache&1<<cachesz---1?-requantized:requantized:0;xrptr+=2;if(cachesz+bits_left<0){xrptr-=4}}if(-bits_left>MP3FrameHeader.BUFFER_GUARD*8){throw new Error("assertion failed: (-bits_left <= MP3FrameHeader.BUFFER_GUARD * CHAR_BIT)")}while(xrptr<576){xr[xrptr]=0;xr[xrptr+1]=0;xrptr+=2}};Layer3.prototype.requantize=function(value,exp){var frac=exp%4>>0;exp=exp/4>>0;var requantized=Math.pow(value,4/3);requantized*=Math.pow(2,exp/4);if(frac){requantized*=Math.pow(2,frac/4)}if(exp<0){requantized/=Math.pow(2,-exp*(3/4))}return requantized};Layer3.prototype.exponents=function(channel,sfbwidth,exponents){var gain=channel.global_gain-210;var scalefac_multiplier=channel.flags&tables.SCALEFAC_SCALE?2:1;if(channel.block_type===2){var sfbi=0,l=0;if(channel.flags&tables.MIXED_BLOCK_FLAG){var premask=channel.flags&tables.PREFLAG?~0:0;while(l<36){exponents[sfbi]=gain-(channel.scalefac[sfbi]+(tables.PRETAB[sfbi]&premask)<<scalefac_multiplier);l+=sfbwidth[sfbi++]}}var gain0=gain-8*channel.subblock_gain[0];var gain1=gain-8*channel.subblock_gain[1];var gain2=gain-8*channel.subblock_gain[2];while(l<576){exponents[sfbi+0]=gain0-(channel.scalefac[sfbi+0]<<scalefac_multiplier);exponents[sfbi+1]=gain1-(channel.scalefac[sfbi+1]<<scalefac_multiplier);exponents[sfbi+2]=gain2-(channel.scalefac[sfbi+2]<<scalefac_multiplier);l+=3*sfbwidth[sfbi];sfbi+=3}}else{if(channel.flags&tables.PREFLAG){for(var sfbi=0;sfbi<22;sfbi++){exponents[sfbi]=gain-(channel.scalefac[sfbi]+tables.PRETAB[sfbi]<<scalefac_multiplier)}}else{for(var sfbi=0;sfbi<22;sfbi++){exponents[sfbi]=gain-(channel.scalefac[sfbi]<<scalefac_multiplier)}}}};Layer3.prototype.stereo=function(xr,granules,gr,header,sfbwidth){var granule=granules[gr];var modes=this.modes;var sfbi,l,n,i;if(granule.ch[0].block_type!==granule.ch[1].block_type||(granule.ch[0].flags&tables.MIXED_BLOCK_FLAG)!==(granule.ch[1].flags&tables.MIXED_BLOCK_FLAG))throw new Error("incompatible stereo block_type");for(var i=0;i<39;i++)modes[i]=header.mode_extension;if(header.mode_extension&tables.I_STEREO){var right_ch=granule.ch[1];var right_xr=xr[1];header.flags|=MP3FrameHeader.FLAGS.I_STEREO;if(right_ch.block_type===2){var lower,start,max,bound=new Uint32Array(3),w;lower=start=max=bound[0]=bound[1]=bound[2]=0;sfbi=l=0;if(right_ch.flags&tables.MIXED_BLOCK_FLAG){while(l<36){n=sfbwidth[sfbi++];for(var i=0;i<n;++i){if(right_xr[i]){lower=sfbi;break}}right_xr+=n;l+=n}start=sfbi}var w=0;while(l<576){n=sfbwidth[sfbi++];for(i=0;i<n;++i){if(right_xr[i]){max=bound[w]=sfbi;break}}right_xr+=n;l+=n;w=(w+1)%3}if(max)lower=start;for(i=0;i<lower;++i)modes[i]=header.mode_extension&~tables.I_STEREO;w=0;for(i=start;i<max;++i){if(i<bound[w])modes[i]=header.mode_extension&~tables.I_STEREO;w=(w+1)%3}}else{var bound=0;for(sfbi=l=0;l<576;l+=n){n=sfbwidth[sfbi++];for(i=0;i<n;++i){if(right_xr[i]){bound=sfbi;break}}right_xr+=n}for(i=0;i<bound;++i)modes[i]=header.mode_extension&~tables.I_STEREO}if(header.flags&MP3FrameHeader.FLAGS.LSF_EXT){var illegal_pos=granules[gr+1].ch[1].scalefac;var lsf_scale=IS_Ltables.SF_TABLE[right_ch.scalefac_compress&1];for(sfbi=l=0;l<576;++sfbi,l+=n){n=sfbwidth[sfbi];if(!(modes[sfbi]&tables.I_STEREO))continue;if(illegal_pos[sfbi]){modes[sfbi]&=~tables.I_STEREO;continue}is_pos=right_ch.scalefac[sfbi];for(i=0;i<n;++i){var left=xr[0][l+i];if(is_pos===0){xr[1][l+i]=left}else{var opposite=left*lsf_scale[(is_pos-1)/2];if(is_pos&1){xr[0][l+i]=opposite;xr[1][l+i]=left}else{xr[1][l+i]=opposite}}}}}else{for(sfbi=l=0;l<576;++sfbi,l+=n){n=sfbwidth[sfbi];if(!(modes[sfbi]&tables.I_STEREO))continue;is_pos=right_ch.scalefac[sfbi];if(is_pos>=7){modes[sfbi]&=~tables.I_STEREO;continue}for(i=0;i<n;++i){var left=xr[0][l+i];xr[0][l+i]=left*tables.IS_TABLE[is_pos];xr[1][l+i]=left*tables.IS_TABLE[6-is_pos]}}}}if(header.mode_extension&tables.MS_STEREO){header.flags|=tables.MS_STEREO;var invsqrt2=tables.ROOT_TABLE[3+-2];for(sfbi=l=0;l<576;++sfbi,l+=n){n=sfbwidth[sfbi];if(modes[sfbi]!==tables.MS_STEREO)continue;for(i=0;i<n;++i){var m=xr[0][l+i];var s=xr[1][l+i];xr[0][l+i]=(m+s)*invsqrt2;xr[1][l+i]=(m-s)*invsqrt2}}}};Layer3.prototype.aliasreduce=function(xr,lines){for(var xrPointer=18;xrPointer<lines;xrPointer+=18){for(var i=0;i<8;++i){var a=xr[xrPointer-i-1];var b=xr[xrPointer+i];xr[xrPointer-i-1]=a*tables.CS[i]-b*tables.CA[i];xr[xrPointer+i]=b*tables.CS[i]+a*tables.CA[i]}}};Layer3.prototype.imdct_l=function(X,z,block_type){this.imdct.imdct36(X,z);switch(block_type){case 0:for(var i=0;i<36;++i)z[i]=z[i]*tables.WINDOW_L[i];break;case 1:for(var i=0;i<18;++i)z[i]=z[i]*tables.WINDOW_L[i];for(var i=24;i<30;++i)z[i]=z[i]*tables.WINDOW_S[i-18];for(var i=30;i<36;++i)z[i]=0;break;case 3:for(var i=0;i<6;++i)z[i]=0;for(var i=6;i<12;++i)z[i]=z[i]*tables.WINDOW_S[i-6];for(var i=18;i<36;++i)z[i]=z[i]*tables.WINDOW_L[i];break}};Layer3.prototype.imdct_s=function(X,z){var yptr=0;var wptr;var Xptr=0;var y=new Float64Array(36);var hi,lo;for(var w=0;w<3;++w){var sptr=0;for(var i=0;i<3;++i){lo=X[Xptr+0]*IMDCT.S[sptr][0]+X[Xptr+1]*IMDCT.S[sptr][1]+X[Xptr+2]*IMDCT.S[sptr][2]+X[Xptr+3]*IMDCT.S[sptr][3]+X[Xptr+4]*IMDCT.S[sptr][4]+X[Xptr+5]*IMDCT.S[sptr][5];y[yptr+i+0]=lo;y[yptr+5-i]=-y[yptr+i+0];++sptr;lo=X[Xptr+0]*IMDCT.S[sptr][0]+X[Xptr+1]*IMDCT.S[sptr][1]+X[Xptr+2]*IMDCT.S[sptr][2]+X[Xptr+3]*IMDCT.S[sptr][3]+X[Xptr+4]*IMDCT.S[sptr][4]+X[Xptr+5]*IMDCT.S[sptr][5];y[yptr+i+6]=lo;y[yptr+11-i]=y[yptr+i+6];++sptr}yptr+=12;Xptr+=6}yptr=0;var wptr=0;for(var i=0;i<6;++i){z[i+0]=0;z[i+6]=y[yptr+0+0]*tables.WINDOW_S[wptr+0];lo=y[yptr+0+6]*tables.WINDOW_S[wptr+6]+y[yptr+12+0]*tables.WINDOW_S[wptr+0];z[i+12]=lo;lo=y[yptr+12+6]*tables.WINDOW_S[wptr+6]+y[yptr+24+0]*tables.WINDOW_S[wptr+0];z[i+18]=lo;z[i+24]=y[yptr+24+6]*tables.WINDOW_S[wptr+6];z[i+30]=0;++yptr;++wptr}};Layer3.prototype.overlap=function(output,overlap,sample,sb){for(var i=0;i<18;++i){sample[i][sb]=output[i]+overlap[i];overlap[i]=output[i+18]}};Layer3.prototype.freqinver=function(sample,sb){for(var i=1;i<18;i+=2)sample[i][sb]=-sample[i][sb]};Layer3.prototype.overlap_z=function(overlap,sample,sb){for(var i=0;i<18;++i){sample[i][sb]=overlap[i];overlap[i]=0}};Layer3.prototype.reorder=function(xr,channel,sfbwidth){var sfbwidthPointer=0;var tmp=this.tmp;var sbw=new Uint32Array(3);var sw=new Uint32Array(3);var sb=0;if(channel.flags&tables.MIXED_BLOCK_FLAG){var sb=2;var l=0;while(l<36)l+=sfbwidth[sfbwidthPointer++]}for(var w=0;w<3;++w){sbw[w]=sb;sw[w]=0}f=sfbwidth[sfbwidthPointer++];w=0;for(var l=18*sb;l<576;++l){if(f--===0){f=sfbwidth[sfbwidthPointer++]-1;w=(w+1)%3}tmp[sbw[w]][w][sw[w]++]=xr[l];if(sw[w]===6){sw[w]=0;++sbw[w]}}var tmp2=this.tmp2;var ptr=0;for(var i=0;i<32;i++){for(var j=0;j<3;j++){for(var k=0;k<6;k++){tmp2[ptr++]=tmp[i][j][k]}}}var len=576-18*sb;for(var i=0;i<len;i++){xr[18*sb+i]=tmp2[sb+i]}};module.exports=Layer3}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./frame":4,"./header":5,"./huffman":6,"./imdct":8,"./tables":14,"./utils":15}],12:[function(require,module,exports){(function(global){var AV=typeof window!=="undefined"?window["AV"]:typeof global!=="undefined"?global["AV"]:null;var MP3FrameHeader=require("./header");function MP3Stream(stream){this.stream=stream;this.sync=false;this.freerate=0;this.this_frame=stream.stream.offset;this.next_frame=stream.stream.offset;this.main_data=new Uint8Array(MP3FrameHeader.BUFFER_MDLEN);this.md_len=0;for(var key in stream){if(typeof stream[key]==="function")this[key]=stream[key].bind(stream)}}MP3Stream.prototype.getU8=function(offset){var stream=this.stream.stream;return stream.peekUInt8(offset-stream.offset)};MP3Stream.prototype.nextByte=function(){var stream=this.stream;return stream.bitPosition===0?stream.stream.offset:stream.stream.offset+1};MP3Stream.prototype.doSync=function(){var stream=this.stream.stream;this.align();while(this.available(16)&&!(stream.peekUInt8(0)===255&&(stream.peekUInt8(1)&224)===224)){this.advance(8)}if(!this.available(MP3FrameHeader.BUFFER_GUARD))return false;return true};MP3Stream.prototype.reset=function(byteOffset){this.seek(byteOffset*8);this.next_frame=byteOffset;this.sync=true};module.exports=MP3Stream}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./header":5}],13:[function(require,module,exports){var utils=require("./utils");function MP3Synth(){this.filter=utils.makeArray([2,2,2,16,8]);this.phase=0;this.pcm={samplerate:0,channels:0,length:0,samples:[new Float64Array(1152),new Float64Array(1152)]}}const costab1=.998795456;const costab2=.995184727;const costab3=.98917651;const costab4=.98078528;const costab5=.970031253;const costab6=.956940336;const costab7=.941544065;const costab8=.923879533;const costab9=.903989293;const costab10=.881921264;const costab11=.85772861;const costab12=.831469612;const costab13=.803207531;const costab14=.773010453;const costab15=.740951125;const costab16=.707106781;const costab17=.671558955;const costab18=.634393284;const costab19=.595699304;const costab20=.555570233;const costab21=.514102744;const costab22=.471396737;const costab23=.427555093;const costab24=.382683432;const costab25=.336889853;const costab26=.290284677;const costab27=.24298018;const costab28=.195090322;const costab29=.146730474;const costab30=.09801714;const costab31=.049067674;MP3Synth.dct32=function(_in,slot,lo,hi){var t0,t1,t2,t3,t4,t5,t6,t7;var t8,t9,t10,t11,t12,t13,t14,t15;var t16,t17,t18,t19,t20,t21,t22,t23;var t24,t25,t26,t27,t28,t29,t30,t31;var t32,t33,t34,t35,t36,t37,t38,t39;var t40,t41,t42,t43,t44,t45,t46,t47;var t48,t49,t50,t51,t52,t53,t54,t55;var t56,t57,t58,t59,t60,t61,t62,t63;var t64,t65,t66,t67,t68,t69,t70,t71;var t72,t73,t74,t75,t76,t77,t78,t79;var t80,t81,t82,t83,t84,t85,t86,t87;var t88,t89,t90,t91,t92,t93,t94,t95;var t96,t97,t98,t99,t100,t101,t102,t103;var t104,t105,t106,t107,t108,t109,t110,t111;var t112,t113,t114,t115,t116,t117,t118,t119;var t120,t121,t122,t123,t124,t125,t126,t127;var t128,t129,t130,t131,t132,t133,t134,t135;var t136,t137,t138,t139,t140,t141,t142,t143;var t144,t145,t146,t147,t148,t149,t150,t151;var t152,t153,t154,t155,t156,t157,t158,t159;var t160,t161,t162,t163,t164,t165,t166,t167;var t168,t169,t170,t171,t172,t173,t174,t175;var t176;t0=_in[0]+_in[31];t16=(_in[0]-_in[31])*costab1;t1=_in[15]+_in[16];t17=(_in[15]-_in[16])*costab31;t41=t16+t17;t59=(t16-t17)*costab2;t33=t0+t1;t50=(t0-t1)*costab2;t2=_in[7]+_in[24];t18=(_in[7]-_in[24])*costab15;t3=_in[8]+_in[23];t19=(_in[8]-_in[23])*costab17;t42=t18+t19;t60=(t18-t19)*costab30;t34=t2+t3;t51=(t2-t3)*costab30;t4=_in[3]+_in[28];t20=(_in[3]-_in[28])*costab7;t5=_in[12]+_in[19];t21=(_in[12]-_in[19])*costab25;t43=t20+t21;t61=(t20-t21)*costab14;t35=t4+t5;t52=(t4-t5)*costab14;t6=_in[4]+_in[27];t22=(_in[4]-_in[27])*costab9;t7=_in[11]+_in[20];t23=(_in[11]-_in[20])*costab23;t44=t22+t23;t62=(t22-t23)*costab18;t36=t6+t7;t53=(t6-t7)*costab18;t8=_in[1]+_in[30];t24=(_in[1]-_in[30])*costab3;t9=_in[14]+_in[17];t25=(_in[14]-_in[17])*costab29;t45=t24+t25;t63=(t24-t25)*costab6;t37=t8+t9;t54=(t8-t9)*costab6;t10=_in[6]+_in[25];t26=(_in[6]-_in[25])*costab13;t11=_in[9]+_in[22];t27=(_in[9]-_in[22])*costab19;t46=t26+t27;t64=(t26-t27)*costab26;t38=t10+t11;t55=(t10-t11)*costab26;t12=_in[2]+_in[29];t28=(_in[2]-_in[29])*costab5;t13=_in[13]+_in[18];t29=(_in[13]-_in[18])*costab27;t47=t28+t29;t65=(t28-t29)*costab10;t39=t12+t13;t56=(t12-t13)*costab10;t14=_in[5]+_in[26];t30=(_in[5]-_in[26])*costab11;t15=_in[10]+_in[21];t31=(_in[10]-_in[21])*costab21;t48=t30+t31;t66=(t30-t31)*costab22;t40=t14+t15;t57=(t14-t15)*costab22;t69=t33+t34;t89=(t33-t34)*costab4;t70=t35+t36;t90=(t35-t36)*costab28;t71=t37+t38;t91=(t37-t38)*costab12;t72=t39+t40;t92=(t39-t40)*costab20;t73=t41+t42;t94=(t41-t42)*costab4;t74=t43+t44;t95=(t43-t44)*costab28;t75=t45+t46;t96=(t45-t46)*costab12;t76=t47+t48;t97=(t47-t48)*costab20;t78=t50+t51;t100=(t50-t51)*costab4;t79=t52+t53;t101=(t52-t53)*costab28;t80=t54+t55;t102=(t54-t55)*costab12;t81=t56+t57;t103=(t56-t57)*costab20;t83=t59+t60;t106=(t59-t60)*costab4;t84=t61+t62;t107=(t61-t62)*costab28;t85=t63+t64;t108=(t63-t64)*costab12;t86=t65+t66;t109=(t65-t66)*costab20;t113=t69+t70;t114=t71+t72;hi[15][slot]=t113+t114;lo[0][slot]=(t113-t114)*costab16;t115=t73+t74;t116=t75+t76;t32=t115+t116;hi[14][slot]=t32;t118=t78+t79;t119=t80+t81;t58=t118+t119;hi[13][slot]=t58;t121=t83+t84;t122=t85+t86;t67=t121+t122;t49=t67*2-t32;hi[12][slot]=t49;t125=t89+t90;t126=t91+t92;t93=t125+t126;hi[11][slot]=t93;t128=t94+t95;t129=t96+t97;t98=t128+t129;t68=t98*2-t49;hi[10][slot]=t68;t132=t100+t101;t133=t102+t103;t104=t132+t133;t82=t104*2-t58;hi[9][slot]=t82;t136=t106+t107;t137=t108+t109;t110=t136+t137;t87=t110*2-t67;t77=t87*2-t68;hi[8][slot]=t77;t141=(t69-t70)*costab8;t142=(t71-t72)*costab24;t143=t141+t142;hi[7][slot]=t143;lo[8][slot]=(t141-t142)*costab16*2-t143;t144=(t73-t74)*costab8;t145=(t75-t76)*costab24;t146=t144+t145;t88=t146*2-t77;hi[6][slot]=t88;t148=(t78-t79)*costab8;t149=(t80-t81)*costab24;t150=t148+t149;t105=t150*2-t82;hi[5][slot]=t105;t152=(t83-t84)*costab8;t153=(t85-t86)*costab24;t154=t152+t153;t111=t154*2-t87;t99=t111*2-t88;hi[4][slot]=t99;t157=(t89-t90)*costab8;t158=(t91-t92)*costab24;t159=t157+t158;t127=t159*2-t93;hi[3][slot]=t127;t160=(t125-t126)*costab16*2-t127;lo[4][slot]=t160;lo[12][slot]=((t157-t158)*costab16*2-t159)*2-t160;t161=(t94-t95)*costab8;t162=(t96-t97)*costab24;t163=t161+t162;t130=t163*2-t98;t112=t130*2-t99;hi[2][slot]=t112;t164=(t128-t129)*costab16*2-t130;t166=(t100-t101)*costab8;t167=(t102-t103)*costab24;t168=t166+t167;t134=t168*2-t104;t120=t134*2-t105;hi[1][slot]=t120;t135=(t118-t119)*costab16*2-t120;lo[2][slot]=t135;t169=(t132-t133)*costab16*2-t134;t151=t169*2-t135;lo[6][slot]=t151;t170=((t148-t149)*costab16*2-t150)*2-t151;lo[10][slot]=t170;lo[14][slot]=(((t166-t167)*costab16*2-t168)*2-t169)*2-t170;t171=(t106-t107)*costab8;t172=(t108-t109)*costab24;t173=t171+t172;t138=t173*2-t110;t123=t138*2-t111;t139=(t121-t122)*costab16*2-t123;t117=t123*2-t112;hi[0][slot]=t117;t124=(t115-t116)*costab16*2-t117;lo[1][slot]=t124;t131=t139*2-t124;lo[3][slot]=t131;t140=t164*2-t131;lo[5][slot]=t140;t174=(t136-t137)*costab16*2-t138;t155=t174*2-t139;t147=t155*2-t140;lo[7][slot]=t147;t156=((t144-t145)*costab16*2-t146)*2-t147;lo[9][slot]=t156;t175=((t152-t153)*costab16*2-t154)*2-t155;t165=t175*2-t156;lo[11][slot]=t165;t176=(((t161-t162)*costab16*2-t163)*2-t164)*2-t165;lo[13][slot]=t176;lo[15][slot]=((((t171-t172)*costab16*2-t173)*2-t174)*2-t175)*2-t176};const D=[[0,-442505e-9,.003250122,-.007003784,.031082153,-.07862854,.100311279,-.572036743,1.144989014,.572036743,.100311279,.07862854,.031082153,.007003784,.003250122,442505e-9,0,-442505e-9,.003250122,-.007003784,.031082153,-.07862854,.100311279,-.572036743,1.144989014,.572036743,.100311279,.07862854,.031082153,.007003784,.003250122,442505e-9],[-15259e-9,-473022e-9,.003326416,-.007919312,.030517578,-.084182739,.090927124,-.600219727,1.144287109,.543823242,.108856201,.073059082,.031478882,.006118774,.003173828,396729e-9,-15259e-9,-473022e-9,.003326416,-.007919312,.030517578,-.084182739,.090927124,-.600219727,1.144287109,.543823242,.108856201,.073059082,.031478882,.006118774,.003173828,396729e-9],[-15259e-9,-534058e-9,.003387451,-.008865356,.029785156,-.089706421,.080688477,-.628295898,1.142211914,.515609741,.116577148,.067520142,.031738281,.0052948,.003082275,366211e-9,-15259e-9,-534058e-9,.003387451,-.008865356,.029785156,-.089706421,.080688477,-.628295898,1.142211914,.515609741,.116577148,.067520142,.031738281,.0052948,.003082275,366211e-9],[-15259e-9,-579834e-9,.003433228,-.009841919,.028884888,-.095169067,.069595337,-.656219482,1.138763428,.487472534,.123474121,.06199646,.031845093,.004486084,.002990723,320435e-9,-15259e-9,-579834e-9,.003433228,-.009841919,.028884888,-.095169067,.069595337,-.656219482,1.138763428,.487472534,.123474121,.06199646,.031845093,.004486084,.002990723,320435e-9],[-15259e-9,-62561e-8,.003463745,-.010848999,.027801514,-.100540161,.057617187,-.683914185,1.133926392,.459472656,.129577637,.056533813,.031814575,.003723145,.00289917,289917e-9,-15259e-9,-62561e-8,.003463745,-.010848999,.027801514,-.100540161,.057617187,-.683914185,1.133926392,.459472656,.129577637,.056533813,.031814575,.003723145,.00289917,289917e-9],[-15259e-9,-686646e-9,.003479004,-.011886597,.026535034,-.105819702,.044784546,-.71131897,1.127746582,.431655884,.134887695,.051132202,.031661987,.003005981,.002792358,259399e-9,-15259e-9,-686646e-9,.003479004,-.011886597,.026535034,-.105819702,.044784546,-.71131897,1.127746582,.431655884,.134887695,.051132202,.031661987,.003005981,.002792358,259399e-9],[-15259e-9,-747681e-9,.003479004,-.012939453,.025085449,-.110946655,.031082153,-.738372803,1.120223999,.404083252,.139450073,.045837402,.031387329,.002334595,.002685547,244141e-9,-15259e-9,-747681e-9,.003479004,-.012939453,.025085449,-.110946655,.031082153,-.738372803,1.120223999,.404083252,.139450073,.045837402,.031387329,.002334595,.002685547,244141e-9],[-30518e-9,-808716e-9,.003463745,-.014022827,.023422241,-.115921021,.01651001,-.765029907,1.111373901,.376800537,.143264771,.040634155,.031005859,.001693726,.002578735,213623e-9,-30518e-9,-808716e-9,.003463745,-.014022827,.023422241,-.115921021,.01651001,-.765029907,1.111373901,.376800537,.143264771,.040634155,.031005859,.001693726,.002578735,213623e-9],[-30518e-9,-88501e-8,.003417969,-.01512146,.021575928,-.120697021,.001068115,-.791213989,1.101211548,.349868774,.146362305,.035552979,.030532837,.001098633,.002456665,198364e-9,-30518e-9,-88501e-8,.003417969,-.01512146,.021575928,-.120697021,.001068115,-.791213989,1.101211548,.349868774,.146362305,.035552979,.030532837,.001098633,.002456665,198364e-9],[-30518e-9,-961304e-9,.003372192,-.016235352,.01953125,-.125259399,-.015228271,-.816864014,1.089782715,.323318481,.148773193,.030609131,.029937744,549316e-9,.002349854,167847e-9,-30518e-9,-961304e-9,.003372192,-.016235352,.01953125,-.125259399,-.015228271,-.816864014,1.089782715,.323318481,.148773193,.030609131,.029937744,549316e-9,.002349854,167847e-9],[-30518e-9,-.001037598,.00328064,-.017349243,.01725769,-.129562378,-.03237915,-.841949463,1.07711792,.297210693,.150497437,.025817871,.029281616,30518e-9,.002243042,152588e-9,-30518e-9,-.001037598,.00328064,-.017349243,.01725769,-.129562378,-.03237915,-.841949463,1.07711792,.297210693,.150497437,.025817871,.029281616,30518e-9,.002243042,152588e-9],[-45776e-9,-.001113892,.003173828,-.018463135,.014801025,-.133590698,-.050354004,-.866363525,1.063217163,.271591187,.151596069,.021179199,.028533936,-442505e-9,.002120972,137329e-9,-45776e-9,-.001113892,.003173828,-.018463135,.014801025,-.133590698,-.050354004,-.866363525,1.063217163,.271591187,.151596069,.021179199,.028533936,-442505e-9,.002120972,137329e-9],[-45776e-9,-.001205444,.003051758,-.019577026,.012115479,-.137298584,-.069168091,-.890090942,1.048156738,.246505737,.152069092,.016708374,.02772522,-869751e-9,.00201416,12207e-8,-45776e-9,-.001205444,.003051758,-.019577026,.012115479,-.137298584,-.069168091,-.890090942,1.048156738,.246505737,.152069092,.016708374,.02772522,-869751e-9,.00201416,12207e-8],[-61035e-9,-.001296997,.002883911,-.020690918,.009231567,-.140670776,-.088775635,-.91305542,1.031936646,.221984863,.15196228,.012420654,.02684021,-.001266479,.001907349,106812e-9,-61035e-9,-.001296997,.002883911,-.020690918,.009231567,-.140670776,-.088775635,-.91305542,1.031936646,.221984863,.15196228,.012420654,.02684021,-.001266479,.001907349,106812e-9],[-61035e-9,-.00138855,.002700806,-.021789551,.006134033,-.143676758,-.109161377,-.935195923,1.01461792,.198059082,.151306152,.00831604,.025909424,-.001617432,.001785278,106812e-9,-61035e-9,-.00138855,.002700806,-.021789551,.006134033,-.143676758,-.109161377,-.935195923,1.01461792,.198059082,.151306152,.00831604,.025909424,-.001617432,.001785278,106812e-9],[-76294e-9,-.001480103,.002487183,-.022857666,.002822876,-.146255493,-.130310059,-.956481934,.996246338,.174789429,.150115967,.004394531,.024932861,-.001937866,.001693726,91553e-9,-76294e-9,-.001480103,.002487183,-.022857666,.002822876,-.146255493,-.130310059,-.956481934,.996246338,.174789429,.150115967,.004394531,.024932861,-.001937866,.001693726,91553e-9],[-76294e-9,-.001586914,.002227783,-.023910522,-686646e-9,-.148422241,-.152206421,-.976852417,.976852417,.152206421,.148422241,686646e-9,.023910522,-.002227783,.001586914,76294e-9,-76294e-9,-.001586914,.002227783,-.023910522,-686646e-9,-.148422241,-.152206421,-.976852417,.976852417,.152206421,.148422241,686646e-9,.023910522,-.002227783,.001586914,76294e-9]];MP3Synth.prototype.full=function(frame,nch,ns){var Dptr,hi,lo,ptr;for(var ch=0;ch<nch;++ch){var sbsample=frame.sbsample[ch];var filter=this.filter[ch];var phase=this.phase;var pcm=this.pcm.samples[ch];var pcm1Ptr=0;var pcm2Ptr=0;for(var s=0;s<ns;++s){MP3Synth.dct32(sbsample[s],phase>>1,filter[0][phase&1],filter[1][phase&1]);var pe=phase&~1;var po=phase-1&15|1;var fe=filter[0][phase&1];var fx=filter[0][~phase&1];var fo=filter[1][~phase&1];var fePtr=0;var fxPtr=0;var foPtr=0;Dptr=0;ptr=D[Dptr];_fx=fx[fxPtr];_fe=fe[fePtr];lo=_fx[0]*ptr[po+0];lo+=_fx[1]*ptr[po+14];lo+=_fx[2]*ptr[po+12];lo+=_fx[3]*ptr[po+10];lo+=_fx[4]*ptr[po+8];lo+=_fx[5]*ptr[po+6];lo+=_fx[6]*ptr[po+4];lo+=_fx[7]*ptr[po+2];lo=-lo;lo+=_fe[0]*ptr[pe+0];lo+=_fe[1]*ptr[pe+14];lo+=_fe[2]*ptr[pe+12];lo+=_fe[3]*ptr[pe+10];lo+=_fe[4]*ptr[pe+8];lo+=_fe[5]*ptr[pe+6];lo+=_fe[6]*ptr[pe+4];lo+=_fe[7]*ptr[pe+2];pcm[pcm1Ptr++]=lo;pcm2Ptr=pcm1Ptr+30;for(var sb=1;sb<16;++sb){++fePtr;++Dptr;ptr=D[Dptr];_fo=fo[foPtr];_fe=fe[fePtr];lo=_fo[0]*ptr[po+0];lo+=_fo[1]*ptr[po+14];lo+=_fo[2]*ptr[po+12];lo+=_fo[3]*ptr[po+10];lo+=_fo[4]*ptr[po+8];lo+=_fo[5]*ptr[po+6];lo+=_fo[6]*ptr[po+4];lo+=_fo[7]*ptr[po+2];lo=-lo;lo+=_fe[7]*ptr[pe+2];lo+=_fe[6]*ptr[pe+4];lo+=_fe[5]*ptr[pe+6];lo+=_fe[4]*ptr[pe+8];lo+=_fe[3]*ptr[pe+10];lo+=_fe[2]*ptr[pe+12];lo+=_fe[1]*ptr[pe+14];lo+=_fe[0]*ptr[pe+0];pcm[pcm1Ptr++]=lo;lo=_fe[0]*ptr[-pe+31-16];lo+=_fe[1]*ptr[-pe+31-14];lo+=_fe[2]*ptr[-pe+31-12];lo+=_fe[3]*ptr[-pe+31-10];lo+=_fe[4]*ptr[-pe+31-8];lo+=_fe[5]*ptr[-pe+31-6];lo+=_fe[6]*ptr[-pe+31-4];lo+=_fe[7]*ptr[-pe+31-2];lo+=_fo[7]*ptr[-po+31-2];lo+=_fo[6]*ptr[-po+31-4];lo+=_fo[5]*ptr[-po+31-6];lo+=_fo[4]*ptr[-po+31-8];lo+=_fo[3]*ptr[-po+31-10];lo+=_fo[2]*ptr[-po+31-12];lo+=_fo[1]*ptr[-po+31-14];lo+=_fo[0]*ptr[-po+31-16];pcm[pcm2Ptr--]=lo;++foPtr}++Dptr;ptr=D[Dptr];_fo=fo[foPtr];lo=_fo[0]*ptr[po+0];lo+=_fo[1]*ptr[po+14];lo+=_fo[2]*ptr[po+12];lo+=_fo[3]*ptr[po+10];lo+=_fo[4]*ptr[po+8];lo+=_fo[5]*ptr[po+6];lo+=_fo[6]*ptr[po+4];lo+=_fo[7]*ptr[po+2];pcm[pcm1Ptr]=-lo;pcm1Ptr+=16;phase=(phase+1)%16}}};MP3Synth.prototype.frame=function(frame){var nch=frame.header.nchannels();var ns=frame.header.nbsamples();this.pcm.samplerate=frame.header.samplerate;this.pcm.channels=nch;this.pcm.length=32*ns;this.full(frame,nch,ns);this.phase=(this.phase+ns)%16};module.exports=MP3Synth},{"./utils":15}],14:[function(require,module,exports){exports.SF_TABLE=new Float32Array([2,1.587401051968,1.259921049895,1,.793700525984,.629960524947,.5,.396850262992,.314980262474,.25,.198425131496,.157490131237,.125,.099212565748,.078745065618,.0625,.049606282874,.039372532809,.03125,.024803141437,.019686266405,.015625,.012401570719,.009843133202,.0078125,.006200785359,.004921566601,.00390625,.00310039268,.002460783301,.001953125,.00155019634,.00123039165,.0009765625,.00077509817,.000615195825,.00048828125,.000387549085,.000307597913,.000244140625,.000193774542,.000153798956,.000122070313,96887271e-12,76899478e-12,61035156e-12,48443636e-12,38449739e-12,30517578e-12,24221818e-12,1922487e-11,15258789e-12,12110909e-12,9612435e-12,7629395e-12,6055454e-12,4806217e-12,3814697e-12,3027727e-12,2403109e-12,1907349e-12,1513864e-12,1201554e-12,0]);const SFB_48000_LONG=new Uint8Array([4,4,4,4,4,4,6,6,6,8,10,12,16,18,22,28,34,40,46,54,54,192]);const SFB_44100_LONG=new Uint8Array([4,4,4,4,4,4,6,6,8,8,10,12,16,20,24,28,34,42,50,54,76,158]);const SFB_32000_LONG=new Uint8Array([4,4,4,4,4,4,6,6,8,10,12,16,20,24,30,38,46,56,68,84,102,26]);const SFB_48000_SHORT=new Uint8Array([4,4,4,4,4,4,4,4,4,4,4,4,6,6,6,6,6,6,10,10,10,12,12,12,14,14,14,16,16,16,20,20,20,26,26,26,66,66,66]);const SFB_44100_SHORT=new Uint8Array([4,4,4,4,4,4,4,4,4,4,4,4,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,22,22,22,30,30,30,56,56,56]);const SFB_32000_SHORT=new Uint8Array([4,4,4,4,4,4,4,4,4,4,4,4,6,6,6,8,8,8,12,12,12,16,16,16,20,20,20,26,26,26,34,34,34,42,42,42,12,12,12]);const SFB_48000_MIXED=new Uint8Array([4,4,4,4,4,4,6,6,4,4,4,6,6,6,6,6,6,10,10,10,12,12,12,14,14,14,16,16,16,20,20,20,26,26,26,66,66,66]);const SFB_44100_MIXED=new Uint8Array([4,4,4,4,4,4,6,6,4,4,4,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,22,22,22,30,30,30,56,56,56]);const SFB_32000_MIXED=new Uint8Array([4,4,4,4,4,4,6,6,4,4,4,6,6,6,8,8,8,12,12,12,16,16,16,20,20,20,26,26,26,34,34,34,42,42,42,12,12,12]);const SFB_24000_LONG=new Uint8Array([6,6,6,6,6,6,8,10,12,14,16,18,22,26,32,38,46,54,62,70,76,36]);const SFB_22050_LONG=new Uint8Array([6,6,6,6,6,6,8,10,12,14,16,20,24,28,32,38,46,52,60,68,58,54]);const SFB_16000_LONG=SFB_22050_LONG;const SFB_24000_SHORT=new Uint8Array([4,4,4,4,4,4,4,4,4,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,24,24,24,32,32,32,44,44,44,12,12,12]);const SFB_22050_SHORT=new Uint8Array([4,4,4,4,4,4,4,4,4,6,6,6,6,6,6,8,8,8,10,10,10,14,14,14,18,18,18,26,26,26,32,32,32,42,42,42,18,18,18]);const SFB_16000_SHORT=new Uint8Array([4,4,4,4,4,4,4,4,4,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,24,24,24,30,30,30,40,40,40,18,18,18]);const SFB_24000_MIXED=new Uint8Array([6,6,6,6,6,6,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,24,24,24,32,32,32,44,44,44,12,12,12]);const SFB_22050_MIXED=new Uint8Array([6,6,6,6,6,6,6,6,6,6,6,6,8,8,8,10,10,10,14,14,14,18,18,18,26,26,26,32,32,32,42,42,42,18,18,18]);const SFB_16000_MIXED=new Uint8Array([6,6,6,6,6,6,6,6,6,8,8,8,10,10,10,12,12,12,14,14,14,18,18,18,24,24,24,30,30,30,40,40,40,18,18,18]);const SFB_12000_LONG=SFB_16000_LONG;const SFB_11025_LONG=SFB_12000_LONG;const SFB_8000_LONG=new Uint8Array([12,12,12,12,12,12,16,20,24,28,32,40,48,56,64,76,90,2,2,2,2,2]);const SFB_12000_SHORT=SFB_16000_SHORT;const SFB_11025_SHORT=SFB_12000_SHORT;const SFB_8000_SHORT=new Uint8Array([8,8,8,8,8,8,8,8,8,12,12,12,16,16,16,20,20,20,24,24,24,28,28,28,36,36,36,2,2,2,2,2,2,2,2,2,26,26,26]);const SFB_12000_MIXED=SFB_16000_MIXED;const SFB_11025_MIXED=SFB_12000_MIXED;const SFB_8000_MIXED=new Uint8Array([12,12,12,4,4,4,8,8,8,12,12,12,16,16,16,20,20,20,24,24,24,28,28,28,36,36,36,2,2,2,2,2,2,2,2,2,26,26,26]);exports.SFBWIDTH_TABLE=[{l:SFB_48000_LONG,s:SFB_48000_SHORT,m:SFB_48000_MIXED},{l:SFB_44100_LONG,s:SFB_44100_SHORT,m:SFB_44100_MIXED},{l:SFB_32000_LONG,s:SFB_32000_SHORT,m:SFB_32000_MIXED},{l:SFB_24000_LONG,s:SFB_24000_SHORT,m:SFB_24000_MIXED},{l:SFB_22050_LONG,s:SFB_22050_SHORT,m:SFB_22050_MIXED},{l:SFB_16000_LONG,s:SFB_16000_SHORT,m:SFB_16000_MIXED},{l:SFB_12000_LONG,s:SFB_12000_SHORT,m:SFB_12000_MIXED},{l:SFB_11025_LONG,s:SFB_11025_SHORT,m:SFB_11025_MIXED},{l:SFB_8000_LONG,s:SFB_8000_SHORT,m:SFB_8000_MIXED}];exports.PRETAB=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0]);exports.ROOT_TABLE=new Float32Array([.59460355750136,.70710678118655,.84089641525371,1,1.18920711500272,1.4142135623731,1.68179283050743]);exports.CS=new Float32Array([+.857492926,+.881741997,+.949628649,+.983314592,+.995517816,+.999160558,+.999899195,+.999993155]);exports.CA=new Float32Array([-.514495755,-.471731969,-.313377454,-.1819132,-.094574193,-.040965583,-.014198569,-.003699975]);exports.COUNT1TABLE_SELECT=1;exports.SCALEFAC_SCALE=2;exports.PREFLAG=4;exports.MIXED_BLOCK_FLAG=8;exports.I_STEREO=1;exports.MS_STEREO=2;exports.WINDOW_L=new Float32Array([.043619387,.130526192,.216439614,.3007058,.382683432,.461748613,.537299608,.608761429,.675590208,.737277337,.79335334,.843391446,.887010833,.923879533,.953716951,.976296007,.991444861,.999048222,.999048222,.991444861,.976296007,.953716951,.923879533,.887010833,.843391446,.79335334,.737277337,.675590208,.608761429,.537299608,.461748613,.382683432,.3007058,.216439614,.130526192,.043619387]);exports.WINDOW_S=new Float32Array([.130526192,.382683432,.608761429,.79335334,.923879533,.991444861,.991444861,.923879533,.79335334,.608761429,.382683432,.130526192]);exports.IS_TABLE=new Float32Array([0,.211324865,.366025404,.5,.633974596,.788675135,1]);exports.IS_LSF_TABLE=[new Float32Array([.840896415,.707106781,.594603558,.5,.420448208,.353553391,.297301779,.25,.210224104,.176776695,.148650889,.125,.105112052,.088388348,.074325445]),new Float32Array([.707106781,.5,.353553391,.25,.176776695,.125,.088388348,.0625,.044194174,.03125,.022097087,.015625,.011048543,.0078125,.005524272])];exports.SFLEN_TABLE=[{slen1:0,slen2:0},{slen1:0,slen2:1},{slen1:0,slen2:2},{slen1:0,slen2:3},{slen1:3,slen2:0},{slen1:1,slen2:1},{slen1:1,slen2:2},{slen1:1,slen2:3},{slen1:2,slen2:1},{slen1:2,slen2:2},{slen1:2,slen2:3},{slen1:3,slen2:1},{slen1:3,slen2:2},{slen1:3,slen2:3},{slen1:4,slen2:2},{slen1:4,slen2:3}];exports.NSFB_TABLE=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]]},{}],15:[function(require,module,exports){exports.makeArray=function(lengths,Type){if(!Type)Type=Float64Array;if(lengths.length===1){return new Type(lengths[0])}var ret=[],len=lengths[0];for(var j=0;j<len;j++){ret[j]=exports.makeArray(lengths.slice(1),Type)}return ret}},{}]},{},[1]);